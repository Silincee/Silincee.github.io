---
layout: post
title:  "çº¿ç¨‹äº¤æ›¿è¾“å‡ºé—®é¢˜"
date:   2020-09-03 09:58:06 +0800--
categories: [Java]
tags: [é«˜å¹¶å‘, ]  
---

# é¢è¯•é¢˜ï¼š

> ç”¨ä¸¤ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªè¾“å‡ºå­—æ¯ï¼Œä¸€ä¸ªè¾“å‡ºæ•°å­—ï¼Œäº¤æ›¿è¾“å‡º1A2B3C...26Z

## æ–¹æ³•ä¸€ï¼šwait_notify

[code](https://github.com/Silincee/-/blob/master/src/main/java/com/silince/interview/OutputByTurns2.java)

```java
public class OutputByTurns2 {
    public static void main(String[] args) throws Exception {
        final Object o = new Object();
        int a = (int) 'a';
        CountDownLatch countDownLatch = new CountDownLatch(1); // æŽ§åˆ¶æ‰§è¡Œé¡ºåº


        new Thread(() -> {
            // method
            try {
                countDownLatch.await();
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            synchronized (o) {
                for (int i = 0; i < 26; i++) {

                    System.out.println((char) (a + i));
                    try {
                        o.notify();
                        o.wait();// è®©å‡ºé” æŒæœ‰è¯¥å¯¹è±¡é”çš„çº¿ç¨‹åŽ»wait()
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                }
                o.notify();
            }
        }, "å­—æ¯").start();

        new Thread(() -> {
            // method
            synchronized (o) {
                countDownLatch.countDown();
                for (int i = 0; i < 26; i++) {
                    System.out.println(i + 1);
                    try {
                        o.notify(); // éšæœºå”¤é†’ä¸€ä¸ª wait çº¿ç¨‹
                        o.wait();// è®©å‡ºé” æŒæœ‰è¯¥å¯¹è±¡é”çš„çº¿ç¨‹åŽ»wait()
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                }
                o.notify(); // âš ï¸ ä¸ç„¶ç¨‹åºåœæ­¢ä¸äº†ï¼Œä¸€ç›´äº’ç›¸é€šçŸ¥
            }
        }, "æ•°å­—").start();
    }
}
```



## æ–¹æ³•äºŒï¼šLockSupport

[code](https://github.com/Silincee/-/blob/master/src/main/java/com/silince/interview/OutputByTurns.java)

```java
public class OutputByTurns {
    static Thread t1,t2 = null;

    public static void main(String[] args) {
        int a  = (int) 'a';
        
        t1 = new Thread(() -> {
            // method
            for (int i=0;i<26;i++) {
                System.out.println(i+1);
                LockSupport.unpark(t2); // å«é†’t2
                LockSupport.park(); // t1 é˜»å¡ž
            }
        }, "t1");

        t2 = new Thread(() -> {
            // method
            for (int i=0;i<26;i++) {
                LockSupport.park(); // t2 é˜»å¡ž
                System.out.println((char) (a+i));
                LockSupport.unpark(t1); // å«é†’t1

            }
        }, "t2");

        t1.start();
        t2.start();
    }
}
```



## æ–¹æ³•ä¸‰ï¼šReentrantLock

### èµ„æºç±»å†™æ³• ðŸ¤”

[code](https://github.com/Silincee/-/blob/master/src/main/java/com/silince/interview/OutputByTurns3_2.java)

```java
class ShareData {
    private int flag = 1; // 0:æ‰“å°å­—æ¯ 1:æ‰“å°æ•°å­—
    private Lock lock = new ReentrantLock();
    private Condition conditionNumber = lock.newCondition();
    private Condition conditionLetter = lock.newCondition();

    public void printNumber(int number) {
        lock.lock();
        try {
            // 1 åˆ¤æ–­
            while (flag != 1) {
                conditionNumber.await();
            }
            // 2 å¹²æ´»
            System.out.println(number);
            // 3 é€šçŸ¥
            flag = 0;
            conditionLetter.signal();

        } catch (Exception e) {
            e.printStackTrace();
        } finally {
            lock.unlock();
        }
    }

    public void printLetter(char ch) {
        lock.lock();
        try {
            // 1 åˆ¤æ–­
            while (flag != 0) {
                conditionLetter.await();
            }
            // 2 å¹²æ´»
            System.out.println(ch);
            // 3 é€šçŸ¥
            flag = 1;
            conditionNumber.signal();

        } catch (Exception e) {
            e.printStackTrace();
        } finally {
            lock.unlock();
        }
    }
}

public class OutputByTurns3_2 {
    public static void main(String[] args) {
        ShareData shareData = new ShareData();
        new Thread(() -> {
            // method
            for (int i = 0; i < 26; i++) {
                shareData.printNumber(i+1);
            }
        }, "æ‰“å°æ•°å­—").start();

        new Thread(() -> {
            // method
            for (int i = 0; i < 26; i++) {
                shareData.printLetter((char)('a'+i));
            }
        }, "æ‰“å°å­—æ¯").start();
    }
}	
```



### CountDownLatch æŽ§åˆ¶é¡ºåº

[code](https://github.com/Silincee/-/blob/master/src/main/java/com/silince/interview/OutputByTurns3.java)

```java
public class OutputByTurns3 {
    public static void main(String[] args) {
        int a = (int) 'a';
        Lock lock = new ReentrantLock();
        CountDownLatch countDownLatch = new CountDownLatch(1); // æŽ§åˆ¶æ‰§è¡Œé¡ºåº
        // âš ï¸ ReentrantLockå¯ä»¥æŒ‡å®šå”¤é†’å“ªä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„çº¿ç¨‹
        Condition conditionNumber = lock.newCondition(); // æ•°å­—æ¡ä»¶é˜Ÿåˆ—
        Condition conditionLetter = lock.newCondition(); // å­—æ¯æ¡ä»¶é˜Ÿåˆ—
        
        new Thread(() -> {
            // method
            try {
                countDownLatch.await();
            } catch (InterruptedException e) {
                e.printStackTrace();
            }

            lock.lock();
            try {
                // ... method body
                for (int i = 0; i < 26; i++) {
                    System.out.println((char) (a + i));
                    conditionNumber.signal();
                    conditionLetter.await();
                }
                conditionNumber.signal();
            } catch (Exception e) {
                e.printStackTrace();
            } finally {
                lock.unlock();
            }

        }, "å­—æ¯").start();

        new Thread(() -> {
            // method
            countDownLatch.countDown();

            lock.lock();
            try {
                // ... method body
                for (int i = 0; i < 26; i++) {
                    System.out.println(i + 1);
                    conditionLetter.signal();
                    conditionNumber.await();
                }
                conditionLetter.signal();
            } catch (Exception e) {
                e.printStackTrace();
            } finally {
                lock.unlock();
            }
        }, "æ•°å­—").start();
    }
}
```



## æ–¹æ³•å››ï¼šTransferQueueé˜»å¡žé˜Ÿåˆ—

[code](https://github.com/Silincee/-/blob/master/src/main/java/com/silince/interview/OutputByTurns4.java)

```java
public class OutputByTurns4 {
    public static void main(String[] args) {
        int a = (int) 'a';
        // è°transferè¿›åŽ»ä¸€ä¸ªå…ƒç´ è°é˜»å¡žï¼Œéœ€è¦åˆ«çš„çº¿ç¨‹æ‹¿èµ°æ‰èƒ½è¢«å”¤é†’
        // takeçš„æ—¶å€™ä¸ºç©ºåˆ™è‡ªå·±å…¥é˜Ÿç­‰å¾…ï¼Œä¸ä¸ºç©ºåˆ™ä¸é˜»å¡ž
        // è‹¥å…¥é˜Ÿæ—¶å‘çŽ°æœ‰ä¸€ä¸ªå…ƒç´ ä¸ºnullçš„èŠ‚ç‚¹ï¼Œç›´æŽ¥å°±å°†å…ƒç´ å¡«å……åˆ°è¯¥èŠ‚ç‚¹ï¼Œå¹¶å”¤é†’è¯¥èŠ‚ç‚¹ç­‰å¾…çš„çº¿ç¨‹
        // âš ï¸ è°æ¡ç€å…ƒç´ è°é˜»å¡ž
        TransferQueue<String> queue = new LinkedTransferQueue<>();

        new Thread(() -> {
            // method
            for (int i = 0; i < 26; i++) {
                try {
                    System.out.println(queue.take());
                    queue.transfer(String.valueOf((char)(a+i)));
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            }
        }, "å­—æ¯").start();

        new Thread(() -> {
            // method
            for (int i = 0; i < 26; i++) {
                try {

                    queue.transfer(String.valueOf(i+1));
                    System.out.println(queue.take());
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            }
        }, "æ•°å­—").start();
    }
}
```

