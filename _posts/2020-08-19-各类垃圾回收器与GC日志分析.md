---
scrolllayout: post
title:  "å„ç±»åƒåœ¾å›æ”¶å™¨ä¸GCæ—¥å¿—åˆ†æ"
date:   2020-08-19 21:23:06 +0800--
categories: [Java]
tags: [JVM, ]  


---

# å„ç±»åƒåœ¾å›æ”¶å™¨ä¸GCæ—¥å¿—åˆ†æ

> æ¥æºï¼šå°šç¡…è°·å®‹çº¢åº·JVMæ•™ç¨‹ 

## å¦‚ä½•æŸ¥çœ‹é»˜è®¤åƒåœ¾æ”¶é›†å™¨

***-XX:+PrintcommandLineFlagsï¼šæŸ¥çœ‹å‘½ä»¤è¡Œç›¸å…³å‚æ•°ï¼ˆåŒ…å«ä½¿ç”¨çš„åƒåœ¾æ”¶é›†å™¨ï¼‰***

***ä½¿ç”¨å‘½ä»¤è¡ŒæŒ‡ä»¤ï¼šjinfo -flag  ç›¸å…³åƒåœ¾å›æ”¶å™¨å‚æ•°  è¿›ç¨‹ID***

## Serialå›æ”¶å™¨ï¼šä¸²è¡Œå›æ”¶

Serialæ”¶é›†å™¨æ˜¯æœ€åŸºæœ¬ã€å†å²æœ€æ‚ ä¹…çš„åƒåœ¾æ”¶é›†å™¨äº†ã€‚JDK1.3ä¹‹å‰å›æ”¶æ–°ç”Ÿä»£å”¯ä¸€çš„é€‰æ‹©ã€‚

Serialæ”¶é›†å™¨ä½œä¸ºHotSpotä¸­clientæ¨¡å¼ä¸‹çš„é»˜è®¤æ–°ç”Ÿä»£åƒåœ¾æ”¶é›†å™¨ã€‚

***Serialæ”¶é›†å™¨é‡‡ç”¨å¤åˆ¶ç®—æ³•ã€ä¸²è¡Œå›æ”¶å’Œ"stop-the-world"æœºåˆ¶çš„æ–¹å¼æ‰§è¡Œå†…å­˜å›æ”¶ã€‚***

é™¤äº†å¹´è½»ä»£ä¹‹å¤–ï¼ŒSerialæ”¶é›†å™¨è¿˜æä¾›ç”¨äºæ‰§è¡Œè€å¹´ä»£åƒåœ¾æ”¶é›†çš„Serial oldæ”¶é›†å™¨ã€‚***Serial oldæ”¶é›†å™¨åŒæ ·ä¹Ÿé‡‡ç”¨äº†ä¸²è¡Œå›æ”¶å’Œ"stop the world"æœºåˆ¶ï¼Œåªä¸è¿‡å†…å­˜å›æ”¶ç®—æ³•ä½¿ç”¨çš„æ˜¯æ ‡è®°-å‹ç¼©ç®—æ³•ã€‚***

- Serial oldæ˜¯è¿è¡Œåœ¨Clientæ¨¡å¼ä¸‹é»˜è®¤çš„è€å¹´ä»£çš„åƒåœ¾å›æ”¶å™¨
- Serial 0ldåœ¨Serveræ¨¡å¼ä¸‹ä¸»è¦æœ‰ä¸¤ä¸ªç”¨é€”ï¼š
  - ä¸æ–°ç”Ÿä»£çš„Parallel Scavengeé…åˆä½¿ç”¨
  - ä½œä¸ºè€å¹´ä»£CMSæ”¶é›†å™¨çš„åå¤‡åƒåœ¾æ”¶é›†æ–¹æ¡ˆ

![image-20200713100703799](/assets/imgs/image-20200713100703799.png)

***è¿™ä¸ªæ”¶é›†å™¨æ˜¯ä¸€ä¸ªå•çº¿ç¨‹çš„æ”¶é›†å™¨ï¼Œä½†å®ƒçš„â€œå•çº¿ç¨‹â€çš„æ„ä¹‰å¹¶ä¸ä»…ä»…è¯´æ˜å®ƒåªä¼šä½¿ç”¨ä¸€ä¸ªCPUæˆ–ä¸€æ¡æ”¶é›†çº¿ç¨‹å»å®Œæˆåƒåœ¾æ”¶é›†å·¥ä½œï¼Œæ›´é‡è¦çš„æ˜¯åœ¨å®ƒè¿›è¡Œåƒåœ¾æ”¶é›†æ—¶ï¼Œå¿…é¡»æš‚åœå…¶ä»–æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹ï¼Œç›´åˆ°å®ƒæ”¶é›†ç»“æŸï¼ˆStop The Worldï¼‰***

ä¼˜åŠ¿ï¼š***ç®€å•è€Œé«˜æ•ˆï¼ˆä¸å…¶ä»–æ”¶é›†å™¨çš„å•çº¿ç¨‹æ¯”ï¼‰***ï¼Œå¯¹äºé™å®šå•ä¸ªCPUçš„ç¯å¢ƒæ¥è¯´ï¼ŒSerialæ”¶é›†å™¨ç”±äºæ²¡æœ‰çº¿ç¨‹äº¤äº’çš„å¼€é”€ï¼Œä¸“å¿ƒåšåƒåœ¾æ”¶é›†è‡ªç„¶å¯ä»¥è·å¾—æœ€é«˜çš„å•çº¿ç¨‹æ”¶é›†æ•ˆç‡ã€‚è¿è¡Œåœ¨clientæ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºæ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚

åœ¨ç”¨æˆ·çš„æ¡Œé¢åº”ç”¨åœºæ™¯ä¸­ï¼Œå¯ç”¨å†…å­˜ä¸€èˆ¬ä¸å¤§ï¼ˆå‡ åMBè‡³ä¸€ä¸¤ç™¾MBï¼‰ï¼Œå¯ä»¥åœ¨è¾ƒçŸ­æ—¶é—´å†…å®Œæˆåƒåœ¾æ”¶é›†ï¼ˆå‡ åmsè‡³ä¸€ç™¾å¤šmsï¼‰ï¼Œåªè¦ä¸é¢‘ç¹å‘ç”Ÿï¼Œä½¿ç”¨ä¸²è¡Œå›æ”¶å™¨æ˜¯å¯ä»¥æ¥å—çš„ã€‚

åœ¨HotSpotè™šæ‹Ÿæœºä¸­ï¼Œä½¿ç”¨-XXï¼š+UseSerialGCå‚æ•°å¯ä»¥æŒ‡å®šå¹´è½»ä»£å’Œè€å¹´ä»£éƒ½ä½¿ç”¨ä¸²è¡Œæ”¶é›†å™¨ã€‚ç­‰ä»·äºæ–°ç”Ÿä»£ç”¨Serial GCï¼Œä¸”è€å¹´ä»£ç”¨Serial old GC

### æ€»ç»“

è¿™ç§åƒåœ¾æ”¶é›†å™¨å¤§å®¶äº†è§£ï¼Œç°åœ¨å·²ç»ä¸ç”¨ä¸²è¡Œçš„äº†ã€‚è€Œä¸”åœ¨é™å®šå•æ ¸cpuæ‰å¯ä»¥ç”¨ã€‚ç°åœ¨éƒ½ä¸æ˜¯å•æ ¸çš„äº†ã€‚

***å¯¹äºäº¤äº’è¾ƒå¼ºçš„åº”ç”¨è€Œè¨€ï¼Œè¿™ç§åƒåœ¾æ”¶é›†å™¨æ˜¯ä¸èƒ½æ¥å—çš„ã€‚ä¸€èˆ¬åœ¨Java webåº”ç”¨ç¨‹åºä¸­æ˜¯ä¸ä¼šé‡‡ç”¨ä¸²è¡Œåƒåœ¾æ”¶é›†å™¨çš„ã€‚***

## ParNewå›æ”¶å™¨ï¼šå¹¶è¡Œå›æ”¶

å¦‚æœè¯´serialGCæ˜¯å¹´è½»ä»£ä¸­çš„å•çº¿ç¨‹åƒåœ¾æ”¶é›†å™¨ï¼Œé‚£ä¹ˆParNewæ”¶é›†å™¨åˆ™æ˜¯serialæ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ã€‚

- ***Paræ˜¯Parallelçš„ç¼©å†™ï¼ŒNewï¼šåªèƒ½å¤„ç†çš„æ˜¯æ–°ç”Ÿä»£***

ParNew æ”¶é›†å™¨é™¤äº†é‡‡ç”¨***å¹¶è¡Œå›æ”¶***çš„æ–¹å¼æ‰§è¡Œå†…å­˜å›æ”¶å¤–ï¼Œä¸¤æ¬¾åƒåœ¾æ”¶é›†å™¨ä¹‹é—´å‡ ä¹æ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚ParNewæ”¶é›†å™¨***åœ¨å¹´è½»ä»£ä¸­åŒæ ·ä¹Ÿæ˜¯é‡‡ç”¨å¤åˆ¶ç®—æ³•ã€"stop-the-World"æœºåˆ¶ã€‚***

ParNew æ˜¯å¾ˆå¤šJVMè¿è¡Œåœ¨Serveræ¨¡å¼ä¸‹æ–°ç”Ÿä»£çš„é»˜è®¤åƒåœ¾æ”¶é›†å™¨ã€‚

![image-20200713102030127](/assets/imgs/image-20200713102030127.png)

- ***å¯¹äºæ–°ç”Ÿä»£ï¼Œå›æ”¶æ¬¡æ•°é¢‘ç¹ï¼Œä½¿ç”¨å¹¶è¡Œæ–¹å¼é«˜æ•ˆã€‚***
- ***å¯¹äºè€å¹´ä»£ï¼Œå›æ”¶æ¬¡æ•°å°‘ï¼Œä½¿ç”¨ä¸²è¡Œæ–¹å¼èŠ‚çœèµ„æºã€‚ï¼ˆCPUå¹¶è¡Œéœ€è¦åˆ‡æ¢çº¿ç¨‹ï¼Œä¸²è¡Œå¯ä»¥çœå»åˆ‡æ¢çº¿ç¨‹çš„èµ„æºï¼‰***

***ç”±äºParNewæ”¶é›†å™¨æ˜¯åŸºäºå¹¶è¡Œå›æ”¶ï¼Œé‚£ä¹ˆæ˜¯å¦å¯ä»¥æ–­å®šParNewæ”¶é›†å™¨çš„å›æ”¶æ•ˆç‡åœ¨ä»»ä½•åœºæ™¯ä¸‹éƒ½ä¼šæ¯”serialæ”¶é›†å™¨æ›´é«˜æ•ˆï¼Ÿ***

- ParNewæ”¶é›†å™¨è¿è¡Œåœ¨å¤šCPUçš„ç¯å¢ƒä¸‹ï¼Œä¼˜äºå¯ä»¥å……åˆ†åˆ©ç”¨å¤šCPUã€å¤šæ ¸å¿ƒç­‰ç‰©ç†ç¡¬ä»¶èµ„æºä¼˜åŠ¿ï¼Œå¯ä»¥æ›´å¿«é€Ÿåœ°å®Œæˆåƒåœ¾æ”¶é›†ï¼Œæå‡ç¨‹åºçš„ååé‡ã€‚
- ä½†æ˜¯åœ¨å•ä¸ªCPUç¯å¢ƒä¸‹ï¼Œ***ParNewæ”¶é›†å™¨ä¸é€¼Serialæœé›†å™¨æ›´é«˜æ•ˆ***ã€‚è™½ç„¶Serialæ”¶é›†å™¨æ˜¯åŸºäºä¸²è¡Œå›æ”¶ï¼Œä½†æ˜¯ç”±äºCPUä¸éœ€è¦é¢‘ç¹çš„åšåˆ‡æ¢ä»»åŠ¡ï¼Œå› æ­¤å¯ä»¥æœ‰æ•ˆé¿å…å¤šçº¿ç¨‹äº¤äº’è¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä¸€äº›é¢å¤–å¼€é”€ã€‚

å› ä¸ºé™¤Serialå¤–ï¼Œç›®å‰åªæœ‰ParNew GCèƒ½ä¸CMSæ”¶é›†å™¨é…åˆå·¥ä½œ

åœ¨ç¨‹åºä¸­ï¼Œå¼€å‘äººå‘˜å¯ä»¥é€šè¿‡é€‰é¡¹***"-XXï¼š+UseParNewGC"***æ‰‹åŠ¨æŒ‡å®šä½¿ç”¨ParNewæ”¶é›†å™¨æ‰§è¡Œå†…å­˜å›æ”¶ä»»åŠ¡ã€‚å®ƒè¡¨ç¤ºå¹´è½»ä»£ä½¿ç”¨å¹¶è¡Œæ”¶é›†å™¨ï¼Œä¸å½±å“è€å¹´ä»£ã€‚

***-XX:ParallelGCThreads*** é™åˆ¶çº¿ç¨‹æ•°é‡ï¼Œé»˜è®¤å¼€å¯å’ŒCPUæ•°æ®ç›¸åŒçš„çº¿ç¨‹æ•°ã€‚

## Parallelå›æ”¶å™¨ï¼šååé‡ä¼˜å…ˆ

***HotSpotçš„å¹´è½»ä»£ä¸­é™¤äº†æ‹¥æœ‰ParNewæ”¶é›†å™¨æ˜¯åŸºäºå¹¶è¡Œå›æ”¶çš„ä»¥å¤–ï¼ŒParallel Scavengeæ”¶é›†å™¨åŒæ ·ä¹Ÿé‡‡ç”¨äº†å¤åˆ¶ç®—æ³•ã€å¹¶è¡Œå›æ”¶å’Œ"Stop the World"æœºåˆ¶ã€‚***

é‚£ä¹ˆParallel æ”¶é›†å™¨çš„å‡ºç°æ˜¯å¦å¤šæ­¤ä¸€ä¸¾ï¼Ÿ

- å’ŒParNewæ”¶é›†å™¨ä¸åŒï¼Œ***ParallelScavengeæ”¶é›†å™¨çš„ç›®æ ‡åˆ™æ˜¯è¾¾åˆ°ä¸€ä¸ªå¯æ§åˆ¶çš„ååé‡ï¼ˆThroughputï¼‰ï¼Œå®ƒä¹Ÿè¢«ç§°ä¸ºååé‡ä¼˜å…ˆçš„åƒåœ¾æ”¶é›†å™¨***ã€‚
- ***è‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥***ä¹Ÿæ˜¯Parallel Scavengeä¸ParNewä¸€ä¸ªé‡è¦åŒºåˆ«ã€‚

***é«˜ååé‡åˆ™å¯ä»¥é«˜æ•ˆç‡åœ°åˆ©ç”¨CPUæ—¶é—´ï¼Œå°½å¿«å®Œæˆç¨‹åºçš„è¿ç®—ä»»åŠ¡ï¼Œä¸»è¦é€‚åˆåœ¨åå°è¿ç®—è€Œä¸éœ€è¦å¤ªå¤šäº¤äº’çš„ä»»åŠ¡ã€‚***å› æ­¤ï¼Œå¸¸è§åœ¨æœåŠ¡å™¨ç¯å¢ƒä¸­ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œé‚£äº›æ‰§è¡Œ***æ‰¹é‡å¤„ç†ã€è®¢å•å¤„ç†ã€å·¥èµ„æ”¯ä»˜ã€ç§‘å­¦è®¡ç®—***çš„åº”ç”¨ç¨‹åºã€‚

Parallel æ”¶é›†å™¨åœ¨***JDK1.6***æ—¶æä¾›äº†ç”¨äº***æ‰§è¡Œè€å¹´ä»£åƒåœ¾æ”¶é›†çš„Parallel oldæ”¶é›†å™¨***ï¼Œç”¨æ¥ä»£æ›¿è€å¹´ä»£çš„serial oldæ”¶é›†å™¨ã€‚

***Parallel oldæ”¶é›†å™¨é‡‡ç”¨äº†æ ‡è®°-å‹ç¼©ç®—æ³•ï¼Œä½†åŒæ ·ä¹Ÿæ˜¯åŸºäºå¹¶è¡Œå›æ”¶å’Œ"stop-the-World"æœºåˆ¶ã€‚***

![image-20200713110359441](/assets/imgs/image-20200713110359441.png)

***åœ¨ç¨‹åºååé‡ä¼˜å…ˆçš„åº”ç”¨åœºæ™¯ä¸­ï¼ŒParallel æ”¶é›†å™¨å’ŒParallel oldæ”¶é›†å™¨çš„ç»„åˆï¼Œåœ¨serveræ¨¡å¼ä¸‹çš„å†…å­˜å›æ”¶æ€§èƒ½å¾ˆä¸é”™ã€‚***

***åœ¨Java8ä¸­ï¼Œé»˜è®¤æ˜¯æ­¤åƒåœ¾æ”¶é›†å™¨ã€‚***

### å‚æ•°é…ç½®

***-XXï¼š+UseParallelGC*** æ‰‹åŠ¨æŒ‡å®šå¹´è½»ä»£ä½¿ç”¨Parallel å¹¶è¡Œæ”¶é›†å™¨æ‰§è¡Œå†…å­˜å›æ”¶ä»»åŠ¡ã€‚

***-XXï¼š+UseParalleloldcc*** æ‰‹åŠ¨æŒ‡å®šè€å¹´ä»£éƒ½æ˜¯ä½¿ç”¨å¹¶è¡Œå›æ”¶æ”¶é›†å™¨ã€‚

- åˆ†åˆ«é€‚ç”¨äºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€‚é»˜è®¤jdk8æ˜¯å¼€å¯çš„ã€‚
- ***ä¸Šé¢ä¸¤ä¸ªå‚æ•°ï¼Œé»˜è®¤å¼€å¯ä¸€ä¸ªï¼Œå¦ä¸€ä¸ªä¹Ÿä¼šè¢«å¼€å¯ã€‚ï¼ˆäº’ç›¸æ¿€æ´»ï¼‰***

***-XX:ParallelGcrhreads***è®¾ç½®å¹´è½»ä»£å¹¶è¡Œæ”¶é›†å™¨çš„çº¿ç¨‹æ•°ã€‚***ä¸€èˆ¬åœ°ï¼Œæœ€å¥½ä¸CPUæ•°é‡ç›¸ç­‰ï¼Œä»¥é¿å…è¿‡å¤šçš„çº¿ç¨‹æ•°å½±å“åƒåœ¾æ”¶é›†æ€§èƒ½ã€‚***

- åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“CPUæ•°é‡å°äº8ä¸ªï¼ŒParallelGcThreadsçš„å€¼ç­‰äºCPUæ•°é‡ã€‚

- ***å½“CPUæ•°é‡å¤§äº8ä¸ªï¼ŒParallelGCThreadsçš„å€¼ç­‰äº3+[5\*CPU Count]/8]***

***-XX:MaxGCPauseMillis*** è®¾ç½®åƒåœ¾æ”¶é›†å™¨æœ€å¤§åœé¡¿æ—¶é—´ï¼ˆå³STWçš„æ—¶é—´ï¼‰ã€‚å•ä½æ˜¯æ¯«ç§’ã€‚

- ä¸ºäº†å°½å¯èƒ½åœ°æŠŠåœé¡¿æ—¶é—´æ§åˆ¶åœ¨MaxGCPauseMi11sä»¥å†…ï¼Œæ”¶é›†å™¨åœ¨å·¥ä½œæ—¶ä¼šè°ƒæ•´Javaå †å¤§å°æˆ–è€…å…¶ä»–ä¸€äº›å‚æ•°ã€‚
  å¯¹äºç”¨æˆ·æ¥è®²ï¼Œåœé¡¿æ—¶é—´è¶ŠçŸ­ä½“éªŒè¶Šå¥½ã€‚ä½†æ˜¯åœ¨æœåŠ¡å™¨ç«¯ï¼Œæˆ‘ä»¬æ³¨é‡é«˜å¹¶å‘ï¼Œæ•´ä½“çš„ååé‡ã€‚æ‰€ä»¥æœåŠ¡å™¨ç«¯é€‚åˆParallelï¼Œè¿›è¡Œæ§åˆ¶ã€‚
- ***è¯¥å‚æ•°ä½¿ç”¨éœ€è°¨æ…***ã€‚

***-XX:GCTimeRatioåƒåœ¾æ”¶é›†æ—¶é—´å æ€»æ—¶é—´çš„æ¯”ä¾‹ï¼ˆ=1/ï¼ˆN+1ï¼‰ï¼‰ã€‚ç”¨äºè¡¡é‡ååé‡çš„å¤§å°ã€‚***

- ***å–å€¼èŒƒå›´ï¼ˆ0ï¼Œ100ï¼‰ã€‚é»˜è®¤å€¼99ï¼Œä¹Ÿå°±æ˜¯åƒåœ¾å›æ”¶æ—¶é—´ä¸è¶…è¿‡1%ã€‚***

- ä¸å‰ä¸€ä¸ª-xx:MaxGCPauseMilliså‚æ•°æœ‰ä¸€å®šçŸ›ç›¾æ€§ã€‚æš‚åœæ—¶é—´è¶Šé•¿ï¼ŒRadioå‚æ•°å°±å®¹æ˜“è¶…è¿‡è®¾å®šçš„æ¯”ä¾‹ã€‚

***-XX:+UseAdaptivesizepplicy*** è®¾ç½®Parallel scavengeæ”¶é›†å™¨å…·æœ‰***è‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥***

- ***åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œå¹´è½»ä»£çš„å¤§å°ã€Edenå’ŒSurvivorçš„æ¯”ä¾‹ã€æ™‹å‡è€å¹´ä»£çš„å¯¹è±¡å¹´é¾„ç­‰å‚æ•°ä¼šè¢«è‡ªåŠ¨è°ƒæ•´ï¼Œå·²è¾¾åˆ°åœ¨å †å¤§å°ã€ååé‡å’Œåœé¡¿æ—¶é—´ä¹‹é—´çš„å¹³è¡¡ç‚¹ã€‚***

- ***åœ¨æ‰‹åŠ¨è°ƒä¼˜æ¯”è¾ƒå›°éš¾çš„åœºåˆï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ç§è‡ªé€‚åº”çš„æ–¹å¼ï¼Œä»…æŒ‡å®šè™šæ‹Ÿæœºçš„æœ€å¤§å †ã€ç›®æ ‡çš„ååé‡ï¼ˆGCTimeRatioï¼‰å’Œåœé¡¿æ—¶é—´ï¼ˆMaxGCPauseMillsï¼‰ï¼Œè®©è™šæ‹Ÿæœºè‡ªå·±å®Œæˆè°ƒä¼˜å·¥ä½œã€‚***

## CMSå›æ”¶å™¨ï¼šä½å»¶è¿Ÿ

åœ¨JDK1.5æ—¶æœŸï¼ŒHotspotæ¨å‡ºäº†ä¸€æ¬¾åœ¨***å¼ºäº¤äº’åº”ç”¨***ä¸­å‡ ä¹å¯è®¤ä¸ºæœ‰åˆ’æ—¶ä»£æ„ä¹‰çš„åƒåœ¾æ”¶é›†å™¨ï¼šCMSï¼ˆConcurrent-Mark-Sweepï¼‰æ”¶é›†å™¨ï¼Œè¿™æ¬¾æ”¶é›†å™¨æ˜¯HotSpotè™šæ‹Ÿæœºä¸­***ç¬¬ä¸€æ¬¾çœŸæ­£æ„ä¹‰ä¸Šçš„å¹¶å‘æ”¶é›†å™¨***ï¼Œ**å®ƒç¬¬ä¸€æ¬¡å®ç°äº†è®©åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹åŒæ—¶å·¥ä½œ**ã€‚

CMSæ”¶é›†å™¨çš„å…³æ³¨ç‚¹æ˜¯å°½å¯èƒ½ç¼©çŸ­åƒåœ¾æ”¶é›†æ—¶ç”¨æˆ·çº¿ç¨‹çš„åœé¡¿æ—¶é—´ã€‚åœé¡¿æ—¶é—´è¶ŠçŸ­ï¼ˆä½å»¶è¿Ÿï¼‰å°±è¶Šé€‚åˆä¸ç”¨æˆ·äº¤äº’çš„ç¨‹åºï¼Œè‰¯å¥½çš„å“åº”é€Ÿåº¦èƒ½æå‡ç”¨æˆ·ä½“éªŒã€‚

- ***ç›®å‰å¾ˆå¤§ä¸€éƒ¨åˆ†çš„Javaåº”ç”¨é›†ä¸­åœ¨äº’è”ç½‘ç«™æˆ–è€…B/Sç³»ç»Ÿçš„æœåŠ¡ç«¯ä¸Šï¼Œè¿™ç±»åº”ç”¨å°¤å…¶é‡è§†æœåŠ¡çš„å“åº”é€Ÿåº¦ï¼Œå¸Œæœ›ç³»ç»Ÿåœé¡¿æ—¶é—´æœ€çŸ­***ï¼Œä»¥ç»™ç”¨æˆ·å¸¦æ¥è¾ƒå¥½çš„ä½“éªŒã€‚CMSæ”¶é›†å™¨å°±éå¸¸ç¬¦åˆè¿™ç±»åº”ç”¨çš„éœ€æ±‚ã€‚

CMSçš„åƒåœ¾æ”¶é›†ç®—æ³•é‡‡ç”¨***æ ‡è®°-æ¸…é™¤ç®—æ³•***ï¼Œå¹¶ä¸”ä¹Ÿä¼š"stop-the-world"

ä¸å¹¸çš„æ˜¯ï¼Œ***CMSä½œä¸ºè€å¹´ä»£çš„æ”¶é›†å™¨ï¼Œå´æ— æ³•ä¸JDK1.4.0ä¸­å·²ç»å­˜åœ¨çš„æ–°ç”Ÿä»£æ”¶é›†å™¨Parallel Scavengeé…åˆå·¥ä½œï¼Œæ‰€ä»¥åœ¨JDK1.5ä¸­ä½¿ç”¨CMSæ¥æ”¶é›†è€å¹´ä»£çš„æ—¶å€™ï¼Œæ–°ç”Ÿä»£åªèƒ½é€‰æ‹©ParNewæˆ–è€…Serialæ”¶é›†å™¨ä¸­çš„ä¸€ä¸ªã€‚***

åœ¨G1å‡ºç°ä¹‹å‰ï¼ŒCMSä½¿ç”¨è¿˜æ˜¯éå¸¸å¹¿æ³›çš„ã€‚ä¸€ç›´åˆ°ä»Šå¤©ï¼Œä»ç„¶æœ‰å¾ˆå¤šç³»ç»Ÿä½¿ç”¨CMS GCã€‚

![image-20200713205154007](/assets/imgs/image-20200713205154007.png)

CMSæ•´ä¸ªè¿‡ç¨‹æ¯”ä¹‹å‰çš„æ”¶é›†å™¨è¦å¤æ‚ï¼Œæ•´ä¸ªè¿‡ç¨‹åˆ†ä¸º***4ä¸ªä¸»è¦é˜¶æ®µï¼Œå³åˆå§‹æ ‡è®°é˜¶æ®µã€å¹¶å‘æ ‡è®°é˜¶æ®µã€é‡æ–°æ ‡è®°é˜¶æ®µå’Œå¹¶å‘æ¸…é™¤é˜¶æ®µ***ã€‚(æ¶‰åŠSTWçš„é˜¶æ®µä¸»è¦æ˜¯ï¼šåˆå§‹æ ‡è®° å’Œ é‡æ–°æ ‡è®°)

- **åˆå§‹æ ‡è®°**ï¼ˆInitial-Markï¼‰é˜¶æ®µï¼šåœ¨è¿™ä¸ªé˜¶æ®µä¸­ï¼Œç¨‹åºä¸­æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹éƒ½å°†ä¼šå› ä¸ºâ€œstop-the-worldâ€æœºåˆ¶è€Œå‡ºç°çŸ­æš‚çš„æš‚åœï¼Œè¿™ä¸ªé˜¶æ®µçš„ä¸»è¦ä»»åŠ¡***ä»…ä»…åªæ˜¯æ ‡è®°å‡ºGCRootsèƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡***ã€‚ä¸€æ—¦æ ‡è®°å®Œæˆä¹‹åå°±ä¼šæ¢å¤ä¹‹å‰è¢«æš‚åœçš„æ‰€æœ‰åº”ç”¨çº¿ç¨‹ã€‚***ç”±äºç›´æ¥å…³è”å¯¹è±¡æ¯”è¾ƒå°ï¼Œæ‰€ä»¥è¿™é‡Œçš„é€Ÿåº¦éå¸¸å¿«***ã€‚
- **å¹¶å‘æ ‡è®°**ï¼ˆConcurrent-Markï¼‰é˜¶æ®µï¼š***ä»GC Rootsçš„ç›´æ¥å…³è”å¯¹è±¡å¼€å§‹éå†æ•´ä¸ªå¯¹è±¡å›¾çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹è€—æ—¶è¾ƒé•¿ä½†æ˜¯ä¸éœ€è¦åœé¡¿ç”¨æˆ·çº¿ç¨‹ï¼Œå¯ä»¥ä¸åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸€èµ·å¹¶å‘è¿è¡Œã€‚***
- **é‡æ–°æ ‡è®°**ï¼ˆRemarkï¼‰é˜¶æ®µï¼šç”±äºåœ¨å¹¶å‘æ ‡è®°é˜¶æ®µä¸­ï¼Œç¨‹åºçš„å·¥ä½œçº¿ç¨‹ä¼šå’Œåƒåœ¾æ”¶é›†çº¿ç¨‹åŒæ—¶è¿è¡Œæˆ–è€…äº¤å‰è¿è¡Œï¼Œå› æ­¤***ä¸ºäº†ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å› ç”¨æˆ·ç¨‹åºç»§ç»­è¿ä½œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ï¼Œè¿™ä¸ªé˜¶æ®µçš„åœé¡¿æ—¶é—´é€šå¸¸ä¼šæ¯”åˆå§‹æ ‡è®°é˜¶æ®µç¨é•¿ä¸€äº›ï¼Œä½†ä¹Ÿè¿œæ¯”å¹¶å‘æ ‡è®°é˜¶æ®µçš„æ—¶é—´çŸ­ã€‚*** **(â—ï¸é‡æ–°æ ‡è®°çš„æ˜¯å¹¶å‘æ ‡è®°é˜¶æ®µæ‰€æ ‡è®°è¿‡çš„åƒåœ¾)**
- **å¹¶å‘æ¸…é™¤**ï¼ˆConcurrent-Sweepï¼‰é˜¶æ®µï¼š***æ­¤é˜¶æ®µæ¸…ç†åˆ é™¤æ‰æ ‡è®°é˜¶æ®µåˆ¤æ–­çš„å·²ç»æ­»äº¡çš„å¯¹è±¡ï¼Œé‡Šæ”¾å†…å­˜ç©ºé—´ã€‚***ç”±äºä¸éœ€è¦ç§»åŠ¨å­˜æ´»å¯¹è±¡ï¼Œæ‰€ä»¥è¿™ä¸ªé˜¶æ®µä¹Ÿæ˜¯å¯ä»¥ä¸ç”¨æˆ·çº¿ç¨‹åŒæ—¶å¹¶å‘çš„

å°½ç®¡CMSæ”¶é›†å™¨é‡‡ç”¨çš„æ˜¯å¹¶å‘å›æ”¶ï¼ˆéç‹¬å å¼ï¼‰ï¼Œä½†æ˜¯åœ¨å…¶***åˆå§‹åŒ–æ ‡è®°å’Œå†æ¬¡æ ‡è®°è¿™ä¸¤ä¸ªé˜¶æ®µä¸­ä»ç„¶éœ€è¦æ‰§è¡Œâ€œStop-the-Worldâ€æœºåˆ¶æš‚åœç¨‹åºä¸­çš„å·¥ä½œçº¿ç¨‹ï¼Œä¸è¿‡æš‚åœæ—¶é—´å¹¶ä¸ä¼šå¤ªé•¿***ï¼Œå› æ­¤å¯ä»¥è¯´æ˜ç›®å‰æ‰€æœ‰çš„åƒåœ¾æ”¶é›†å™¨éƒ½åšä¸åˆ°å®Œå…¨ä¸éœ€è¦â€œstop-the-Worldâ€ï¼Œåªæ˜¯å°½å¯èƒ½åœ°ç¼©çŸ­æš‚åœæ—¶é—´ã€‚

***ç”±äºæœ€è€—è´¹æ—¶é—´çš„å¹¶å‘æ ‡è®°ä¸å¹¶å‘æ¸…é™¤é˜¶æ®µéƒ½ä¸éœ€è¦æš‚åœå·¥ä½œï¼Œæ‰€ä»¥æ•´ä½“çš„å›æ”¶æ˜¯ä½åœé¡¿çš„ã€‚***

å¦å¤–ï¼Œ***ç”±äºåœ¨åƒåœ¾æ”¶é›†é˜¶æ®µç”¨æˆ·çº¿ç¨‹æ²¡æœ‰ä¸­æ–­ï¼Œæ‰€ä»¥åœ¨CMSå›æ”¶è¿‡ç¨‹ä¸­ï¼Œè¿˜åº”è¯¥ç¡®ä¿åº”ç”¨ç¨‹åºç”¨æˆ·çº¿ç¨‹æœ‰è¶³å¤Ÿçš„å†…å­˜å¯ç”¨ã€‚***å› æ­¤ï¼ŒCMSæ”¶é›†å™¨ä¸èƒ½åƒå…¶ä»–æ”¶é›†å™¨é‚£æ ·ç­‰åˆ°è€å¹´ä»£å‡ ä¹å®Œå…¨è¢«å¡«æ»¡äº†å†è¿›è¡Œæ”¶é›†ï¼Œè€Œæ˜¯***å½“å †å†…å­˜ä½¿ç”¨ç‡è¾¾åˆ°æŸä¸€é˜ˆå€¼æ—¶ï¼Œä¾¿å¼€å§‹è¿›è¡Œå›æ”¶***ï¼Œä»¥ç¡®ä¿åº”ç”¨ç¨‹åºåœ¨CMSå·¥ä½œè¿‡ç¨‹ä¸­ä¾ç„¶æœ‰è¶³å¤Ÿçš„ç©ºé—´æ”¯æŒåº”ç”¨ç¨‹åºè¿è¡Œã€‚è¦æ˜¯CMSè¿è¡ŒæœŸé—´é¢„ç•™çš„å†…å­˜æ— æ³•æ»¡è¶³ç¨‹åºéœ€è¦ï¼Œå°±ä¼šå‡ºç°ä¸€æ¬¡***â€œConcurrent Mode Failureâ€***
å¤±è´¥ï¼Œ***è¿™æ—¶è™šæ‹Ÿæœºå°†å¯åŠ¨åå¤‡é¢„æ¡ˆï¼šä¸´æ—¶å¯ç”¨Serial oldæ”¶é›†å™¨æ¥é‡æ–°è¿›è¡Œè€å¹´ä»£çš„åƒåœ¾æ”¶é›†ï¼Œè¿™æ ·åœé¡¿æ—¶é—´å°±å¾ˆé•¿äº†ã€‚***

CMSæ”¶é›†å™¨çš„åƒåœ¾æ”¶é›†ç®—æ³•é‡‡ç”¨çš„æ˜¯**æ ‡è®°-æ¸…é™¤ç®—æ³•**ï¼Œè¿™æ„å‘³ç€æ¯æ¬¡æ‰§è¡Œå®Œå†…å­˜å›æ”¶åï¼Œç”±äºè¢«æ‰§è¡Œå†…å­˜å›æ”¶çš„æ— ç”¨å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜ç©ºé—´ææœ‰å¯èƒ½æ˜¯ä¸è¿ç»­çš„ä¸€äº›å†…å­˜å—ï¼Œ***ä¸å¯é¿å…åœ°å°†ä¼šäº§ç”Ÿä¸€äº›å†…å­˜ç¢ç‰‡***ã€‚é‚£ä¹ˆCMSåœ¨ä¸ºæ–°å¯¹è±¡åˆ†é…å†…å­˜ç©ºé—´æ—¶ï¼Œå°†æ— æ³•ä½¿ç”¨æŒ‡é’ˆç¢°æ’ï¼ˆBump the Pointerï¼‰æŠ€æœ¯ï¼Œè€Œåªèƒ½å¤Ÿé€‰æ‹©ç©ºé—²åˆ—è¡¨ï¼ˆFree Listï¼‰æ‰§è¡Œå†…å­˜åˆ†é…ã€‚

![image-20200713212230352](/assets/imgs/image-20200713212230352.png)

### CMSä¸ºä»€ä¹ˆä¸ä½¿ç”¨æ ‡è®°æ•´ç†ç®—æ³•ï¼Ÿ

ç­”æ¡ˆå…¶å®å¾ˆç®€ç­”ï¼Œ***å› ä¸ºå½“å¹¶å‘æ¸…é™¤çš„æ—¶å€™ï¼Œç”¨Compactæ•´ç†å†…å­˜çš„è¯ï¼ŒåŸæ¥çš„ç”¨æˆ·çº¿ç¨‹ä½¿ç”¨çš„å†…å­˜è¿˜æ€ä¹ˆç”¨å‘¢ï¼Ÿ******è¦ä¿è¯ç”¨æˆ·çº¿ç¨‹èƒ½ç»§ç»­æ‰§è¡Œï¼Œå‰æçš„å®ƒè¿è¡Œçš„èµ„æºä¸å—å½±å“å˜›ã€‚Mark Compactæ›´é€‚åˆâ€œstop the worldâ€******,è¿™ç§åœºæ™¯ä¸‹ä½¿ç”¨ã€‚***

### ä¼˜ç‚¹

- ***å¹¶å‘æ”¶é›†***
- ***ä½å»¶è¿Ÿ***

### ç¼ºç‚¹

- ***ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡***ï¼Œå¯¼è‡´å¹¶å‘æ¸…é™¤åï¼Œç”¨æˆ·çº¿ç¨‹å¯ç”¨çš„ç©ºé—´ä¸è¶³ã€‚åœ¨æ— æ³•åˆ†é…å¤§å¯¹è±¡çš„æƒ…å†µä¸‹ï¼Œä¸å¾—ä¸æå‰è§¦å‘FullGCã€‚

- ***CMSæ”¶é›†å™¨å¯¹CPUèµ„æºéå¸¸æ•æ„Ÿ***ã€‚åœ¨å¹¶å‘é˜¶æ®µï¼Œå®ƒè™½ç„¶ä¸ä¼šå¯¼è‡´ç”¨æˆ·åœé¡¿ï¼Œä½†æ˜¯ä¼šå› ä¸ºå ç”¨äº†ä¸€éƒ¨åˆ†çº¿ç¨‹è€Œå¯¼è‡´åº”ç”¨ç¨‹åºå˜æ…¢ï¼Œæ€»ååé‡ä¼šé™ä½ã€‚
- ***CMSæ”¶é›†å™¨æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ã€‚***å¯èƒ½å‡ºç°â€œConcurrent Mode Failure"å¤±è´¥è€Œå¯¼è‡´å¦ä¸€æ¬¡Full GCçš„äº§ç”Ÿã€‚åœ¨å¹¶å‘æ ‡è®°é˜¶æ®µç”±äºç¨‹åºçš„å·¥ä½œçº¿ç¨‹å’Œåƒåœ¾æ”¶é›†çº¿ç¨‹æ˜¯åŒæ—¶è¿è¡Œæˆ–è€…äº¤å‰è¿è¡Œçš„ï¼Œ***é‚£ä¹ˆåœ¨å¹¶å‘æ ‡è®°é˜¶æ®µå¦‚æœäº§ç”Ÿæ–°çš„åƒåœ¾å¯¹è±¡ï¼ŒCMSå°†æ— æ³•å¯¹è¿™äº›åƒåœ¾å¯¹è±¡è¿›è¡Œæ ‡è®°ï¼Œæœ€ç»ˆä¼šå¯¼è‡´è¿™äº›æ–°äº§ç”Ÿçš„åƒåœ¾å¯¹è±¡æ²¡æœ‰è¢«åŠæ—¶å›æ”¶***ï¼Œä»è€Œåªèƒ½åœ¨ä¸‹ä¸€æ¬¡æ‰§è¡ŒGCæ—¶é‡Šæ”¾è¿™äº›ä¹‹å‰æœªè¢«å›æ”¶çš„å†…å­˜ç©ºé—´ã€‚

### è®¾ç½®çš„å‚æ•°

***-XXï¼š+UseConcMarkSweepGC*** æ‰‹åŠ¨æŒ‡å®šä½¿ç”¨CMSæ”¶é›†å™¨æ‰§è¡Œå†…å­˜å›æ”¶ä»»åŠ¡ã€‚

- å¼€å¯è¯¥å‚æ•°åä¼šè‡ªåŠ¨å°†-xxï¼š+UseParNewGCæ‰“å¼€ã€‚å³ï¼šParNewï¼ˆYoungåŒºç”¨ï¼‰+CMSï¼ˆ0ldåŒºç”¨ï¼‰+Serial oldçš„ç»„åˆã€‚

***-XX:CMSInitiatingoccupanyFraction***  è®¾ç½®å †å†…å­˜ä½¿ç”¨ç‡çš„é˜ˆå€¼ï¼Œä¸€æ—¦è¾¾åˆ°è¯¥é˜ˆå€¼ï¼Œä¾¿å¼€å§‹è¿›è¡Œå›æ”¶ã€‚

- JDK5åŠä»¥å‰ç‰ˆæœ¬çš„é»˜è®¤å€¼ä¸º68ï¼Œå³å½“è€å¹´ä»£çš„ç©ºé—´ä½¿ç”¨ç‡è¾¾åˆ°68%æ—¶ï¼Œä¼šæ‰§è¡Œä¸€æ¬¡CMSå›æ”¶ã€‚***JDK6åŠä»¥ä¸Šç‰ˆæœ¬é»˜è®¤å€¼ä¸º92%ã€‚***

- ***å¦‚æœå†…å­˜å¢é•¿ç¼“æ…¢(ç”¨æˆ·çº¿ç¨‹)ï¼Œåˆ™å¯ä»¥è®¾ç½®ä¸€ä¸ªç¨å¤§çš„å€¼***ï¼Œå¤§çš„é˜€å€¼å¯ä»¥æœ‰æ•ˆé™ä½CMSçš„è§¦å‘é¢‘ç‡ï¼Œå‡å°‘è€å¹´ä»£å›æ”¶çš„æ¬¡æ•°å¯ä»¥è¾ƒä¸ºæ˜æ˜¾åœ°æ”¹å–„åº”ç”¨ç¨‹åºæ€§èƒ½ã€‚åä¹‹ï¼Œå¦‚æœåº”ç”¨ç¨‹åºå†…å­˜ä½¿ç”¨ç‡å¢é•¿å¾ˆå¿«ï¼Œåˆ™åº”è¯¥é™ä½è¿™ä¸ªé˜ˆå€¼ï¼Œä»¥é¿å…é¢‘ç¹è§¦å‘è€å¹´ä»£ä¸²è¡Œæ”¶é›†å™¨ã€‚***å› æ­¤é€šè¿‡è¯¥é€‰é¡¹ä¾¿å¯ä»¥æœ‰æ•ˆé™ä½Full Gcçš„æ‰§è¡Œæ¬¡æ•°ã€‚***

***-XXï¼š+UseCMSCompactAtFullCollection*** ç”¨äºæŒ‡å®šåœ¨æ‰§è¡Œå®ŒFull GCåå¯¹å†…å­˜ç©ºé—´è¿›è¡Œå‹ç¼©æ•´ç†ï¼Œä»¥æ­¤é¿å…å†…å­˜ç¢ç‰‡çš„äº§ç”Ÿã€‚ä¸è¿‡ç”±äºå†…å­˜å‹ç¼©æ•´ç†è¿‡ç¨‹æ— æ³•å¹¶å‘æ‰§è¡Œï¼Œæ‰€å¸¦æ¥çš„é—®é¢˜å°±æ˜¯åœé¡¿æ—¶é—´å˜å¾—æ›´é•¿äº†ã€‚

***-XX:CMSFullGCsBeforecompaction*** è®¾ç½®åœ¨æ‰§è¡Œå¤šå°‘æ¬¡Full GCåå¯¹å†…å­˜ç©ºé—´è¿›è¡Œå‹ç¼©æ•´ç†ã€‚

***-XX:ParallelcMSThreads*** è®¾ç½®CMSçš„çº¿ç¨‹æ•°é‡ã€‚

- CMsé»˜è®¤å¯åŠ¨çš„çº¿ç¨‹æ•°æ˜¯ï¼ˆParallel GCThreads+3ï¼‰/4ï¼ŒParallelGCThreadsæ˜¯å¹´è½»ä»£å¹¶è¡Œæ”¶é›†å™¨çš„çº¿ç¨‹æ•°ã€‚å½“CPUèµ„æºæ¯”è¾ƒç´§å¼ æ—¶ï¼Œå—åˆ°CMSæ”¶é›†å™¨çº¿ç¨‹çš„å½±å“ï¼Œåº”ç”¨ç¨‹åºçš„æ€§èƒ½åœ¨åƒåœ¾å›æ”¶é˜¶æ®µå¯èƒ½ä¼šéå¸¸ç³Ÿç³•ã€‚

### å°ç»“ ğŸ§

HotSpotæœ‰è¿™ä¹ˆå¤šçš„åƒåœ¾å›æ”¶å™¨ï¼Œé‚£ä¹ˆå¦‚æœæœ‰äººé—®ï¼ŒSerial GCã€Parallel GCã€Concurrent Mark Sweep GCè¿™ä¸‰ä¸ªGcæœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿ

***è¯·è®°ä½ä»¥ä¸‹å£ä»¤ï¼š***

- ***å¦‚æœä½ æƒ³è¦æœ€å°åŒ–åœ°ä½¿ç”¨å†…å­˜å’Œå¹¶è¡Œå¼€é”€ï¼Œè¯·é€‰Serial GCï¼›***  æ­é…Serial Old
- ***å¦‚æœä½ æƒ³è¦æœ€å¤§åŒ–åº”ç”¨ç¨‹åºçš„ååé‡ï¼Œè¯·é€‰Parallel GCï¼›***  æ­é…Parallel Old
- ***å¦‚æœä½ æƒ³è¦æœ€å°åŒ–GCçš„ä¸­æ–­æˆ–åœé¡¿æ—¶é—´ï¼Œè¯·é€‰CMS GCã€‚***  æ­é…ParNew 

### JDKåç»­ç‰ˆæœ¬ä¸­CMSçš„å˜åŒ– ğŸ§

***JDK9æ–°ç‰¹æ€§ï¼šCMSè¢«æ ‡è®°ä¸ºDeprecateäº†ï¼ˆJEP291ï¼‰***

- å¦‚æœå¯¹JDK9åŠä»¥ä¸Šç‰ˆæœ¬çš„HotSpotè™šæ‹Ÿæœºä½¿ç”¨å‚æ•°-XXï¼š
  +UseConcMarkSweepGCæ¥å¼€å¯CMSæ”¶é›†å™¨çš„è¯ï¼Œç”¨æˆ·ä¼šæ”¶åˆ°ä¸€ä¸ªè­¦å‘Šä¿¡æ¯ï¼Œæç¤ºCMSæœªæ¥å°†ä¼šè¢«åºŸå¼ƒã€‚

***JDK14æ–°ç‰¹æ€§ï¼šåˆ é™¤CMsåƒåœ¾å›æ”¶å™¨ï¼ˆJEP363ï¼‰***

- ç§»é™¤äº†CMSåƒåœ¾æ”¶é›†å™¨ï¼Œå¦‚æœåœ¨JDK14ä¸­ä½¿ç”¨
  XXï¼š+UseConcMarkSweepGCçš„è¯ï¼ŒJVMä¸ä¼šæŠ¥é”™ï¼Œåªæ˜¯ç»™å‡ºä¸€ä¸ªwarningä¿¡æ¯ï¼Œä½†æ˜¯ä¸ä¼šexitã€‚JVMä¼šè‡ªåŠ¨å›é€€ä»¥é»˜è®¤GCæ–¹å¼å¯åŠ¨JVM

## G1å›æ”¶å™¨ï¼šåŒºåŸŸåŒ–åˆ†ä»£å¼ ğŸ§

### æ—¢ç„¶æˆ‘ä»¬å·²ç»æœ‰äº†å‰é¢å‡ ä¸ªå¼ºå¤§çš„GCï¼Œä¸ºä»€ä¹ˆè¿˜è¦å‘å¸ƒGarbage Firstï¼ˆG1ï¼‰ï¼Ÿ

åŸå› å°±åœ¨äºåº”ç”¨ç¨‹åºæ‰€åº”å¯¹çš„***ä¸šåŠ¡è¶Šæ¥è¶Šåºå¤§ã€å¤æ‚ï¼Œç”¨æˆ·è¶Šæ¥è¶Šå¤š***ï¼Œæ²¡æœ‰GCå°±ä¸èƒ½ä¿è¯åº”ç”¨ç¨‹åºæ­£å¸¸è¿›è¡Œï¼Œè€Œç»å¸¸é€ æˆSTWçš„GCåˆè·Ÿä¸ä¸Šå®é™…çš„éœ€æ±‚ï¼Œæ‰€ä»¥æ‰ä¼šä¸æ–­åœ°å°è¯•å¯¹GCè¿›è¡Œä¼˜åŒ–ã€‚G1ï¼ˆGarbage-Firstï¼‰åƒåœ¾å›æ”¶å™¨æ˜¯åœ¨Java7 update4ä¹‹åå¼•å…¥çš„ä¸€ä¸ªæ–°çš„åƒåœ¾å›æ”¶å™¨ï¼Œæ˜¯å½“ä»Šæ”¶é›†å™¨æŠ€æœ¯å‘å±•çš„æœ€å‰æ²¿æˆæœä¹‹ä¸€ã€‚

ä¸æ­¤åŒæ—¶ï¼Œä¸ºäº†***é€‚åº”ç°åœ¨ä¸æ–­æ‰©å¤§çš„å†…å­˜å’Œä¸æ–­å¢åŠ çš„å¤„ç†å™¨æ•°é‡***ï¼Œè¿›ä¸€æ­¥é™ä½æš‚åœæ—¶é—´ï¼ˆpause timeï¼‰ï¼ŒåŒæ—¶å…¼é¡¾è‰¯å¥½çš„ååé‡ã€‚

***âš ï¸  å®˜æ–¹ç»™G1è®¾å®šçš„ç›®æ ‡æ˜¯åœ¨å»¶è¿Ÿå¯æ§çš„æƒ…å†µä¸‹è·å¾—å°½å¯èƒ½é«˜çš„ååé‡ï¼Œæ‰€ä»¥æ‰æ‹…å½“èµ·â€œå…¨åŠŸèƒ½æ”¶é›†å™¨â€çš„é‡ä»»ä¸æœŸæœ›ã€‚***

### ä¸ºä»€ä¹ˆåå­—å« Garbage First(G1)å‘¢ï¼Ÿ

å› ä¸ºG1æ˜¯ä¸€ä¸ªå¹¶è¡Œå›æ”¶å™¨ï¼Œå®ƒæŠŠå †å†…å­˜åˆ†å‰²ä¸ºå¾ˆå¤šä¸ç›¸å…³çš„åŒºåŸŸï¼ˆRegionï¼‰ï¼ˆç‰©ç†ä¸Šä¸è¿ç»­çš„ï¼‰ã€‚ä½¿ç”¨ä¸åŒçš„Regionæ¥è¡¨ç¤ºEdenã€å¹¸å­˜è€…0åŒºï¼Œå¹¸å­˜è€…1åŒºï¼Œè€å¹´ä»£ç­‰ã€‚

G1 GCæœ‰è®¡åˆ’åœ°é¿å…åœ¨æ•´ä¸ªJavaå †ä¸­è¿›è¡Œå…¨åŒºåŸŸçš„åƒåœ¾æ”¶é›†ã€‚G1è·Ÿè¸ªå„ä¸ªRegioné‡Œé¢çš„åƒåœ¾å †ç§¯çš„ä»·å€¼å¤§å°ï¼ˆå›æ”¶æ‰€è·å¾—çš„ç©ºé—´å¤§å°ä»¥åŠå›æ”¶æ‰€éœ€æ—¶é—´çš„ç»éªŒå€¼ï¼‰ï¼Œ***åœ¨åå°ç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆåˆ—è¡¨ï¼Œæ¯æ¬¡æ ¹æ®å…è®¸çš„æ”¶é›†æ—¶é—´ï¼Œä¼˜å…ˆå›æ”¶ä»·å€¼æœ€å¤§çš„Regionã€‚***

ç”±äºè¿™ç§æ–¹å¼çš„***ä¾§é‡ç‚¹åœ¨äºå›æ”¶åƒåœ¾æœ€å¤§é‡çš„åŒºé—´ï¼ˆRegionï¼‰***ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»™G1ä¸€ä¸ªåå­—ï¼šåƒåœ¾ä¼˜å…ˆï¼ˆGarbage Firstï¼‰ã€‚

***G1ï¼ˆGarbage-Firstï¼‰æ˜¯ä¸€æ¬¾é¢å‘æœåŠ¡ç«¯åº”ç”¨çš„åƒåœ¾æ”¶é›†å™¨ï¼Œä¸»è¦é’ˆå¯¹é…å¤‡å¤šæ ¸CPUåŠå¤§å®¹é‡å†…å­˜çš„æœºå™¨ï¼Œ***ä»¥æé«˜æ¦‚ç‡æ»¡è¶³GCåœé¡¿æ—¶é—´çš„åŒæ—¶ï¼Œè¿˜å…¼å…·é«˜ååé‡çš„æ€§èƒ½ç‰¹å¾ã€‚

***åœ¨JDK1.7ç‰ˆæœ¬æ­£å¼å¯ç”¨ï¼Œç§»é™¤äº†Experimental çš„æ ‡è¯†ï¼Œæ˜¯JDK9ä»¥åçš„é»˜è®¤åƒåœ¾å›æ”¶å™¨ï¼Œå–ä»£äº†CMSå›æ”¶å™¨ä»¥åŠParallel+Parallel oldç»„åˆã€‚è¢«oracleå®˜æ–¹ç§°ä¸ºâ€œå…¨åŠŸèƒ½çš„åƒåœ¾æ”¶é›†å™¨â€ã€‚***

ä¸æ­¤åŒæ—¶ï¼ŒCMSå·²ç»åœ¨JDK9ä¸­è¢«æ ‡è®°ä¸ºåºŸå¼ƒï¼ˆdeprecatedï¼‰ã€‚***åœ¨jdk8ä¸­è¿˜ä¸æ˜¯é»˜è®¤çš„åƒåœ¾å›æ”¶å™¨ï¼Œéœ€è¦ä½¿ç”¨-xxï¼š+UseG1GCæ¥å¯ç”¨ã€‚***

### G1åƒåœ¾æ”¶é›†å™¨çš„ä¼˜ç‚¹ ğŸ§

ä¸å…¶ä»–GCæ”¶é›†å™¨ç›¸æ¯”ï¼ŒG1ä½¿ç”¨äº†å…¨æ–°çš„åˆ†åŒºç®—æ³•ï¼Œå…¶ç‰¹ç‚¹å¦‚ä¸‹æ‰€ç¤ºï¼š

**å¹¶è¡Œä¸å¹¶å‘**

- å¹¶è¡Œæ€§ï¼šG1åœ¨å›æ”¶æœŸé—´ï¼Œå¯ä»¥æœ‰å¤šä¸ªGCçº¿ç¨‹åŒæ—¶å·¥ä½œï¼Œæœ‰æ•ˆåˆ©ç”¨å¤šæ ¸è®¡ç®—èƒ½åŠ›ã€‚æ­¤æ—¶ç”¨æˆ·çº¿ç¨‹STW
- å¹¶å‘æ€§ï¼šG1æ‹¥æœ‰ä¸åº”ç”¨ç¨‹åºäº¤æ›¿æ‰§è¡Œçš„èƒ½åŠ›ï¼Œéƒ¨åˆ†å·¥ä½œå¯ä»¥å’Œåº”ç”¨ç¨‹åºåŒæ—¶æ‰§è¡Œï¼Œå› æ­¤ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œä¸ä¼šåœ¨æ•´ä¸ªå›æ”¶é˜¶æ®µå‘ç”Ÿå®Œå…¨é˜»å¡åº”ç”¨ç¨‹åºçš„æƒ…å†µ

**åˆ†ä»£æ”¶é›†**

- ä»åˆ†ä»£ä¸Šçœ‹ï¼Œ***G1ä¾ç„¶å±äºåˆ†ä»£å‹åƒåœ¾å›æ”¶å™¨***ï¼Œå®ƒä¼šåŒºåˆ†å¹´è½»ä»£å’Œè€å¹´ä»£ï¼Œå¹´è½»ä»£ä¾ç„¶æœ‰EdenåŒºå’ŒSurvivoråŒºã€‚ä½†ä»å †çš„ç»“æ„ä¸Šçœ‹ï¼Œå®ƒä¸è¦æ±‚æ•´ä¸ªEdenåŒºã€å¹´è½»ä»£æˆ–è€…è€å¹´ä»£éƒ½æ˜¯è¿ç»­çš„ï¼Œä¹Ÿä¸å†åšæŒå›ºå®šå¤§å°å’Œå›ºå®šæ•°é‡ã€‚
- ***å°†å †ç©ºé—´åˆ†ä¸ºè‹¥å¹²ä¸ªåŒºåŸŸï¼ˆRegionï¼‰ï¼Œè¿™äº›åŒºåŸŸä¸­åŒ…å«äº†é€»è¾‘ä¸Šçš„å¹´è½»ä»£å’Œè€å¹´ä»£ã€‚***
- å’Œä¹‹å‰çš„å„ç±»å›æ”¶å™¨ä¸åŒï¼Œ***å®ƒåŒæ—¶å…¼é¡¾å¹´è½»ä»£å’Œè€å¹´ä»£***ã€‚å¯¹æ¯”å…¶ä»–å›æ”¶å™¨ï¼Œæˆ–è€…å·¥ä½œåœ¨å¹´è½»ä»£ï¼Œæˆ–è€…å·¥ä½œåœ¨è€å¹´ä»£ï¼›

G1æ‰€è°“çš„åˆ†ä»£ï¼Œå·²ç»ä¸æ˜¯ä¸‹é¢è¿™æ ·çš„äº†

![image-20200713215105293](/assets/imgs/image-20200713215105293.png)

è€Œæ˜¯è¿™æ ·çš„ä¸€ä¸ªåŒºåŸŸ

![image-20200713215133839](/assets/imgs/image-20200713215133839.png)

**ç©ºé—´æ•´åˆ**

- CMSï¼šâ€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ã€å†…å­˜ç¢ç‰‡ã€è‹¥å¹²æ¬¡Gcåè¿›è¡Œä¸€æ¬¡ç¢ç‰‡æ•´ç†
- G1å°†å†…å­˜åˆ’åˆ†ä¸ºä¸€ä¸ªä¸ªçš„regionã€‚å†…å­˜çš„å›æ”¶æ˜¯ä»¥regionä½œä¸ºåŸºæœ¬å•ä½çš„ã€‚***Regionä¹‹é—´æ˜¯å¤åˆ¶ç®—æ³•ï¼Œä½†æ•´ä½“ä¸Šå®é™…å¯çœ‹ä½œæ˜¯æ ‡è®°-å‹ç¼©ï¼ˆMark-Compactï¼‰ç®—æ³•ï¼Œ***ä¸¤ç§ç®—æ³•éƒ½å¯ä»¥é¿å…å†…å­˜ç¢ç‰‡ã€‚***è¿™ç§ç‰¹æ€§æœ‰åˆ©äºç¨‹åºé•¿æ—¶é—´è¿è¡Œï¼Œåˆ†é…å¤§å¯¹è±¡æ—¶ä¸ä¼šå› ä¸ºæ— æ³•æ‰¾åˆ°è¿ç»­å†…å­˜ç©ºé—´è€Œæå‰è§¦å‘ä¸‹ä¸€æ¬¡GCã€‚å°¤å…¶æ˜¯å½“Javaå †éå¸¸å¤§çš„æ—¶å€™ï¼ŒG1çš„ä¼˜åŠ¿æ›´åŠ æ˜æ˜¾ã€‚***

**å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼ˆå³ï¼šè½¯å®æ—¶soft real-timeï¼‰**
è¿™æ˜¯G1ç›¸å¯¹äºCMSçš„å¦ä¸€å¤§ä¼˜åŠ¿ï¼ŒG1é™¤äº†è¿½æ±‚ä½åœé¡¿å¤–ï¼Œè¿˜èƒ½å»ºç«‹å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼Œèƒ½è®©ä½¿ç”¨è€…æ˜ç¡®æŒ‡å®šåœ¨ä¸€ä¸ªé•¿åº¦ä¸ºMæ¯«ç§’çš„æ—¶é—´ç‰‡æ®µå†…ï¼Œæ¶ˆè€—åœ¨åƒåœ¾æ”¶é›†ä¸Šçš„æ—¶é—´ä¸å¾—è¶…è¿‡Næ¯«ç§’ã€‚

- ç”±äºåˆ†åŒºçš„åŸå› ï¼ŒG1å¯ä»¥åªé€‰å–éƒ¨åˆ†åŒºåŸŸè¿›è¡Œå†…å­˜å›æ”¶ï¼Œè¿™æ ·ç¼©å°äº†å›æ”¶çš„èŒƒå›´ï¼Œå› æ­¤å¯¹äºå…¨å±€åœé¡¿æƒ…å†µçš„å‘ç”Ÿä¹Ÿèƒ½å¾—åˆ°è¾ƒå¥½çš„æ§åˆ¶ã€‚
- G1è·Ÿè¸ªå„ä¸ªRegioné‡Œé¢çš„åƒåœ¾å †ç§¯çš„ä»·å€¼å¤§å°ï¼ˆå›æ”¶æ‰€è·å¾—çš„ç©ºé—´å¤§å°ä»¥åŠå›æ”¶æ‰€éœ€æ—¶é—´çš„ç»éªŒå€¼ï¼‰ï¼Œåœ¨åå°ç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆåˆ—è¡¨ï¼Œ***æ¯æ¬¡æ ¹æ®å…è®¸çš„æ”¶é›†æ—¶é—´ï¼Œä¼˜å…ˆå›æ”¶ä»·å€¼æœ€å¤§çš„Regionã€‚ä¿è¯äº†G1æ”¶é›†å™¨åœ¨æœ‰é™çš„æ—¶é—´å†…å¯ä»¥è·å–å°½å¯èƒ½é«˜çš„æ”¶é›†æ•ˆç‡ã€‚***
- ç›¸æ¯”äºCMSGCï¼ŒG1æœªå¿…èƒ½åšåˆ°CMSåœ¨æœ€å¥½æƒ…å†µä¸‹çš„å»¶æ—¶åœé¡¿ï¼Œä½†æ˜¯æœ€å·®æƒ…å†µè¦å¥½å¾ˆå¤šã€‚

### G1åƒåœ¾æ”¶é›†å™¨çš„ç¼ºç‚¹

ç›¸è¾ƒäºCMSï¼ŒG1è¿˜ä¸å…·å¤‡å…¨æ–¹ä½ã€å‹å€’æ€§ä¼˜åŠ¿ã€‚æ¯”å¦‚***åœ¨ç”¨æˆ·ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒG1æ— è®ºæ˜¯ä¸ºäº†åƒåœ¾æ”¶é›†äº§ç”Ÿçš„å†…å­˜å ç”¨ï¼ˆFootprintï¼‰è¿˜æ˜¯ç¨‹åºè¿è¡Œæ—¶çš„é¢å¤–æ‰§è¡Œè´Ÿè½½ï¼ˆoverloadï¼‰éƒ½è¦æ¯”CMSè¦é«˜ã€‚***

***ä»ç»éªŒä¸Šæ¥è¯´ï¼Œåœ¨å°å†…å­˜åº”ç”¨ä¸ŠCMSçš„è¡¨ç°å¤§æ¦‚ç‡ä¼šä¼˜äºG1ï¼Œè€ŒG1åœ¨å¤§å†…å­˜åº”ç”¨ä¸Šåˆ™å‘æŒ¥å…¶ä¼˜åŠ¿ã€‚å¹³è¡¡ç‚¹åœ¨6-8GBä¹‹é—´ã€‚***

### G1å‚æ•°è®¾ç½®

- ***-XX:+UseG1GC æ‰‹åŠ¨æŒ‡å®šä½¿ç”¨G1åƒåœ¾æ”¶é›†å™¨æ‰§è¡Œå†…å­˜å›æ”¶ä»»åŠ¡***
- ***-XX:G1HeapRegionSize è®¾ç½®æ¯ä¸ªRegionçš„å¤§å°ã€‚å€¼æ˜¯2çš„å¹‚ï¼ŒèŒƒå›´æ˜¯1MBåˆ°32MBä¹‹é—´ï¼Œç›®æ ‡æ˜¯æ ¹æ®æœ€å°çš„Javaå †å¤§å°åˆ’åˆ†å‡ºçº¦2048ä¸ªåŒºåŸŸã€‚é»˜è®¤æ˜¯å †å†…å­˜çš„1/2000ã€‚***
- ***-XX:MaxGCPauseMillis è®¾ç½®æœŸæœ›è¾¾åˆ°çš„æœ€å¤§Gcåœé¡¿æ—¶é—´æŒ‡æ ‡ï¼ˆJVMä¼šå°½åŠ›å®ç°ï¼Œä½†ä¸ä¿è¯è¾¾åˆ°ï¼‰ã€‚é»˜è®¤å€¼æ˜¯200ms***
- -XX:+ParallelGcThread è®¾ç½®STWå·¥ä½œçº¿ç¨‹æ•°çš„å€¼ã€‚æœ€å¤šè®¾ç½®ä¸º8
- -XX:ConcGCThreads è®¾ç½®å¹¶å‘æ ‡è®°çš„çº¿ç¨‹æ•°ã€‚å°†nè®¾ç½®ä¸ºå¹¶è¡Œåƒåœ¾å›æ”¶çº¿ç¨‹æ•°ï¼ˆParallelGcThreadsï¼‰çš„1/4å·¦å³ã€‚
- -XX:InitiatingHeapoccupancyPercent è®¾ç½®è§¦å‘å¹¶å‘Gcå‘¨æœŸçš„Javaå †å ç”¨ç‡é˜ˆå€¼ã€‚è¶…è¿‡æ­¤å€¼ï¼Œå°±è§¦å‘GCã€‚é»˜è®¤å€¼æ˜¯45ã€‚

### G1æ”¶é›†å™¨çš„å¸¸è§æ“ä½œæ­¥éª¤ ğŸ§

***G1çš„è®¾è®¡åŸåˆ™å°±æ˜¯ç®€åŒ–JVMæ€§èƒ½è°ƒä¼˜ï¼Œå¼€å‘äººå‘˜åªéœ€è¦ç®€å•çš„ä¸‰æ­¥å³å¯å®Œæˆè°ƒä¼˜ï¼š***

- ***ç¬¬ä¸€æ­¥ï¼šå¼€å¯G1åƒåœ¾æ”¶é›†å™¨***
- ***ç¬¬äºŒæ­¥ï¼šè®¾ç½®å †çš„æœ€å¤§å†…å­˜***
- ***ç¬¬ä¸‰æ­¥ï¼šè®¾ç½®æœ€å¤§çš„åœé¡¿æ—¶é—´***

***G1ä¸­æä¾›äº†ä¸‰ç§åƒåœ¾å›æ”¶æ¨¡å¼ï¼šYoungGCã€Mixed GCå’ŒFu11GCï¼Œåœ¨ä¸åŒçš„æ¡ä»¶ä¸‹è¢«è§¦å‘ã€‚***

### G1æ”¶é›†å™¨çš„é€‚ç”¨åœºæ™¯

***é¢å‘æœåŠ¡ç«¯åº”ç”¨ï¼Œé’ˆå¯¹å…·æœ‰å¤§å†…å­˜ã€å¤šå¤„ç†å™¨çš„æœºå™¨ã€‚ï¼ˆåœ¨æ™®é€šå¤§å°çš„å †é‡Œè¡¨ç°å¹¶ä¸æƒŠå–œï¼‰***

æœ€ä¸»è¦çš„åº”ç”¨æ˜¯***éœ€è¦ä½GCå»¶è¿Ÿï¼Œå¹¶å…·æœ‰å¤§å †çš„åº”ç”¨ç¨‹åº***æä¾›è§£å†³æ–¹æ¡ˆï¼›

å¦‚ï¼šåœ¨å †å¤§å°çº¦6GBæˆ–æ›´å¤§æ—¶ï¼Œå¯é¢„æµ‹çš„æš‚åœæ—¶é—´å¯ä»¥ä½äº0.5ç§’ï¼›ï¼ˆG1é€šè¿‡æ¯æ¬¡åªæ¸…ç†ä¸€éƒ¨åˆ†è€Œä¸æ˜¯å…¨éƒ¨çš„Regionçš„å¢é‡å¼æ¸…ç†æ¥ä¿è¯æ¯æ¬¡Gcåœé¡¿æ—¶é—´ä¸ä¼šè¿‡é•¿ï¼‰ã€‚
ç”¨æ¥æ›¿æ¢æ‰JDK1.5ä¸­çš„CMSæ”¶é›†å™¨ï¼›***åœ¨ä¸‹é¢çš„æƒ…å†µæ—¶ï¼Œä½¿ç”¨G1å¯èƒ½æ¯”CMSå¥½ï¼š***

- ***è¶…è¿‡50%çš„Javaå †è¢«æ´»åŠ¨æ•°æ®å ç”¨ï¼›***
- ***å¯¹è±¡åˆ†é…é¢‘ç‡æˆ–å¹´ä»£æå‡é¢‘ç‡å˜åŒ–å¾ˆå¤§ï¼›***
- ***GCåœé¡¿æ—¶é—´è¿‡é•¿ï¼ˆé•¿äº0.5è‡³1ç§’ï¼‰***

HotSpotåƒåœ¾æ”¶é›†å™¨é‡Œï¼Œé™¤äº†G1ä»¥å¤–ï¼Œå…¶ä»–çš„åƒåœ¾æ”¶é›†å™¨ä½¿ç”¨å†…ç½®çš„JVMçº¿ç¨‹æ‰§è¡ŒGcçš„å¤šçº¿ç¨‹æ“ä½œï¼Œ***è€ŒG1 GCå¯ä»¥é‡‡ç”¨åº”ç”¨çº¿ç¨‹æ‰¿æ‹…åå°è¿è¡Œçš„GCå·¥ä½œï¼Œå³å½“JVMçš„GCçº¿ç¨‹å¤„ç†é€Ÿåº¦æ…¢æ—¶ï¼Œç³»ç»Ÿä¼šè°ƒç”¨åº”ç”¨ç¨‹åºçº¿ç¨‹å¸®åŠ©åŠ é€Ÿåƒåœ¾å›æ”¶è¿‡ç¨‹ã€‚***

### åˆ†åŒºRegionï¼šåŒ–æ•´ä¸ºé›¶

ä½¿ç”¨G1æ”¶é›†å™¨æ—¶ï¼Œå®ƒå°†æ•´ä¸ªJavaå †åˆ’åˆ†æˆçº¦2048ä¸ªå¤§å°ç›¸åŒçš„ç‹¬ç«‹Regionå—ï¼Œæ¯ä¸ªRegionå—å¤§å°æ ¹æ®å †ç©ºé—´çš„å®é™…å¤§å°è€Œå®šï¼Œæ•´ä½“è¢«æ§åˆ¶åœ¨1MBåˆ°32MBä¹‹é—´ï¼Œä¸”ä¸º2çš„Næ¬¡å¹‚ï¼Œå³1MBï¼Œ2MBï¼Œ4MBï¼Œ8MBï¼Œ16MBï¼Œ32MBã€‚å¯ä»¥é€šè¿‡-XX:G1HeapRegionsizeè®¾å®šã€‚***æ‰€æœ‰çš„Regionå¤§å°ç›¸åŒï¼Œä¸”åœ¨JVMç”Ÿå‘½å‘¨æœŸå†…ä¸ä¼šè¢«æ”¹å˜ã€‚***

è™½ç„¶è¿˜ä¿ç•™æœ‰æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¦‚å¿µï¼Œä½†æ–°ç”Ÿä»£å’Œè€å¹´ä»£ä¸å†æ˜¯ç‰©ç†éš”ç¦»çš„äº†ï¼Œå®ƒä»¬éƒ½æ˜¯ä¸€éƒ¨åˆ†Regionï¼ˆä¸éœ€è¦è¿ç»­ï¼‰çš„é›†åˆã€‚é€šè¿‡Regionçš„åŠ¨æ€åˆ†é…æ–¹å¼å®ç°é€»è¾‘ä¸Šçš„è¿ç»­ã€‚

![image-20200713223244886](/assets/imgs/image-20200713223244886.png)

ä¸€ä¸ªregionæœ‰å¯èƒ½å±äºEdenï¼ŒSurvivoræˆ–è€…old/Tenuredå†…å­˜åŒºåŸŸã€‚ä½†æ˜¯ä¸€ä¸ªregionåªå¯èƒ½å±äºä¸€ä¸ªè§’è‰²ã€‚å›¾ä¸­çš„Eè¡¨ç¤ºè¯¥regionå±äºEdenå†…å­˜åŒºåŸŸï¼Œsè¡¨ç¤ºå±äºsurvivorå†…å­˜åŒºåŸŸï¼Œoè¡¨ç¤ºå±äº01då†…å­˜åŒºåŸŸã€‚å›¾ä¸­ç©ºç™½çš„è¡¨ç¤ºæœªä½¿ç”¨çš„å†…å­˜ç©ºé—´ã€‚

G1åƒåœ¾æ”¶é›†å™¨è¿˜å¢åŠ äº†ä¸€ç§æ–°çš„å†…å­˜åŒºåŸŸï¼Œå«åšHumongouså†…å­˜åŒºåŸŸï¼Œå¦‚å›¾ä¸­çš„Hå—ã€‚***ä¸»è¦ç”¨äºå­˜å‚¨å¤§å¯¹è±¡ï¼Œå¦‚æœè¶…è¿‡1.5ä¸ªregionï¼Œå°±æ”¾åˆ°Hã€‚***

**è®¾ç½®Hçš„åŸå› ï¼š**å¯¹äºå †ä¸­çš„å¯¹è±¡ï¼Œé»˜è®¤ç›´æ¥ä¼šè¢«åˆ†é…åˆ°è€å¹´ä»£ï¼Œä½†æ˜¯å¦‚æœå®ƒæ˜¯ä¸€ä¸ªçŸ­æœŸå­˜åœ¨çš„å¤§å¯¹è±¡å°±ä¼šå¯¹åƒåœ¾æ”¶é›†å™¨é€ æˆè´Ÿé¢å½±å“ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒG1åˆ’åˆ†äº†ä¸€ä¸ªHumongousåŒºï¼Œå®ƒç”¨æ¥ä¸“é—¨å­˜æ”¾å¤§å¯¹è±¡ã€‚***å¦‚æœä¸€ä¸ªHåŒºè£…ä¸ä¸‹ä¸€ä¸ªå¤§å¯¹è±¡ï¼Œé‚£ä¹ˆG1ä¼šå¯»æ‰¾è¿ç»­çš„HåŒºæ¥å­˜å‚¨ã€‚ä¸ºäº†èƒ½æ‰¾åˆ°è¿ç»­çš„HåŒºï¼Œæœ‰æ—¶å€™ä¸å¾—ä¸å¯åŠ¨Full Gcã€‚G1çš„å¤§å¤šæ•°è¡Œä¸ºéƒ½æŠŠHåŒºä½œä¸ºè€å¹´ä»£çš„ä¸€éƒ¨åˆ†æ¥çœ‹å¾…ã€‚***

æ¯ä¸ªRegionéƒ½æ˜¯é€šè¿‡***æŒ‡é’ˆç¢°æ’***æ¥åˆ†é…ç©ºé—´

![image-20200713223509993](/assets/imgs/image-20200713223509993.png)

### G1åƒåœ¾å›æ”¶å™¨çš„å›æ”¶è¿‡ç¨‹

***G1 GCçš„åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸»è¦åŒ…æ‹¬å¦‚ä¸‹ä¸‰ä¸ªç¯èŠ‚ï¼š***

- ***å¹´è½»ä»£GCï¼ˆYoung GCï¼‰***
- ***è€å¹´ä»£å¹¶å‘æ ‡è®°è¿‡ç¨‹ï¼ˆConcurrent Markingï¼‰***
- ***æ··åˆå›æ”¶ï¼ˆMixed GCï¼‰***

***ï¼ˆå¦‚æœéœ€è¦ï¼Œå•çº¿ç¨‹ã€ç‹¬å å¼ã€é«˜å¼ºåº¦çš„Full GCè¿˜æ˜¯ç»§ç»­å­˜åœ¨çš„ã€‚å®ƒé’ˆå¯¹GCçš„è¯„ä¼°å¤±è´¥æä¾›äº†ä¸€ç§å¤±è´¥ä¿æŠ¤æœºåˆ¶ï¼Œå³å¼ºåŠ›å›æ”¶ã€‚ï¼‰***

![image-20200713224113996](/assets/imgs/image-20200713224113996.png)

***é¡ºæ—¶é’ˆï¼Œyoung gc->young gc+concurrent mark->Mixed GCé¡ºåºï¼Œè¿›è¡Œåƒåœ¾å›æ”¶ã€‚***

1. åº”ç”¨ç¨‹åºåˆ†é…å†…å­˜ï¼Œ***å½“å¹´è½»ä»£çš„EdenåŒºç”¨å°½æ—¶å¼€å§‹å¹´è½»ä»£å›æ”¶è¿‡ç¨‹***ï¼›G1çš„å¹´è½»ä»£æ”¶é›†é˜¶æ®µæ˜¯ä¸€ä¸ªå¹¶è¡Œçš„ç‹¬å å¼æ”¶é›†å™¨ã€‚åœ¨å¹´è½»ä»£å›æ”¶æœŸï¼ŒG1GCæš‚åœæ‰€æœ‰åº”ç”¨ç¨‹åºçº¿ç¨‹ï¼Œå¯åŠ¨å¤šçº¿ç¨‹æ‰§è¡Œå¹´è½»ä»£å›æ”¶ã€‚***ç„¶åä»å¹´è½»ä»£åŒºé—´ç§»åŠ¨å­˜æ´»å¯¹è±¡åˆ°SurvivoråŒºé—´æˆ–è€…è€å¹´åŒºé—´ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ä¸¤ä¸ªåŒºé—´éƒ½ä¼šæ¶‰åŠã€‚***

2. å½“å †å†…å­˜ä½¿ç”¨è¾¾åˆ°ä¸€å®šå€¼ï¼ˆé»˜è®¤45%ï¼‰æ—¶ï¼Œå¼€å§‹è€å¹´ä»£å¹¶å‘æ ‡è®°è¿‡ç¨‹ã€‚

3. æ ‡è®°å®Œæˆé©¬ä¸Šå¼€å§‹æ··åˆå›æ”¶è¿‡ç¨‹ã€‚å¯¹äºä¸€ä¸ªæ··åˆå›æ”¶æœŸï¼ŒG1 GCä»è€å¹´åŒºé—´ç§»åŠ¨å­˜æ´»å¯¹è±¡åˆ°ç©ºé—²åŒºé—´ï¼Œè¿™äº›ç©ºé—²åŒºé—´ä¹Ÿå°±æˆä¸ºäº†è€å¹´ä»£çš„ä¸€éƒ¨åˆ†ã€‚å’Œå¹´è½»ä»£ä¸åŒï¼Œè€å¹´ä»£çš„G1å›æ”¶å™¨å’Œå…¶ä»–GCä¸åŒï¼Œ***G1çš„è€å¹´ä»£å›æ”¶å™¨ä¸éœ€è¦æ•´ä¸ªè€å¹´ä»£è¢«å›æ”¶ï¼Œä¸€æ¬¡åªéœ€è¦æ‰«æ/å›æ”¶ä¸€å°éƒ¨åˆ†è€å¹´ä»£çš„Regionå°±å¯ä»¥äº†***ã€‚åŒæ—¶ï¼Œè¿™ä¸ªè€å¹´ä»£Regionæ˜¯å’Œå¹´è½»ä»£ä¸€èµ·è¢«å›æ”¶çš„ã€‚

ğŸ§ ä¸¾ä¸ªä¾‹å­ï¼šä¸€ä¸ªWebæœåŠ¡å™¨ï¼ŒJavaè¿›ç¨‹æœ€å¤§å †å†…å­˜ä¸º4Gï¼Œæ¯åˆ†é’Ÿå“åº”1500ä¸ªè¯·æ±‚ï¼Œæ¯45ç§’é’Ÿä¼šæ–°åˆ†é…å¤§çº¦2Gçš„å†…å­˜ã€‚G1ä¼šæ¯45ç§’é’Ÿè¿›è¡Œä¸€æ¬¡å¹´è½»ä»£å›æ”¶ï¼Œæ¯31ä¸ªå°æ—¶æ•´ä¸ªå †çš„ä½¿ç”¨ç‡ä¼šè¾¾åˆ°45%ï¼Œä¼šå¼€å§‹è€å¹´ä»£å¹¶å‘æ ‡è®°è¿‡ç¨‹ï¼Œæ ‡è®°å®Œæˆåå¼€å§‹å››åˆ°äº”æ¬¡çš„æ··åˆå›æ”¶ã€‚

#### Remembered Setï¼ˆè®°å¿†é›†ï¼‰

***ä¸€ä¸ªå¯¹è±¡è¢«ä¸åŒåŒºåŸŸå¼•ç”¨çš„é—®é¢˜***

ä¸€ä¸ªRegionä¸å¯èƒ½æ˜¯å­¤ç«‹çš„ï¼Œä¸€ä¸ªRegionä¸­çš„å¯¹è±¡å¯èƒ½è¢«å…¶ä»–ä»»æ„Regionä¸­å¯¹è±¡å¼•ç”¨ï¼Œåˆ¤æ–­å¯¹è±¡å­˜æ´»æ—¶ï¼Œæ˜¯å¦éœ€è¦æ‰«ææ•´ä¸ªJavaå †æ‰èƒ½ä¿è¯å‡†ç¡®ï¼Ÿ

åœ¨å…¶ä»–çš„åˆ†ä»£æ”¶é›†å™¨ï¼Œä¹Ÿå­˜åœ¨è¿™æ ·çš„é—®é¢˜ï¼ˆè€ŒG1æ›´çªå‡ºï¼‰å›æ”¶æ–°ç”Ÿä»£ä¹Ÿä¸å¾—ä¸åŒæ—¶æ‰«æè€å¹´ä»£ï¼Ÿè¿™æ ·çš„è¯ä¼šé™ä½MinorGCçš„æ•ˆç‡ï¼›

**è§£å†³æ–¹æ³•ï¼š**

- æ— è®ºG1è¿˜æ˜¯å…¶ä»–åˆ†ä»£æ”¶é›†å™¨ï¼ŒJVMéƒ½æ˜¯ä½¿ç”¨Remembered Setæ¥***é¿å…å…¨å±€æ‰«æï¼š***

- ***æ¯ä¸ªRegionéƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„Remembered Set***ï¼›

- æ¯æ¬¡Referenceç±»å‹æ•°æ®å†™æ“ä½œæ—¶ï¼Œéƒ½ä¼šäº§ç”Ÿä¸€ä¸ªWrite Barrieræš‚æ—¶ä¸­æ–­æ“ä½œï¼›

- ç„¶åæ£€æŸ¥å°†è¦å†™å…¥çš„å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡æ˜¯å¦å’Œè¯¥Referenceç±»å‹æ•°æ®åœ¨ä¸åŒçš„Regionï¼ˆå…¶ä»–æ”¶é›†å™¨ï¼šæ£€æŸ¥è€å¹´ä»£å¯¹è±¡æ˜¯å¦å¼•ç”¨äº†æ–°ç”Ÿä»£å¯¹è±¡ï¼‰ï¼›

- å¦‚æœä¸åŒï¼Œé€šè¿‡cardTableæŠŠç›¸å…³å¼•ç”¨ä¿¡æ¯è®°å½•åˆ°å¼•ç”¨æŒ‡å‘å¯¹è±¡çš„æ‰€åœ¨Regionå¯¹åº”çš„Remembered Setä¸­ï¼›

- å½“è¿›è¡Œåƒåœ¾æ”¶é›†æ—¶ï¼Œåœ¨GCæ ¹èŠ‚ç‚¹çš„æšä¸¾èŒƒå›´åŠ å…¥Remembered Setï¼›å°±å¯ä»¥ä¿è¯ä¸è¿›è¡Œå…¨å±€æ‰«æï¼Œä¹Ÿä¸ä¼šæœ‰é—æ¼ã€‚

![image-20200713224716715](/assets/imgs/image-20200713224716715.png)

#### G1å›æ”¶è¿‡ç¨‹1-å¹´è½»ä»£GC

JVMå¯åŠ¨æ—¶ï¼ŒG1å…ˆå‡†å¤‡å¥½EdenåŒºï¼Œç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ä¸æ–­åˆ›å»ºå¯¹è±¡åˆ°EdenåŒºï¼Œ***å½“Edenç©ºé—´è€—å°½æ—¶ï¼ŒG1ä¼šå¯åŠ¨ä¸€æ¬¡å¹´è½»ä»£åƒåœ¾å›æ”¶è¿‡ç¨‹ã€‚***

***å¹´è½»ä»£åƒåœ¾å›æ”¶åªä¼šå›æ”¶EdenåŒºå’ŒSurvivoråŒºã€‚***

YGCæ—¶ï¼Œé¦–å…ˆG1åœæ­¢åº”ç”¨ç¨‹åºçš„æ‰§è¡Œï¼ˆStop-The-Worldï¼‰ï¼ŒG1åˆ›å»ºå›æ”¶é›†ï¼ˆCollection Setï¼‰ï¼Œå›æ”¶é›†æ˜¯æŒ‡éœ€è¦è¢«å›æ”¶çš„å†…å­˜åˆ†æ®µçš„é›†åˆï¼Œå¹´è½»ä»£å›æ”¶è¿‡ç¨‹çš„å›æ”¶é›†åŒ…å«å¹´è½»ä»£EdenåŒºå’ŒSurvivoråŒºæ‰€æœ‰çš„å†…å­˜åˆ†æ®µã€‚

![image-20200713225100632](/assets/imgs/image-20200713225100632.png)

ç„¶åå¼€å§‹å¦‚ä¸‹å›æ”¶è¿‡ç¨‹ï¼š

1. ***ç¬¬ä¸€é˜¶æ®µï¼Œæ‰«ææ ¹***

   æ ¹æ˜¯æŒ‡staticå˜é‡æŒ‡å‘çš„å¯¹è±¡ï¼Œæ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•è°ƒç”¨é“¾æ¡ä¸Šçš„å±€éƒ¨å˜é‡ç­‰ã€‚æ ¹å¼•ç”¨è¿åŒRSetè®°å½•çš„å¤–éƒ¨å¼•ç”¨ä½œä¸ºæ‰«æå­˜æ´»å¯¹è±¡çš„å…¥å£ã€‚

2. ***ç¬¬äºŒé˜¶æ®µï¼Œæ›´æ–°RSet***

   å¤„ç†***dirty card queueï¼ˆè§å¤‡æ³¨ï¼‰ä¸­çš„cardï¼Œæ›´æ–°RSet***ã€‚***æ­¤é˜¶æ®µå®Œæˆåï¼ŒRSetå¯ä»¥å‡†ç¡®çš„åæ˜ è€å¹´ä»£å¯¹æ‰€åœ¨çš„å†…å­˜åˆ†æ®µä¸­å¯¹è±¡çš„å¼•ç”¨ã€‚***

3. ***ç¬¬ä¸‰é˜¶æ®µï¼Œå¤„ç†RSet***

   è¯†åˆ«è¢«è€å¹´ä»£å¯¹è±¡æŒ‡å‘çš„Edenä¸­çš„å¯¹è±¡ï¼Œè¿™äº›è¢«æŒ‡å‘çš„Edenä¸­çš„å¯¹è±¡è¢«è®¤ä¸ºæ˜¯å­˜æ´»çš„å¯¹è±¡ã€‚

4. ***ç¬¬å››é˜¶æ®µï¼Œå¤åˆ¶å¯¹è±¡ã€‚***

   æ­¤é˜¶æ®µï¼Œå¯¹è±¡æ ‘è¢«éå†ï¼ŒEdenåŒºå†…å­˜æ®µä¸­å­˜æ´»çš„å¯¹è±¡ä¼šè¢«å¤åˆ¶åˆ°SurvivoråŒºä¸­ç©ºçš„å†…å­˜åˆ†æ®µï¼ŒSurvivoråŒºå†…å­˜æ®µä¸­å­˜æ´»çš„å¯¹è±¡å¦‚æœå¹´é¾„æœªè¾¾é˜ˆå€¼ï¼Œå¹´é¾„ä¼šåŠ 1ï¼Œè¾¾åˆ°é˜€å€¼ä¼šè¢«ä¼šè¢«å¤åˆ¶åˆ°oldåŒºä¸­ç©ºçš„å†…å­˜åˆ†æ®µã€‚å¦‚æœSurvivorç©ºé—´ä¸å¤Ÿï¼ŒEdenç©ºé—´çš„éƒ¨åˆ†æ•°æ®ä¼šç›´æ¥æ™‹å‡åˆ°è€å¹´ä»£ç©ºé—´ã€‚

5. ***ç¬¬äº”é˜¶æ®µï¼Œå¤„ç†å¼•ç”¨***

   å¤„ç†Softï¼ŒWeakï¼ŒPhantomï¼ŒFinalï¼ŒJNI Weak ç­‰å¼•ç”¨ã€‚***æœ€ç»ˆEdenç©ºé—´ï¼ˆLinkedListï¼‰çš„æ•°æ®ä¸ºç©ºï¼ŒGCåœæ­¢å·¥ä½œï¼Œè€Œç›®æ ‡å†…å­˜ä¸­çš„å¯¹è±¡éƒ½æ˜¯è¿ç»­å­˜å‚¨çš„ï¼Œæ²¡æœ‰ç¢ç‰‡ï¼Œæ‰€ä»¥å¤åˆ¶è¿‡ç¨‹å¯ä»¥è¾¾åˆ°å†…å­˜æ•´ç†çš„æ•ˆæœï¼Œå‡å°‘ç¢ç‰‡ã€‚***

#### G1å›æ”¶è¿‡ç¨‹2-å¹¶å‘æ ‡è®°è¿‡ç¨‹

> ä¸»è¦é’ˆå¯¹è€å¹´ä»£

1. ***åˆå§‹æ ‡è®°é˜¶æ®µ***ï¼šæ ‡è®°ä»æ ¹èŠ‚ç‚¹ç›´æ¥å¯è¾¾çš„å¯¹è±¡ã€‚è¿™ä¸ªé˜¶æ®µæ˜¯sTwçš„ï¼Œå¹¶ä¸”ä¼šè§¦å‘ä¸€æ¬¡å¹´è½»ä»£GCã€‚\
2. ***æ ¹åŒºåŸŸæ‰«æï¼ˆRoot Region Scanningï¼‰***ï¼šG1 Gcæ‰«æsurvivoråŒºç›´æ¥å¯è¾¾çš„è€å¹´ä»£åŒºåŸŸå¯¹è±¡ï¼Œå¹¶æ ‡è®°è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚è¿™ä¸€è¿‡ç¨‹å¿…é¡»åœ¨youngGCä¹‹å‰å®Œæˆã€‚
3. ***å¹¶å‘æ ‡è®°ï¼ˆConcurrent Markingï¼‰***ï¼šåœ¨æ•´ä¸ªå †ä¸­è¿›è¡Œå¹¶å‘æ ‡è®°ï¼ˆå’Œåº”ç”¨ç¨‹åºå¹¶å‘æ‰§è¡Œï¼‰ï¼Œæ­¤è¿‡ç¨‹å¯èƒ½è¢«youngGCä¸­æ–­ã€‚åœ¨å¹¶å‘æ ‡è®°é˜¶æ®µï¼Œ***è‹¥å‘ç°åŒºåŸŸå¯¹è±¡ä¸­çš„æ‰€æœ‰å¯¹è±¡éƒ½æ˜¯åƒåœ¾ï¼Œé‚£è¿™ä¸ªåŒºåŸŸä¼šè¢«ç«‹å³å›æ”¶***ã€‚åŒæ—¶ï¼Œå¹¶å‘æ ‡è®°è¿‡ç¨‹ä¸­ï¼Œä¼šè®¡ç®—æ¯ä¸ªåŒºåŸŸçš„å¯¹è±¡æ´»æ€§ï¼ˆåŒºåŸŸä¸­å­˜æ´»å¯¹è±¡çš„æ¯”ä¾‹ï¼‰ã€‚
4. ***å†æ¬¡æ ‡è®°ï¼ˆRemarkï¼‰***ï¼šç”±äºåº”ç”¨ç¨‹åºæŒç»­è¿›è¡Œï¼Œéœ€è¦ä¿®æ­£ä¸Šä¸€æ¬¡çš„æ ‡è®°ç»“æœã€‚æ˜¯STWçš„ã€‚G1ä¸­é‡‡ç”¨äº†æ¯”CMSæ›´å¿«çš„åˆå§‹å¿«ç…§ç®—æ³•ï¼šsnapshot-at-the-beginningï¼ˆSATBï¼‰ã€‚
5. ***ç‹¬å æ¸…ç†ï¼ˆcleanupï¼ŒSTWï¼‰***ï¼šè®¡ç®—å„ä¸ªåŒºåŸŸçš„å­˜æ´»å¯¹è±¡å’ŒGCå›æ”¶æ¯”ä¾‹ï¼Œå¹¶è¿›è¡Œæ’åºï¼Œè¯†åˆ«å¯ä»¥æ··åˆå›æ”¶çš„åŒºåŸŸã€‚ä¸ºä¸‹é˜¶æ®µåšé“ºå«ã€‚æ˜¯sTwçš„ã€‚è¿™ä¸ªé˜¶æ®µå¹¶ä¸ä¼šå®é™…ä¸Šå»åšåƒåœ¾çš„æ”¶é›†
6. ***å¹¶å‘æ¸…ç†é˜¶æ®µ***ï¼šè¯†åˆ«å¹¶æ¸…ç†å®Œå…¨ç©ºé—²çš„åŒºåŸŸã€‚

#### G1å›æ”¶è¿‡ç¨‹3 - æ··åˆå›æ”¶

å½“è¶Šæ¥è¶Šå¤šçš„å¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£old regionæ—¶ï¼Œä¸ºäº†é¿å…å †å†…å­˜è¢«è€—å°½ï¼Œè™šæ‹Ÿæœºä¼šè§¦å‘ä¸€ä¸ªæ··åˆçš„åƒåœ¾æ”¶é›†å™¨ï¼Œå³Mixed GCï¼Œè¯¥ç®—æ³•å¹¶ä¸æ˜¯ä¸€ä¸ªold GCï¼Œ***é™¤äº†å›æ”¶æ•´ä¸ªYoung Regionï¼Œè¿˜ä¼šå›æ”¶ä¸€éƒ¨åˆ†çš„old Regionã€‚***è¿™é‡Œéœ€è¦***æ³¨æ„ï¼šæ˜¯ä¸€éƒ¨åˆ†è€å¹´ä»£ï¼Œè€Œä¸æ˜¯å…¨éƒ¨è€å¹´ä»£ã€‚***å¯ä»¥é€‰æ‹©å“ªäº›old Regionè¿›è¡Œæ”¶é›†ï¼Œä»è€Œå¯ä»¥å¯¹åƒåœ¾å›æ”¶çš„è€—æ—¶æ—¶é—´è¿›è¡Œæ§åˆ¶ã€‚ä¹Ÿè¦æ³¨æ„çš„æ˜¯***Mixed GCå¹¶ä¸æ˜¯Full GCã€‚***

![image-20200713225810871](/assets/imgs/image-20200713225810871.png)

***å¹¶å‘æ ‡è®°ç»“æŸä»¥åï¼Œè€å¹´ä»£ä¸­ç™¾åˆ†ç™¾ä¸ºåƒåœ¾çš„å†…å­˜åˆ†æ®µè¢«å›æ”¶äº†ï¼Œéƒ¨åˆ†ä¸ºåƒåœ¾çš„å†…å­˜åˆ†æ®µè¢«è®¡ç®—äº†å‡ºæ¥ã€‚***é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™äº›è€å¹´ä»£çš„å†…å­˜åˆ†æ®µä¼šåˆ†8æ¬¡ï¼ˆå¯ä»¥é€šè¿‡-XX:G1MixedGCCountTargetè®¾ç½®ï¼‰è¢«å›æ”¶ã€‚

æ··åˆå›æ”¶çš„å›æ”¶é›†ï¼ˆCollection Setï¼‰åŒ…æ‹¬å…«åˆ†ä¹‹ä¸€çš„è€å¹´ä»£å†…å­˜åˆ†æ®µï¼ŒEdenåŒºå†…å­˜åˆ†æ®µï¼ŒSurvivoråŒºå†…å­˜åˆ†æ®µã€‚***æ··åˆå›æ”¶çš„ç®—æ³•å’Œå¹´è½»ä»£å›æ”¶çš„ç®—æ³•å®Œå…¨ä¸€æ ·ï¼Œåªæ˜¯å›æ”¶é›†å¤šäº†è€å¹´ä»£çš„å†…å­˜åˆ†æ®µã€‚***å…·ä½“è¿‡ç¨‹è¯·å‚è€ƒä¸Šé¢çš„å¹´è½»ä»£å›æ”¶è¿‡ç¨‹ã€‚

***ç”±äºè€å¹´ä»£ä¸­çš„å†…å­˜åˆ†æ®µé»˜è®¤åˆ†8æ¬¡å›æ”¶ï¼ŒG1ä¼šä¼˜å…ˆå›æ”¶åƒåœ¾å¤šçš„å†…å­˜åˆ†æ®µã€‚åƒåœ¾å å†…å­˜åˆ†æ®µæ¯”ä¾‹è¶Šé«˜çš„ï¼Œè¶Šä¼šè¢«å…ˆå›æ”¶ã€‚å¹¶ä¸”æœ‰ä¸€ä¸ªé˜ˆå€¼ä¼šå†³å®šå†…å­˜åˆ†æ®µæ˜¯å¦è¢«å›æ”¶ï¼Œ***

***XX:G1MixedGCLiveThresholdPercentï¼Œé»˜è®¤ä¸º65%ï¼Œæ„æ€æ˜¯åƒåœ¾å å†…å­˜åˆ†æ®µæ¯”ä¾‹è¦è¾¾åˆ°65%æ‰ä¼šè¢«å›æ”¶ã€‚***å¦‚æœåƒåœ¾å æ¯”å¤ªä½ï¼Œæ„å‘³ç€å­˜æ´»çš„å¯¹è±¡å æ¯”é«˜ï¼Œåœ¨å¤åˆ¶çš„æ—¶å€™ä¼šèŠ±è´¹æ›´å¤šçš„æ—¶é—´ã€‚

***æ··åˆå›æ”¶å¹¶ä¸ä¸€å®šè¦è¿›è¡Œ8æ¬¡ã€‚æœ‰ä¸€ä¸ªé˜ˆå€¼-XX:G1HeapWastePercentï¼Œé»˜è®¤å€¼ä¸º10%ï¼Œæ„æ€æ˜¯å…è®¸æ•´ä¸ªå †å†…å­˜ä¸­æœ‰10%çš„ç©ºé—´è¢«æµªè´¹ï¼Œ***æ„å‘³ç€å¦‚æœå‘ç°å¯ä»¥å›æ”¶çš„åƒåœ¾å å †å†…å­˜çš„æ¯”ä¾‹ä½äº10%ï¼Œåˆ™ä¸å†è¿›è¡Œæ··åˆå›æ”¶ã€‚å› ä¸ºGCä¼šèŠ±è´¹å¾ˆå¤šçš„æ—¶é—´ä½†æ˜¯å›æ”¶åˆ°çš„å†…å­˜å´å¾ˆå°‘ã€‚

#### G1å›æ”¶å¯é€‰çš„è¿‡ç¨‹4 - Full GC

G1çš„åˆè¡·å°±æ˜¯è¦é¿å…FullGCçš„å‡ºç°ã€‚ä½†æ˜¯å¦‚æœä¸Šè¿°æ–¹å¼ä¸èƒ½æ­£å¸¸å·¥ä½œï¼Œ***G1ä¼šåœæ­¢åº”ç”¨ç¨‹åºçš„æ‰§è¡Œï¼ˆStop-The-Worldï¼‰***ï¼Œä½¿ç”¨***å•çº¿ç¨‹çš„å†…å­˜å›æ”¶ç®—æ³•***è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œæ€§èƒ½ä¼šéå¸¸å·®ï¼Œåº”ç”¨ç¨‹åºåœé¡¿æ—¶é—´ä¼šå¾ˆé•¿ã€‚

è¦é¿å…Full GCçš„å‘ç”Ÿï¼Œä¸€æ—¦å‘ç”Ÿéœ€è¦è¿›è¡Œè°ƒæ•´ã€‚ä»€ä¹ˆæ—¶å€™ä¼šå‘ç”ŸFull GCå‘¢ï¼Ÿ***æ¯”å¦‚å †å†…å­˜å¤ªå°***ï¼Œå½“G1åœ¨å¤åˆ¶å­˜æ´»å¯¹è±¡çš„æ—¶å€™æ²¡æœ‰ç©ºçš„å†…å­˜åˆ†æ®µå¯ç”¨ï¼Œåˆ™ä¼šå›é€€åˆ°ful1gcï¼Œè¿™ç§æƒ…å†µå¯ä»¥é€šè¿‡å¢å¤§å†…å­˜è§£å†³ã€‚
å¯¼è‡´Full GCçš„åŸå› å¯èƒ½æœ‰ä¸¤ä¸ªï¼š

- ***Evacuationçš„æ—¶å€™æ²¡æœ‰è¶³å¤Ÿçš„to-spaceæ¥å­˜æ”¾æ™‹å‡çš„å¯¹è±¡ï¼›***
- ***å¹¶å‘å¤„ç†è¿‡ç¨‹å®Œæˆä¹‹å‰ç©ºé—´è€—å°½ã€‚***

### G1å›æ”¶çš„ä¼˜åŒ–å»ºè®®

 ä»oracleå®˜æ–¹é€éœ²å‡ºæ¥çš„ä¿¡æ¯å¯è·çŸ¥ï¼Œ***å›æ”¶é˜¶æ®µï¼ˆEvacuationï¼‰***å…¶å®æœ¬ä¹Ÿæœ‰æƒ³è¿‡è®¾è®¡æˆä¸ç”¨æˆ·ç¨‹åºä¸€èµ·å¹¶å‘æ‰§è¡Œï¼Œä½†è¿™ä»¶äº‹æƒ…åšèµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œè€ƒè™‘åˆ°G1åªæ˜¯å›ä¸€éƒ¨åˆ†Regionï¼Œ***åœé¡¿æ—¶é—´***æ˜¯ç”¨æˆ·å¯æ§åˆ¶çš„ï¼Œæ‰€ä»¥å¹¶ä¸è¿«åˆ‡å»å®ç°ï¼Œ***è€Œé€‰æ‹©æŠŠè¿™ä¸ªç‰¹æ€§æ”¾åˆ°äº†G1ä¹‹åå‡ºç°çš„ä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨ï¼ˆå³ZGCï¼‰ä¸­***ã€‚å¦å¤–ï¼Œ***è¿˜è€ƒè™‘åˆ°G1ä¸æ˜¯ä»…ä»…é¢å‘ä½å»¶è¿Ÿï¼Œåœé¡¿ç”¨æˆ·çº¿ç¨‹èƒ½å¤Ÿæœ€å¤§å¹…åº¦æé«˜åƒåœ¾æ”¶é›†æ•ˆç‡ï¼Œä¸ºäº†ä¿è¯ååé‡æ‰€ä»¥æ‰é€‰æ‹©äº†å®Œå…¨æš‚åœç”¨æˆ·çº¿ç¨‹çš„å®ç°æ–¹æ¡ˆã€‚***

***å¹´è½»ä»£å¤§å°***

- ***é¿å…ä½¿ç”¨-Xmnæˆ–-XX:NewRatioç­‰ç›¸å…³é€‰é¡¹æ˜¾å¼è®¾ç½®å¹´è½»ä»£å¤§å°ï¼Œå› ä¸ºå›ºå®šå¹´è½»ä»£(ç‹¬å å¼)çš„å¤§å°ä¼šè¦†ç›–æš‚åœæ—¶é—´ç›®æ ‡ï¼Œæœ€å¥½è®©JVMè‡ªåŠ¨å»è°ƒæ•´***

***æš‚åœæ—¶é—´ç›®æ ‡æš‚åœæ—¶é—´ç›®æ ‡ä¸è¦å¤ªè¿‡ä¸¥è‹›***

- ***G1 GCçš„ååé‡ç›®æ ‡æ˜¯90%çš„åº”ç”¨ç¨‹åºæ—¶é—´å’Œ10%çš„åƒåœ¾å›æ”¶æ—¶é—´***
- ***è¯„ä¼°G1 GCçš„ååé‡æ—¶ï¼Œæš‚åœæ—¶é—´ç›®æ ‡ä¸è¦å¤ªä¸¥è‹›ã€‚ç›®æ ‡å¤ªè¿‡ä¸¥è‹›è¡¨ç¤ºä½ æ„¿æ„æ‰¿å—æ›´å¤šçš„åƒåœ¾å›æ”¶å¼€é”€ï¼Œè€Œè¿™äº›ä¼šç›´æ¥å½±å“åˆ°ååé‡ã€‚***

## åƒåœ¾å›æ”¶å™¨æ€»ç»“ ğŸ§

æˆªæ­¢JDK1.8ï¼Œä¸€å…±æœ‰7æ¬¾ä¸åŒçš„åƒåœ¾æ”¶é›†å™¨ã€‚æ¯ä¸€æ¬¾çš„åƒåœ¾æ”¶é›†å™¨éƒ½æœ‰ä¸åŒçš„ç‰¹ç‚¹ï¼Œåœ¨å…·ä½“ä½¿ç”¨çš„æ—¶å€™ï¼Œéœ€è¦æ ¹æ®å…·ä½“çš„æƒ…å†µé€‰ç”¨ä¸åŒçš„åƒåœ¾æ”¶é›†å™¨ã€‚

![image-20200714075738203](/assets/imgs/image-20200714075738203.png)

***GCå‘å±•é˜¶æ®µï¼šSerial=> Parallelï¼ˆå¹¶è¡Œï¼‰=> CMSï¼ˆå¹¶å‘ï¼‰=> G1 => ZGC***

ä¸åŒå‚å•†ã€ä¸åŒç‰ˆæœ¬çš„è™šæ‹Ÿæœºå®ç°å·®è·æ¯”è¾ƒå¤§ã€‚HotSpotè™šæ‹Ÿæœºåœ¨JDK7/8åæ‰€æœ‰æ”¶é›†å™¨åŠç»„åˆå¦‚ä¸‹å›¾

![image-20200714080151020](/assets/imgs/image-20200714080151020.png)

***JDK7æ‰€æœ‰çº¿éƒ½å­˜åœ¨ï¼ŒJDK8ä¸­çº¢çº¿è¢«åºŸå¼ƒï¼ŒJDK9çº¢çº¿è¢«ç§»é™¤ã€‚***

***CMS GC åœ¨JDK9è¢«åºŸå¼ƒï¼ŒJDK14è¢«åºŸå¼ƒã€‚***

***JDK14ä¸­ç»¿çº¿è¢«åºŸå¼ƒã€‚***

### æ€ä¹ˆé€‰æ‹©åƒåœ¾å›æ”¶å™¨

Javaåƒåœ¾æ”¶é›†å™¨çš„é…ç½®å¯¹äºJVMä¼˜åŒ–æ¥è¯´æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„é€‰æ‹©ï¼Œé€‰æ‹©åˆé€‚çš„åƒåœ¾æ”¶é›†å™¨å¯ä»¥è®©JVMçš„æ€§èƒ½æœ‰ä¸€ä¸ªå¾ˆå¤§çš„æå‡ã€‚***æ€ä¹ˆé€‰æ‹©åƒåœ¾æ”¶é›†å™¨ï¼Ÿ***

- ***ä¼˜å…ˆè°ƒæ•´å †çš„å¤§å°è®©JVMè‡ªé€‚åº”å®Œæˆã€‚***
- ***å¦‚æœå†…å­˜å°äº100Mï¼Œä½¿ç”¨ä¸²è¡Œæ”¶é›†å™¨***
- ***å¦‚æœæ˜¯å•æ ¸ã€å•æœºç¨‹åºï¼Œå¹¶ä¸”æ²¡æœ‰åœé¡¿æ—¶é—´çš„è¦æ±‚ï¼Œä¸²è¡Œæ”¶é›†å™¨***
- ***å¦‚æœæ˜¯å¤šCPUã€éœ€è¦é«˜ååé‡ã€å…è®¸åœé¡¿æ—¶é—´è¶…è¿‡1ç§’ï¼Œé€‰æ‹©å¹¶è¡Œæˆ–è€…JVMè‡ªå·±é€‰æ‹©***
- ***å¦‚æœæ˜¯å¤šCPUã€è¿½æ±‚ä½åœé¡¿æ—¶é—´ï¼Œéœ€å¿«é€Ÿå“åº”ï¼ˆæ¯”å¦‚å»¶è¿Ÿä¸èƒ½è¶…è¿‡1ç§’ï¼Œå¦‚äº’è”ç½‘åº”ç”¨ï¼‰ï¼Œä½¿ç”¨å¹¶å‘æ”¶é›†å™¨***
- ***å®˜æ–¹æ¨èG1ï¼Œæ€§èƒ½é«˜ã€‚ç°åœ¨äº’è”ç½‘çš„é¡¹ç›®ï¼ŒåŸºæœ¬éƒ½æ˜¯ä½¿ç”¨G1ã€‚***

***æœ€åéœ€è¦æ˜ç¡®ä¸€ä¸ªè§‚ç‚¹ï¼š***

- ***æ²¡æœ‰æœ€å¥½çš„æ”¶é›†å™¨ï¼Œæ›´æ²¡æœ‰ä¸‡èƒ½çš„æ”¶é›†***
- ***è°ƒä¼˜æ°¸è¿œæ˜¯é’ˆå¯¹ç‰¹å®šåœºæ™¯ã€ç‰¹å®šéœ€æ±‚ï¼Œä¸å­˜åœ¨ä¸€åŠ³æ°¸é€¸çš„æ”¶é›†å™¨***

### é¢è¯•

å¯¹äºåƒåœ¾æ”¶é›†ï¼Œé¢è¯•å®˜å¯ä»¥å¾ªåºæ¸è¿›ä»ç†è®ºã€å®è·µå„ç§è§’åº¦æ·±å…¥ï¼Œä¹Ÿæœªå¿…æ˜¯è¦æ±‚é¢è¯•è€…ä»€ä¹ˆéƒ½æ‡‚ã€‚ä½†å¦‚æœä½ æ‡‚å¾—åŸç†ï¼Œä¸€å®šä¼šæˆä¸ºé¢è¯•ä¸­çš„åŠ åˆ†é¡¹ã€‚
***è¿™é‡Œè¾ƒé€šç”¨ã€åŸºç¡€æ€§çš„éƒ¨åˆ†å¦‚ä¸‹ï¼š***

- ***åƒåœ¾æ”¶é›†çš„ç®—æ³•æœ‰å“ªäº›ï¼Ÿå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯ä»¥å›æ”¶ï¼Ÿ***

- ***åƒåœ¾æ”¶é›†å™¨å·¥ä½œçš„åŸºæœ¬æµç¨‹ã€‚***

***å¦å¤–ï¼Œå¤§å®¶éœ€è¦å¤šå…³æ³¨åƒåœ¾å›æ”¶å™¨è¿™ä¸€ç« çš„å„ç§å¸¸ç”¨çš„å‚æ•°***

## GCæ—¥å¿—åˆ†æ

é€šè¿‡é˜…è¯»Gcæ—¥å¿—ï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£Javaè™šæ‹Ÿæœºå†…å­˜åˆ†é…ä¸å›æ”¶ç­–ç•¥ã€‚
å†…å­˜åˆ†é…ä¸åƒåœ¾å›æ”¶çš„å‚æ•°åˆ—è¡¨

- ***-XX:+PrintGC*** è¾“å‡ºGCæ—¥å¿—ã€‚ç±»ä¼¼ï¼š-verbose:gc
- ***-XX:+PrintGCDetails*** è¾“å‡ºGcçš„è¯¦ç»†æ—¥å¿—
- ***-XX:+PrintGCTimestamps***  è¾“å‡ºGcçš„æ—¶é—´æˆ³ï¼ˆä»¥åŸºå‡†æ—¶é—´çš„å½¢å¼ï¼‰
- ***-XX:+PrintGCDatestamps***  è¾“å‡ºGcçš„æ—¶é—´æˆ³ï¼ˆä»¥æ—¥æœŸçš„å½¢å¼ï¼Œå¦‚2013-05-04T21ï¼š53ï¼š59.234+0800ï¼‰
- ***-XX:+PrintHeapAtGC*** åœ¨è¿›è¡ŒGcçš„å‰åæ‰“å°å‡ºå †çš„ä¿¡æ¯
- ***-Xloggc:../logs/gc.log*** æ—¥å¿—æ–‡ä»¶çš„è¾“å‡ºè·¯å¾„

### verbose:gc

æ‰“å¼€GCæ—¥å¿—

```bash
-verbose:gc
```

è¿™ä¸ªåªä¼šæ˜¾ç¤ºæ€»çš„GCå †çš„å˜åŒ–ï¼Œå¦‚ä¸‹ï¼š

![image-20200714081610474](/assets/imgs/image-20200714081610474.png)

å‚æ•°è§£æ

![image-20200714081622526](/assets/imgs/image-20200714081622526.png)

### PrintGCDetails

æ‰“å¼€GCæ—¥å¿—

```bash
-verbose:gc -XX:+PrintGCDetails
```

è¾“å…¥ä¿¡æ¯å¦‚ä¸‹

![image-20200714081909309](/assets/imgs/image-20200714081909309.png)

å‚æ•°è§£æ

![image-20200714081925767](/assets/imgs/image-20200714081925767.png)

### æ—¥å¿—è¡¥å……è¯´æ˜

- [GC"å’Œ"[Full GC"è¯´æ˜äº†è¿™æ¬¡åƒåœ¾æ”¶é›†çš„åœé¡¿ç±»å‹ï¼Œå¦‚æœæœ‰"Full"åˆ™è¯´æ˜GCå‘ç”Ÿäº†"stop The World"
- ä½¿ç”¨Serialæ”¶é›†å™¨åœ¨æ–°ç”Ÿä»£çš„åå­—æ˜¯Default New Generationï¼Œå› æ­¤æ˜¾ç¤ºçš„æ˜¯"[DefNew"
- ä½¿ç”¨ParNewæ”¶é›†å™¨åœ¨æ–°ç”Ÿä»£çš„åå­—ä¼šå˜æˆ"[ParNew"ï¼Œæ„æ€æ˜¯"Parallel New Generation"
- ä½¿ç”¨Parallel scavengeæ”¶é›†å™¨åœ¨æ–°ç”Ÿä»£çš„åå­—æ˜¯â€[PSYoungGen"
- è€å¹´ä»£çš„æ”¶é›†å’Œæ–°ç”Ÿä»£é“ç†ä¸€æ ·ï¼Œåå­—ä¹Ÿæ˜¯æ”¶é›†å™¨å†³å®šçš„
- ä½¿ç”¨G1æ”¶é›†å™¨çš„è¯ï¼Œä¼šæ˜¾ç¤ºä¸º"garbage-first heap"

- ***Allocation Failureè¡¨æ˜æœ¬æ¬¡å¼•èµ·GCçš„åŸå› æ˜¯å› ä¸ºåœ¨å¹´è½»ä»£ä¸­æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´èƒ½å¤Ÿå­˜å‚¨æ–°çš„æ•°æ®äº†ã€‚***

- [PSYoungGenï¼š5986K->696K(8704K)]   5986K->704Kï¼ˆ9216Kï¼‰
  - ä¸­æ‹¬å·å†…ï¼šGCå›æ”¶å‰å¹´è½»ä»£å¤§å°ï¼Œå›æ”¶åå¤§å°ï¼Œï¼ˆå¹´è½»ä»£æ€»å¤§å°ï¼‰
  - æ‹¬å·å¤–ï¼šGCå›æ”¶å‰å¹´è½»ä»£å’Œè€å¹´ä»£å¤§å°ï¼Œå›æ”¶åå¤§å°ï¼Œï¼ˆå¹´è½»ä»£å’Œè€å¹´ä»£æ€»å¤§å°ï¼‰

- userä»£è¡¨ç”¨æˆ·æ€å›æ”¶è€—æ—¶ï¼Œsyså†…æ ¸æ€å›æ”¶è€—æ—¶ï¼Œreaå®é™…è€—æ—¶ã€‚ç”±äºå¤šæ ¸çš„åŸå› ï¼Œæ—¶é—´æ€»å’Œå¯èƒ½ä¼šè¶…è¿‡real æ—¶é—´

### Young GCå›¾ç‰‡

![image-20200714082555688](/assets/imgs/image-20200714082555688.png)

### FullGCå›¾ç‰‡

![image-20200714082714690](/assets/imgs/image-20200714082714690.png)

### GCå›æ”¶ä¸¾ä¾‹

æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªç¨‹åºï¼Œç”¨æ¥è¯´æ˜GCæ”¶é›†çš„è¿‡ç¨‹

```java
/**
 * GCåƒåœ¾æ”¶é›†è¿‡ç¨‹
 */
public class GCUseTest {
    static final Integer _1MB = 1024 * 1024;
    public static void main(String[] args) {
        byte [] allocation1, allocation2, allocation3, allocation4;
        allocation1 = new byte[2 *_1MB];
        allocation2 = new byte[2 *_1MB];
        allocation3 = new byte[2 *_1MB];
        allocation4 = new byte[4 *_1MB];
    }
}
```

æˆ‘ä»¬è®¾ç½®JVMå¯åŠ¨å‚æ•°

```bash
-Xms10m -Xmx10m -XX:+PrintGCDetails
```

***åœ¨JDK7ä¸­ï¼Œ***é¦–å…ˆæˆ‘ä»¬ä¼šå°†3ä¸ª2Mçš„æ•°ç»„å­˜æ”¾åˆ°EdenåŒºï¼Œç„¶ååé¢4Mçš„æ•°ç»„æ¥äº†åï¼Œå°†æ— æ³•å­˜å‚¨ï¼Œå› ä¸ºEdenåŒºåªå‰©ä¸‹2Mçš„å‰©ä½™ç©ºé—´äº†ï¼Œé‚£ä¹ˆå°†ä¼šè¿›è¡Œä¸€æ¬¡Young GCæ“ä½œï¼Œå°†åŸæ¥EdenåŒºçš„å†…å®¹ï¼Œå­˜æ”¾åˆ°SurvivoråŒºï¼Œä½†æ˜¯SurvivoråŒºä¹Ÿå­˜æ”¾ä¸ä¸‹ï¼Œé‚£ä¹ˆå°±ä¼šç›´æ¥æ™‹çº§å­˜å…¥Old åŒºã€‚***åœ¨JDK8ä¸­å¤§å¯¹è±¡ç›´æ¥æ”¾å…¥åˆ°OldåŒºã€‚***

![image-20200714083332238](/assets/imgs/image-20200714083332238.png)

ç„¶åæˆ‘ä»¬å°†4Må¯¹è±¡å­˜å…¥åˆ°EdenåŒºä¸­

![image-20200714083526790](/assets/imgs/image-20200714083526790.png)

å¯ä»¥ç”¨ä¸€äº›å·¥å…·å»åˆ†æè¿™äº›GCæ—¥å¿—

å¸¸ç”¨çš„æ—¥å¿—åˆ†æå·¥å…·æœ‰ï¼šGCViewerã€GCEasyã€GCHistoã€GCLogViewerã€Hpjmeterã€garbagecatç­‰

**GCViewer**

![image-20200714084921184](/assets/imgs/image-20200714084921184.png)

**GC easy**

![image-20200714084726824](/assets/imgs/image-20200714084726824.png)



