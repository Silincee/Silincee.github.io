---
 layout: post
title:  "HashMapå¸¸è§é¢è¯•é¢˜"
date:   2020-10-28 15:43:06 +0800--
categories: [Java,]
tags: [Java, HashMap]  

---

# HashMapå¸¸è§é¢è¯•é¢˜

> [HashMapæºç è§£æ](http://www.silince.cn/2020/10/27/HashMapæºç è§£æ/)

> ä½ äº†è§£æ•°æ®ç»“æ„ä¸­çš„HashMapä¹ˆï¼Ÿèƒ½è·Ÿæˆ‘èŠèŠä»–çš„ç»“æ„å’Œåº•å±‚åŸç†ä¹ˆï¼Ÿ

HashMapæ˜¯æˆ‘ä»¬éå¸¸å¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼Œç”±**æ•°ç»„å’Œé“¾è¡¨ç»„åˆæ„æˆ**çš„æ•°æ®ç»“æ„ã€‚

å¤§æ¦‚å¦‚ä¸‹ï¼Œæ•°ç»„é‡Œé¢æ¯ä¸ªåœ°æ–¹éƒ½å­˜äº†Key-Valueè¿™æ ·çš„å®ä¾‹ï¼Œåœ¨Java7å«Entryï¼Œåœ¨Java8ä¸­å«Nodeã€‚


![Image](/assets/imgs/640-20210117180437724.png)

å› ä¸ºä»–æœ¬èº«æ‰€æœ‰çš„ä½ç½®éƒ½ä¸ºnullï¼Œåœ¨putæ’å…¥çš„æ—¶å€™ä¼šæ ¹æ®keyçš„hashå»è®¡ç®—ä¸€ä¸ªindexå€¼ã€‚

å°±æ¯”å¦‚æˆ‘`putï¼ˆâ€Silinceâ€œï¼Œ520ï¼‰`ï¼Œæˆ‘æ’å…¥äº†ä¸ºâ€Silinceâ€œçš„å…ƒç´ ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬ä¼šé€šè¿‡å“ˆå¸Œå‡½æ•°è®¡ç®—å‡ºæ’å…¥çš„ä½ç½®ï¼Œè®¡ç®—å‡ºæ¥indexæ˜¯2é‚£ç»“æœä¸º  $hashï¼ˆâ€œSilinceâ€ï¼‰= 2$

![image-20210117181531423](/assets/imgs/image-20210117181531423.png)

> ä½ æåˆ°äº†è¿˜æœ‰é“¾è¡¨ï¼Œä¸ºå•¥éœ€è¦é“¾è¡¨ï¼Œé“¾è¡¨åˆæ˜¯æ€ä¹ˆæ ·å­çš„å‘¢ï¼Ÿ

æˆ‘ä»¬éƒ½çŸ¥é“æ•°ç»„é•¿åº¦æ˜¯æœ‰é™çš„ï¼Œåœ¨æœ‰é™çš„é•¿åº¦é‡Œé¢æˆ‘ä»¬ä½¿ç”¨å“ˆå¸Œï¼Œå“ˆå¸Œæœ¬èº«å°±å­˜åœ¨æ¦‚ç‡æ€§ï¼Œå°±æ˜¯â€Silinceâ€œå’Œâ€Silenceâ€œæˆ‘ä»¬éƒ½å»hashæœ‰ä¸€å®šçš„æ¦‚ç‡ä¼šä¸€æ ·ï¼Œå°±åƒä¸Šé¢çš„æƒ…å†µæˆ‘å†æ¬¡å“ˆå¸Œâ€Silenceâ€œæç«¯æƒ…å†µä¹Ÿä¼šhashåˆ°ä¸€ä¸ªå€¼ä¸Šï¼Œé‚£å°±å½¢æˆäº†é“¾è¡¨ã€‚

![image-20210117182142632](/assets/imgs/image-20210117182142632.png)

æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½ä¼šä¿å­˜è‡ªèº«çš„hashã€keyã€valueã€ä»¥åŠä¸‹ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘çœ‹çœ‹Nodeçš„æºç ã€‚

![image-20210117182340054](/assets/imgs/image-20210117182340054.png)

> è¯´åˆ°é“¾è¡¨æˆ‘æƒ³é—®ä¸€ä¸‹ï¼Œä½ çŸ¥é“æ–°çš„EntryèŠ‚ç‚¹åœ¨æ’å…¥é“¾è¡¨çš„æ—¶å€™ï¼Œæ˜¯æ€ä¹ˆæ’å…¥çš„ä¹ˆï¼Ÿ

**java8ä¹‹å‰æ˜¯å¤´æ’æ³•**ï¼Œå°±æ˜¯è¯´æ–°æ¥çš„å€¼ä¼šå–ä»£åŸæœ‰çš„å€¼ï¼ŒåŸæœ‰çš„å€¼å°±é¡ºæ¨åˆ°é“¾è¡¨ä¸­å»ï¼Œå°±åƒä¸Šé¢çš„ä¾‹å­ä¸€æ ·ï¼Œå› ä¸ºå†™è¿™ä¸ªä»£ç çš„ä½œè€…è®¤ä¸ºåæ¥çš„å€¼è¢«æŸ¥æ‰¾çš„å¯èƒ½æ€§æ›´å¤§ä¸€ç‚¹ï¼Œæå‡æŸ¥æ‰¾çš„æ•ˆç‡ã€‚

ä½†æ˜¯ï¼Œ**åœ¨java8ä¹‹åï¼Œéƒ½æ˜¯æ‰€ç”¨å°¾éƒ¨æ’å…¥äº†ã€‚**

> ä¸ºå•¥æ”¹ä¸ºå°¾éƒ¨æ’å…¥å‘¢ï¼Ÿ

æœ‰äººè®¤ä¸ºæ˜¯ä½œè€…éšæ€§è€Œä¸ºï¼Œæ²¡å•¥luanç”¨ï¼Œå…¶å®ä¸ç„¶ï¼Œå…¶ä¸­æš—è—ç„æœº

é¦–å…ˆæˆ‘ä»¬çœ‹ä¸‹HashMapçš„æ‰©å®¹æœºåˆ¶ï¼šæ•°ç»„å®¹é‡æ˜¯æœ‰é™çš„ï¼Œæ•°æ®å¤šæ¬¡æ’å…¥çš„ï¼Œåˆ°è¾¾ä¸€å®šçš„æ•°é‡å°±ä¼šè¿›è¡Œæ‰©å®¹ï¼Œä¹Ÿå°±æ˜¯resizeã€‚

> ä»€ä¹ˆæ—¶å€™resizeå‘¢ï¼Ÿ

æœ‰ä¸¤ä¸ªå› ç´ ï¼š

- Capacityï¼šHashMapå½“å‰é•¿åº¦ã€‚
- LoadFactorï¼šè´Ÿè½½å› å­ï¼Œé»˜è®¤å€¼0.75fã€‚

![image-20210117182607520](/assets/imgs/image-20210117182607520.png)

æ€ä¹ˆç†è§£å‘¢ï¼Œå°±æ¯”å¦‚å½“å‰çš„å®¹é‡å¤§å°ä¸º100ï¼Œå½“ä½ å­˜è¿›ç¬¬76ä¸ªçš„æ—¶å€™ï¼Œåˆ¤æ–­å‘ç°éœ€è¦è¿›è¡Œresizeäº†ï¼Œé‚£å°±è¿›è¡Œæ‰©å®¹ï¼Œä½†æ˜¯HashMapçš„æ‰©å®¹ä¹Ÿä¸æ˜¯ç®€å•çš„æ‰©å¤§ç‚¹å®¹é‡è¿™ä¹ˆç®€å•çš„ã€‚

> æ‰©å®¹ï¼Ÿå®ƒæ˜¯æ€ä¹ˆæ‰©å®¹çš„å‘¢ï¼Ÿ

åˆ†ä¸ºä¸¤æ­¥

- æ‰©å®¹ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„Entryç©ºæ•°ç»„ï¼Œé•¿åº¦æ˜¯åŸæ•°ç»„çš„2å€ã€‚
- ReHashï¼šéå†åŸEntryæ•°ç»„ï¼ŒæŠŠæ‰€æœ‰çš„Entryé‡æ–°Hashåˆ°æ–°æ•°ç»„ã€‚

> ä¸ºä»€ä¹ˆè¦é‡æ–°Hashå‘¢ï¼Œç›´æ¥å¤åˆ¶è¿‡å»ä¸é¦™ä¹ˆï¼Ÿ

å› ä¸ºé•¿åº¦æ‰©å¤§ä»¥åï¼ŒHashçš„è§„åˆ™ä¹Ÿéšä¹‹æ”¹å˜ã€‚

Hashçš„å…¬å¼: $index = HashCode(Key) \& (Length - 1)$

åŸæ¥é•¿åº¦ï¼ˆLengthï¼‰æ˜¯8ä½ ä½è¿ç®—å‡ºæ¥çš„å€¼æ˜¯2 ï¼Œæ–°çš„é•¿åº¦æ˜¯16ä½ ä½è¿ç®—å‡ºæ¥çš„å€¼æ˜æ˜¾ä¸ä¸€æ ·äº†ã€‚

> è¯´å®Œæ‰©å®¹æœºåˆ¶æˆ‘ä»¬è¨€å½’æ­£ä¼ ï¼Œä¸ºå•¥ä¹‹å‰ç”¨å¤´æ’æ³•ï¼Œjava8ä¹‹åæ”¹æˆå°¾æ’äº†å‘¢ï¼Ÿ

***å¦‚æœä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è§¦å‘æ‰©å®¹ï¼Œåœ¨ç§»åŠ¨èŠ‚ç‚¹æ—¶ä¼šå¯¼è‡´ä¸€ä¸ªé“¾è¡¨ä¸­çš„2ä¸ªèŠ‚ç‚¹ç›¸äº’å¼•ç”¨ï¼Œä»è€Œç”Ÿæˆç¯å½¢é“¾è¡¨ã€‚*** 

[jdk1.7HashMapé“¾è¡¨å¤´æ’æ³•å¯¼è‡´çš„æ­»å¾ªç¯çš„è¯¦ç»†åˆ†æ](https://blog.csdn.net/thqtzq/article/details/90485663?utm_medium=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.control&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.control)

æˆ‘å…ˆä¸¾ä¸ªä¾‹å­å§ï¼Œæˆ‘ä»¬ç°åœ¨å¾€ä¸€ä¸ªå®¹é‡å¤§å°ä¸º2çš„putä¸¤ä¸ªå€¼ï¼Œè´Ÿè½½å› å­æ˜¯0.75ã€‚`2*0.75 = 1` æ‰€ä»¥æ’å…¥ç¬¬äºŒä¸ªçš„æ—¶å€™å°±è¦resizeäº†

ç°åœ¨æˆ‘ä»¬è¦åœ¨å®¹é‡ä¸º2çš„å®¹å™¨é‡Œé¢**ç”¨ä¸åŒçº¿ç¨‹**æ’å…¥Aï¼ŒBï¼ŒCï¼Œå‡å¦‚æˆ‘ä»¬åœ¨resizeä¹‹å‰æ‰“ä¸ªæ–­ç‚¹ï¼Œé‚£æ„å‘³ç€æ•°æ®éƒ½æ’å…¥äº†ä½†æ˜¯è¿˜æ²¡resizeé‚£æ‰©å®¹å‰å¯èƒ½æ˜¯è¿™æ ·çš„ã€‚

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°é“¾è¡¨çš„æŒ‡å‘A->B->C

**âš ï¸ï¼šAçš„ä¸‹ä¸€ä¸ªæŒ‡é’ˆæ˜¯æŒ‡å‘Bçš„ã€‚å¤´æ’æ³•ä»£ç åœ¨resize()æ–¹æ³•ä¸­ä½“ç°**

![Image](/assets/imgs/640-20210117185720274.png)

å› ä¸ºresizeçš„èµ‹å€¼æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨äº†**å•é“¾è¡¨çš„å¤´æ’å…¥æ–¹å¼ï¼ŒåŒä¸€ä½ç½®ä¸Šæ–°å…ƒç´ æ€»ä¼šè¢«æ”¾åœ¨é“¾è¡¨çš„å¤´éƒ¨ä½ç½®**ï¼Œåœ¨æ—§æ•°ç»„ä¸­åŒä¸€æ¡Entryé“¾ä¸Šçš„å…ƒç´ ï¼Œé€šè¿‡é‡æ–°è®¡ç®—ç´¢å¼•ä½ç½®åï¼Œæœ‰å¯èƒ½è¢«æ”¾åˆ°äº†æ–°æ•°ç»„çš„ä¸åŒä½ç½®ä¸Šã€‚

å°±å¯èƒ½å‡ºç°ä¸‹é¢çš„æƒ…å†µï¼Œå¤§å®¶å‘ç°é—®é¢˜æ²¡æœ‰ï¼Ÿ

Bçš„ä¸‹ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘äº†A

![Image](/assets/imgs/640-20210117185720413.png)

ä¸€æ—¦å‡ ä¸ªçº¿ç¨‹éƒ½è°ƒæ•´å®Œæˆï¼Œå°±å¯èƒ½å‡ºç°ç¯å½¢é“¾è¡¨

![Image](/assets/imgs/640-20210117185720456.png)

å¦‚æœè¿™ä¸ªæ—¶å€™å»å–å€¼ï¼Œæ‚²å‰§å°±å‡ºç°äº†â€”â€”Infinite Loopã€‚



> å°ä¼™å­æœ‰ç‚¹ä¸œè¥¿å‘€ï¼Œä½†æ˜¯ä½ éƒ½éƒ½è¯´äº†å¤´æ’æ˜¯JDK1.7çš„é‚£1.8çš„å°¾æ’æ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿ

å› ä¸º**java8ä¹‹åé“¾è¡¨æœ‰çº¢é»‘æ ‘**çš„éƒ¨åˆ†ï¼Œå¤§å®¶å¯ä»¥çœ‹åˆ°ä»£ç å·²ç»å¤šäº†å¾ˆå¤šif elseçš„é€»è¾‘åˆ¤æ–­äº†ï¼Œçº¢é»‘æ ‘çš„å¼•å…¥å·§å¦™çš„å°†åŸæœ¬O(n)çš„æ—¶é—´å¤æ‚åº¦é™ä½åˆ°äº†O(logn)ã€‚

**ä½¿ç”¨å¤´æ’**ä¼šæ”¹å˜é“¾è¡¨çš„ä¸Šçš„é¡ºåºï¼Œä½†æ˜¯å¦‚æœ**ä½¿ç”¨å°¾æ’**ï¼Œåœ¨æ‰©å®¹æ—¶ä¼šä¿æŒé“¾è¡¨å…ƒç´ åŸæœ¬çš„é¡ºåºï¼Œå°±ä¸ä¼šå‡ºç°é“¾è¡¨æˆç¯çš„é—®é¢˜äº†ã€‚

å°±æ˜¯è¯´åŸæœ¬æ˜¯A->Bï¼Œåœ¨æ‰©å®¹åé‚£ä¸ªé“¾è¡¨è¿˜æ˜¯A->Bã€‚

![Image](/assets/imgs/640-202g10117192016326.png)

**Java7åœ¨å¤šçº¿ç¨‹æ“ä½œHashMapæ—¶å¯èƒ½å¼•èµ·æ­»å¾ªç¯ï¼ŒåŸå› æ˜¯æ‰©å®¹è½¬ç§»åå‰åé“¾è¡¨é¡ºåºå€’ç½®ï¼Œåœ¨è½¬ç§»è¿‡ç¨‹ä¸­ä¿®æ”¹äº†åŸæ¥é“¾è¡¨ä¸­èŠ‚ç‚¹çš„å¼•ç”¨å…³ç³»ã€‚**

**Java8åœ¨åŒæ ·çš„å‰æä¸‹å¹¶ä¸ä¼šå¼•èµ·æ­»å¾ªç¯ï¼ŒåŸå› æ˜¯æ‰©å®¹è½¬ç§»åå‰åé“¾è¡¨é¡ºåºä¸å˜ï¼Œä¿æŒä¹‹å‰èŠ‚ç‚¹çš„å¼•ç”¨å…³ç³»ã€‚**



> é‚£æ˜¯ä¸æ˜¯æ„å‘³ç€Java8å°±å¯ä»¥æŠŠHashMapç”¨åœ¨å¤šçº¿ç¨‹ä¸­å‘¢ï¼Ÿ

æˆ‘è®¤ä¸ºå³ä½¿ä¸ä¼šå‡ºç°æ­»å¾ªç¯ï¼Œä½†æ˜¯é€šè¿‡æºç çœ‹åˆ°put/getæ–¹æ³•éƒ½æ²¡æœ‰åŠ åŒæ­¥é”ï¼Œå¤šçº¿ç¨‹æƒ…å†µæœ€å®¹æ˜“å‡ºç°çš„å°±æ˜¯ï¼šæ— æ³•ä¿è¯ä¸Šä¸€ç§’putçš„å€¼ï¼Œä¸‹ä¸€ç§’getçš„æ—¶å€™è¿˜æ˜¯åŸå€¼ï¼Œæ‰€ä»¥çº¿ç¨‹å®‰å…¨è¿˜æ˜¯æ— æ³•ä¿è¯ã€‚

> é‚£æˆ‘é—®ä½ HashMapçš„é»˜è®¤åˆå§‹åŒ–é•¿åº¦æ˜¯å¤šå°‘ï¼Ÿ

æˆ‘è®°å¾—æˆ‘åœ¨çœ‹æºç çš„æ—¶å€™åˆå§‹åŒ–å¤§å°æ˜¯16

> ä½ é‚£çŸ¥é“ä¸ºå•¥æ˜¯16ä¹ˆï¼Ÿ 

[**ä¸ºä»€ä¹ˆå¿…é¡»æ˜¯2çš„næ¬¡å¹‚ï¼Ÿ**](http://www.silince.cn/2020/10/27/HashMapæºç è§£æ/#æˆå‘˜å˜é‡)

**åœ¨JDK1.8çš„ 236 è¡Œæœ‰1<<4å°±æ˜¯16**ï¼Œä¸ºå•¥ç”¨ä½è¿ç®—å‘¢ï¼Ÿç›´æ¥å†™16ä¸å¥½ä¹ˆï¼Ÿ![Image](/assets/imgs/640-20210117194621947.png)

è¿™æ ·æ˜¯ä¸ºäº†ä½è¿ç®—çš„æ–¹ä¾¿ï¼Œ**ä½ä¸è¿ç®—æ¯”ç®—æ•°è®¡ç®—çš„æ•ˆç‡é«˜äº†å¾ˆå¤š**ï¼Œä¹‹æ‰€ä»¥é€‰æ‹©16ï¼Œæ˜¯ä¸ºäº†æœåŠ¡å°†Keyæ˜ å°„åˆ°indexçš„ç®—æ³•ã€‚

æˆ‘å‰é¢è¯´äº†æ‰€æœ‰çš„keyæˆ‘ä»¬éƒ½ä¼šæ‹¿åˆ°ä»–çš„hashï¼Œä½†æ˜¯æˆ‘ä»¬æ€ä¹ˆå°½å¯èƒ½çš„å¾—åˆ°ä¸€ä¸ªå‡åŒ€åˆ†å¸ƒçš„hashå‘¢ï¼Ÿ

æ˜¯çš„æˆ‘ä»¬é€šè¿‡Keyçš„HashCodeå€¼å»åšä½è¿ç®—ã€‚

- å‡å¦‚keyä¸ºâ€Silinceâ€œçš„åè¿›åˆ¶ä¸º766132é‚£äºŒè¿›åˆ¶å°±æ˜¯ 1011 1011 0000 1011 0100
- æ ¹æ® indexçš„è®¡ç®—å…¬å¼ï¼šindex = HashCodeï¼ˆKeyï¼‰ & ï¼ˆLength- 1ï¼‰

- 15çš„çš„äºŒè¿›åˆ¶æ˜¯1111ï¼Œé‚£1011 1011 0000 1011 0100 &1111 åè¿›åˆ¶å°±æ˜¯4

**ç”¨`æŒ‰ä½ä¸è¿ç®—`æ•ˆæœä¸`å–æ¨¡`ä¸€æ ·ï¼Œæ€§èƒ½å´æé«˜äº†ä¸å°‘ï¼**



> é‚£ä¸ºå•¥ç”¨16ä¸ç”¨åˆ«çš„å‘¢ï¼Ÿ

å› ä¸ºåœ¨ä½¿ç”¨ä¸æ˜¯2çš„å¹‚çš„æ•°å­—çš„æ—¶å€™ï¼ŒLength-1çš„å€¼æ˜¯æ‰€æœ‰äºŒè¿›åˆ¶ä½å…¨ä¸º1ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œindexçš„ç»“æœç­‰åŒäºHashCodeåå‡ ä½çš„å€¼ã€‚

åªè¦è¾“å…¥çš„HashCodeæœ¬èº«åˆ†å¸ƒå‡åŒ€ï¼ŒHashç®—æ³•çš„ç»“æœå°±æ˜¯å‡åŒ€çš„ã€‚

è¿™æ˜¯ä¸ºäº†**å®ç°å‡åŒ€åˆ†å¸ƒ**ã€‚



> ä¸ºå•¥æˆ‘ä»¬é‡å†™equalsæ–¹æ³•çš„æ—¶å€™éœ€è¦é‡å†™hashCodeæ–¹æ³•å‘¢ï¼Ÿä½ èƒ½ç”¨HashMapç»™æˆ‘ä¸¾ä¸ªä¾‹å­ä¹ˆï¼Ÿ

å› ä¸ºåœ¨javaä¸­ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½æ˜¯ç»§æ‰¿äºObjectç±»ã€‚Ojbectç±»ä¸­æœ‰ä¸¤ä¸ªæ–¹æ³•equalsã€hashCodeï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯ç”¨æ¥æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰çš„ã€‚

åœ¨æœªé‡å†™equalsæ–¹æ³•æˆ‘ä»¬æ˜¯ç»§æ‰¿äº†objectçš„equalsæ–¹æ³•(**ç›¸å½“äº==**)ï¼Œ**é‚£é‡Œçš„ equalsæ˜¯æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„å†…å­˜åœ°å€**ï¼Œæ˜¾ç„¶æˆ‘ä»¬newäº†2ä¸ªå¯¹è±¡å†…å­˜åœ°å€è‚¯å®šä¸ä¸€æ ·

- **å¯¹äºå€¼å¯¹è±¡ï¼ŒObject.equals()æ¯”è¾ƒçš„æ˜¯ä¸¤ä¸ªå¯¹è±¡çš„å€¼**
- **å¯¹äºå¼•ç”¨å¯¹è±¡ï¼ŒObject.equals()æ¯”è¾ƒçš„æ˜¯ä¸¤ä¸ªå¯¹è±¡çš„åœ°å€**

å¤§å®¶æ˜¯å¦è¿˜è®°å¾—æˆ‘è¯´çš„HashMapæ˜¯é€šè¿‡keyçš„hashCodeå»å¯»æ‰¾indexçš„ï¼Œé‚£indexä¸€æ ·å°±å½¢æˆé“¾è¡¨äº†ï¼Œä¹Ÿå°±æ˜¯è¯´â€Silinceâ€œå’Œâ€Silenceâ€œçš„indexéƒ½å¯èƒ½æ˜¯2ï¼Œåœ¨ä¸€ä¸ªé“¾è¡¨ä¸Šçš„ã€‚

æˆ‘ä»¬å»getçš„æ—¶å€™ï¼Œä»–å°±æ˜¯æ ¹æ®keyå»hashç„¶åè®¡ç®—å‡ºindexï¼Œæ‰¾åˆ°äº†2ï¼Œé‚£æˆ‘æ€ä¹ˆæ‰¾åˆ°å…·ä½“çš„â€Silinceâ€œè¿˜æ˜¯â€Silenceâ€œå‘¢ï¼Ÿ

**equals**ï¼æ˜¯çš„ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬å¯¹equalsæ–¹æ³•è¿›è¡Œäº†é‡å†™ï¼Œå»ºè®®ä¸€å®šè¦å¯¹hashCodeæ–¹æ³•é‡å†™ï¼Œ**ä»¥ä¿è¯ç›¸åŒçš„å¯¹è±¡è¿”å›ç›¸åŒçš„hashå€¼ï¼Œä¸åŒçš„å¯¹è±¡è¿”å›ä¸åŒçš„hashå€¼ã€‚**

ä¸ç„¶ä¸€ä¸ªé“¾è¡¨çš„å¯¹è±¡ï¼Œä½ å“ªé‡ŒçŸ¥é“ä½ è¦æ‰¾çš„æ˜¯å“ªä¸ªï¼Œåˆ°æ—¶å€™å‘ç°hashCodeéƒ½ä¸€æ ·ï¼Œè¿™ä¸æ˜¯å®ŒçŠŠå­å˜›ã€‚



> å¯ä»¥å¯ä»¥å°ä¼™å­ï¼Œæˆ‘è®°å¾—ä½ ä¸Šé¢è¯´è¿‡ä»–æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œé‚£ä½ èƒ½è·Ÿæˆ‘èŠèŠä½ ä»¬æ˜¯æ€ä¹ˆå¤„ç†HashMapåœ¨çº¿ç¨‹å®‰å…¨çš„åœºæ™¯ä¹ˆï¼Ÿ

é¢è¯•å®˜ï¼Œåœ¨è¿™æ ·çš„åœºæ™¯ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šä½¿ç”¨**HashTable**æˆ–è€…**CurrentHashMap**ï¼Œä½†æ˜¯å› ä¸ºå‰è€…çš„**å¹¶å‘åº¦**çš„åŸå› åŸºæœ¬ä¸Šæ²¡å•¥ä½¿ç”¨åœºæ™¯äº†ï¼Œæ‰€ä»¥å­˜åœ¨çº¿ç¨‹ä¸å®‰å…¨çš„åœºæ™¯æˆ‘ä»¬éƒ½ä½¿ç”¨çš„æ˜¯CorruentHashMapã€‚

HashTableæˆ‘çœ‹è¿‡ä»–çš„æºç ï¼Œå¾ˆç®€å•ç²—æš´ï¼Œç›´æ¥åœ¨æ–¹æ³•ä¸Šé”ï¼Œå¹¶å‘åº¦å¾ˆä½ï¼Œæœ€å¤šåŒæ—¶å…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼ŒcurrentHashMapå°±å¥½å¾ˆå¤šäº†ï¼Œ1.7å’Œ1.8æœ‰è¾ƒå¤§çš„ä¸åŒï¼Œä¸è¿‡å¹¶å‘åº¦éƒ½æ¯”å‰è€…å¥½å¤ªå¤šäº†ã€‚

![Image](/assets/imgs/640-20210117200207411.png)



# HashMapä¸ºä»€ä¹ˆçº¿ç¨‹ä¸å®‰å…¨ ğŸ¤”

## jdk1.7ä¸­çš„HashMap

åœ¨jdk1.8ä¸­å¯¹HashMapåšäº†å¾ˆå¤šä¼˜åŒ–ï¼Œè¿™é‡Œå…ˆåˆ†æåœ¨jdk1.7ä¸­çš„é—®é¢˜ï¼Œç›¸ä¿¡å¤§å®¶éƒ½çŸ¥é“åœ¨jdk1.7å¤šçº¿ç¨‹ç¯å¢ƒä¸‹HashMapå®¹æ˜“å‡ºç°æ­»å¾ªç¯ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆç”¨ä»£ç æ¥æ¨¡æ‹Ÿå‡ºç°æ­»å¾ªç¯çš„æƒ…å†µï¼š

```java
/**
 * @description: jdk1.7ä¸­çš„HashMap æ‰©å®¹é€ æˆæ­»å¾ªç¯åˆ†æè¿‡ç¨‹
 * @author: Silince
 * @create: 2021-01-17 20:26
 **/
public class HashMapTest {
    public static void main(String[] args) {
        HashMapThread thread0 = new HashMapThread();
        HashMapThread thread1 = new HashMapThread();
        HashMapThread thread2 = new HashMapThread();
        HashMapThread thread3 = new HashMapThread();
        HashMapThread thread4 = new HashMapThread();
        thread0.start();
        thread1.start();
        thread2.start();
        thread3.start();
        thread4.start();
    }
}

class HashMapThread extends Thread{
    private static AtomicInteger ai = new AtomicInteger();
    private static Map<Integer,Integer> map = new HashMap<>();

    @Override
    public void run() {
        map.put(ai.get(),ai.get());
        ai.incrementAndGet();
    }
}
```

ä¸Šè¿°ä»£ç æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯å¼€å¤šä¸ªçº¿ç¨‹ä¸æ–­è¿›è¡Œputæ“ä½œï¼Œå¹¶ä¸”HashMapä¸AtomicIntegeréƒ½æ˜¯å…¨å±€å…±äº«çš„ã€‚åœ¨å¤šè¿è¡Œå‡ æ¬¡è¯¥ä»£ç åï¼Œå‡ºç°å¦‚ä¸‹æ­»å¾ªç¯æƒ…å½¢ï¼š

![Image](/Users/silince/Develop/åšå®¢/blog_to_git/assets/imgs/640-20210117203106171.png)

å…¶ä¸­æœ‰å‡ æ¬¡è¿˜ä¼šå‡ºç°æ•°ç»„è¶Šç•Œçš„æƒ…å†µï¼š

![Image](/Users/silince/Develop/åšå®¢/blog_to_git/assets/imgs/640-20210117203106259.png)

è¿™é‡Œæˆ‘ä»¬ç€é‡åˆ†æä¸ºä»€ä¹ˆä¼šå‡ºç°æ­»å¾ªç¯çš„æƒ…å†µï¼Œé€šè¿‡jpså’Œjstackå‘½åæŸ¥çœ‹æ­»å¾ªç¯æƒ…å†µï¼Œç»“æœå¦‚ä¸‹ï¼š
![Image](/Users/silince/Develop/åšå®¢/blog_to_git/assets/imgs/640-20210117203456629.png)

ä»å †æ ˆä¿¡æ¯ä¸­å¯ä»¥çœ‹åˆ°å‡ºç°æ­»å¾ªç¯çš„ä½ç½®ï¼Œé€šè¿‡è¯¥ä¿¡æ¯å¯æ˜ç¡®çŸ¥é“æ­»å¾ªç¯å‘ç”Ÿåœ¨HashMapçš„æ‰©å®¹å‡½æ•°ä¸­ï¼Œæ ¹æºåœ¨**transferå‡½æ•°**ä¸­ï¼Œjdk1.7ä¸­HashMapçš„transferå‡½æ•°å¦‚ä¸‹ï¼š

**è¯¥å‡½æ•°çš„ä¸»è¦ä½œç”¨ï¼šåœ¨å¯¹tableè¿›è¡Œæ‰©å®¹åˆ°newTableåï¼Œéœ€è¦å°†åŸæ¥æ•°æ®è½¬ç§»åˆ°newTableä¸­ï¼Œè¿™é‡Œå¯ä»¥çœ‹å‡ºåœ¨è½¬ç§»å…ƒç´ çš„è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨çš„æ˜¯å¤´æ’æ³•ï¼Œä¹Ÿå°±æ˜¯é“¾è¡¨çš„é¡ºåºä¼šç¿»è½¬ï¼Œè¿™é‡Œä¹Ÿæ˜¯å½¢æˆæ­»å¾ªç¯çš„å…³é”®ç‚¹ã€‚ä¸‹é¢è¿›è¡Œè¯¦ç»†åˆ†æã€‚**

```java
void transfer(Entry[] newTable, boolean rehash) {
    int newCapacity = newTable.length; // è·å–æ–°Entryæ•°ç»„çš„å®¹é‡
    // éå†æ—§çš„Entryæ•°ç»„
    for (Entry<K,V> e : table) {
    // eçš„ä¸‹ä¸€ä¸ªentryä¸ä¸ºnullåˆ™å¾ªç¯ï¼ˆé“¾è¡¨ä¸Šçš„å¾ªç¯ï¼‰
      while(null != e) {
        Entry<K,V> next = e.next;
          if (rehash) {
            e.hash = null == e.key ? 0 : hash(e.key);
          }
        int i = indexFor(e.hash, newCapacity); // æ ¹æ®eçš„hashå€¼å’Œå®¹é‡è®¡ç®—å‡ºindexå€¼
        e.next = newTable[i]; // eçš„ä¸‹ä¸€ä¸ªEntryä¸ºæ–°æ•°ç»„iä½ç½®ä¸Šçš„å€¼
        newTable[i] = e; // eæ·»åŠ åˆ°æ–°æ•°ç»„çš„iä½ç½®ä¸Š
        e = next; // nextèµ‹å€¼ç»™e
       }
     }
 }
```



### æ‰©å®¹é€ æˆæ­»å¾ªç¯åˆ†æè¿‡ç¨‹

**å‰ææ¡ä»¶ï¼š**

1. hashç®—æ³•ä¸ºç®€å•çš„ç”¨key modé“¾è¡¨çš„å¤§å°ã€‚
2. æœ€å¼€å§‹hashè¡¨size=2ï¼Œkey=3,7,5ï¼Œåˆ™éƒ½åœ¨table[1]ä¸­ã€‚
3. ç„¶åè¿›è¡Œresizeï¼Œä½¿sizeå˜æˆ4ã€‚

æœªresizeå‰çš„æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š

![Image](/Users/silince/Develop/åšå®¢/blog_to_git/assets/imgs/640-20210117204350371.png)

å¦‚æœåœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œæœ€åçš„ç»“æœå¦‚ä¸‹ï¼š

![Image](/Users/silince/Develop/åšå®¢/blog_to_git/assets/imgs/640-20210117204332668.png)

è¿™é‡Œçš„è½¬ç§»è¿‡ç¨‹ï¼Œä¸å†è¿›è¡Œè¯¦è¿°ï¼Œåªè¦ç†è§£transferå‡½æ•°åœ¨åšä»€ä¹ˆï¼Œå…¶è½¬ç§»è¿‡ç¨‹ä»¥åŠå¦‚ä½•å¯¹é“¾è¡¨è¿›è¡Œåè½¬åº”è¯¥ä¸éš¾ã€‚

ç„¶ååœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå‡è®¾æœ‰ä¸¤ä¸ªçº¿ç¨‹Aå’ŒBéƒ½åœ¨è¿›è¡Œputæ“ä½œã€‚çº¿ç¨‹Aåœ¨æ‰§è¡Œåˆ°transferå‡½æ•°ä¸­ç¬¬11è¡Œä»£ç å¤„æŒ‚èµ·(**ç¬¬ä¸€æ¬¡å¾ªç¯**)ï¼Œå› ä¸ºè¯¥å‡½æ•°åœ¨è¿™é‡Œåˆ†æçš„åœ°ä½éå¸¸é‡è¦ï¼Œå› æ­¤å†æ¬¡è´´å‡ºæ¥ã€‚

![Image](/Users/silince/Develop/åšå®¢/blog_to_git/assets/imgs/640-20210117204332630.png)

æ­¤æ—¶çº¿ç¨‹Aä¸­è¿è¡Œç»“æœå¦‚ä¸‹ï¼š

![Image](/Users/silince/Develop/åšå®¢/blog_to_git/assets/imgs/640-0887412.png)

çº¿ç¨‹AæŒ‚èµ·åï¼Œæ­¤æ—¶çº¿ç¨‹Bæ­£å¸¸æ‰§è¡Œï¼Œæ­¤æ—¶Bçº¿ç¨‹è¿˜æ˜¯ä¸ºä»¥ä¸‹çŠ¶æ€ï¼š

![Image](/Users/silince/Pictures/Typora/640-20210117204350371-0890751.png)

å®Œæˆresizeæ“ä½œåçš„ç»“æœå¦‚ä¸‹ï¼š

![Image](/Users/silince/Develop/åšå®¢/blog_to_git/assets/imgs/640-20210117204332633.png)

**è¿™é‡Œéœ€è¦ç‰¹åˆ«æ³¨æ„çš„ç‚¹ï¼šç”±äºçº¿ç¨‹Bå·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œæ ¹æ®Javaå†…å­˜æ¨¡å‹ï¼Œç°åœ¨newTableå’Œtableä¸­çš„Entryéƒ½æ˜¯ä¸»å­˜ä¸­æœ€æ–°å€¼ï¼š7.next=3ï¼Œ3.next=nullã€‚**

æ­¤æ—¶åˆ‡æ¢åˆ°çº¿ç¨‹Aä¸Šï¼Œåœ¨çº¿ç¨‹AæŒ‚èµ·æ—¶å†…å­˜ä¸­å€¼å¦‚ä¸‹ï¼še=3ï¼Œnext=7ï¼ŒnewTable[3]=nullï¼Œä»£ç æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š

```
newTable[3]=e ----> newTable[3]=3
e=next ----> e=7
```

æ­¤æ—¶ç»“æœå¦‚ä¸‹ï¼š

![image-20210117215229172](/Users/silince/Develop/åšå®¢/blog_to_git/assets/imgs/image-20210117215229172.png)

ç»§ç»­å¾ªç¯ï¼š

```
e=7
next=e.next ----> next=3ã€ä»ä¸»å­˜ä¸­å–å€¼ã€‘
e.next=newTable[3] ----> e.next=3ã€ä»ä¸»å­˜ä¸­å–å€¼ã€‘
newTable[3]=e ----> newTable[3]=7
e=next ----> e=3
```

ç»“æœå¦‚ä¸‹ï¼š

![Image](/Users/silince/Develop/åšå®¢/blog_to_git/assets/imgs/640-20210117204332731.png)

å†æ¬¡è¿›è¡Œå¾ªç¯ï¼š

```
e=3
next=e.next ----> next=null
e.next=newTable[3] ----> e.next=7 å³ï¼š3.next=7
newTable[3]=e ----> newTable[3]=3
e=next ----> e=null
```

æ³¨æ„æ­¤æ¬¡å¾ªç¯ï¼še.next=7ï¼Œè€Œåœ¨ä¸Šæ¬¡å¾ªç¯ä¸­7.next=3ï¼Œå‡ºç°ç¯å½¢é“¾è¡¨ï¼Œå¹¶ä¸”æ­¤æ—¶e=nullå¾ªç¯ç»“æŸã€‚

ç»“æœå¦‚ä¸‹ï¼š

![Image](/Users/silince/Develop/åšå®¢/blog_to_git/assets/imgs/640-20210117204332602.png)

åœ¨åç»­æ“ä½œä¸­åªè¦æ¶‰åŠè½®è¯¢hashmapçš„æ•°æ®ç»“æ„ï¼Œå°±ä¼šåœ¨è¿™é‡Œå‘ç”Ÿæ­»å¾ªç¯ï¼Œé€ æˆæ‚²å‰§ã€‚



### æ‰©å®¹é€ æˆæ•°æ®ä¸¢å¤±åˆ†æè¿‡ç¨‹

éµç…§ä¸Šè¿°åˆ†æè¿‡ç¨‹ï¼Œåˆå§‹æ—¶ï¼š

![Image](/Users/silince/Develop/åšå®¢/blog_to_git/assets/imgs/640-20210117215328111.png)

çº¿ç¨‹Aå’Œçº¿ç¨‹Bè¿›è¡Œputæ“ä½œï¼ŒåŒæ ·çº¿ç¨‹AæŒ‚èµ·ï¼š

![Image](/Users/silince/Develop/åšå®¢/blog_to_git/assets/imgs/640-20210117215328329.png)

æ­¤æ—¶çº¿ç¨‹Açš„è¿è¡Œç»“æœå¦‚ä¸‹ï¼š

![Image](/Users/silince/Develop/åšå®¢/blog_to_git/assets/imgs/640-20210117215328347.png)

æ­¤æ—¶çº¿ç¨‹Bå·²è·å¾—CPUæ—¶é—´ç‰‡ï¼Œå¹¶å®Œæˆresizeæ“ä½œï¼š

![Image](/Users/silince/Develop/åšå®¢/blog_to_git/assets/imgs/640-20210117215328348.png)

åŒæ ·æ³¨æ„ç”±äºçº¿ç¨‹Bæ‰§è¡Œå®Œæˆï¼ŒnewTableå’Œtableéƒ½ä¸ºæœ€æ–°å€¼ï¼š**5.next=null**ã€‚

æ­¤æ—¶åˆ‡æ¢åˆ°çº¿ç¨‹Aï¼Œåœ¨çº¿ç¨‹AæŒ‚èµ·æ—¶ï¼š**e=7ï¼Œnext=5ï¼ŒnewTable[3]=nullã€‚**

æ‰§è¡Œnewtable[i]=eï¼Œå°±å°†**7æ”¾åœ¨äº†table[3]**çš„ä½ç½®ï¼Œæ­¤æ—¶next=5ã€‚æ¥ç€è¿›è¡Œä¸‹ä¸€æ¬¡å¾ªç¯ï¼š

```
e=5
next=e.next ----> next=nullï¼Œä»ä¸»å­˜ä¸­å–å€¼
e.next=newTable[1] ----> e.next=5ï¼Œä»ä¸»å­˜ä¸­å–å€¼
newTable[1]=e ----> newTable[1]=5
e=next ----> e=null
```

å°†5æ”¾ç½®åœ¨table[1]ä½ç½®ï¼Œæ­¤æ—¶e=nullå¾ªç¯ç»“æŸï¼Œ**3å…ƒç´ ä¸¢å¤±**ï¼Œå¹¶å½¢æˆ**ç¯å½¢é“¾è¡¨**ã€‚å¹¶åœ¨åç»­æ“ä½œhashmapæ—¶é€ æˆæ­»å¾ªç¯ã€‚

![Image](/Users/silince/Develop/åšå®¢/blog_to_git/assets/imgs/640-20210117215328317.png)





## jdk1.8ä¸­HashMap

åœ¨jdk1.8ä¸­å¯¹HashMapè¿›è¡Œäº†ä¼˜åŒ–ï¼Œåœ¨å‘ç”Ÿhashç¢°æ’ï¼Œä¸å†é‡‡ç”¨å¤´æ’æ³•æ–¹å¼ï¼Œè€Œæ˜¯ç›´æ¥æ’å…¥é“¾è¡¨å°¾éƒ¨ï¼Œå› æ­¤ä¸ä¼šå‡ºç°ç¯å½¢é“¾è¡¨çš„æƒ…å†µï¼Œä½†æ˜¯åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ä»ç„¶ä¸å®‰å…¨ï¼Œè¿™é‡Œæˆ‘ä»¬çœ‹jdk1.8ä¸­HashMapçš„putæ“ä½œæºç ï¼š



è¿™æ˜¯jdk1.8ä¸­HashMapä¸­putæ“ä½œçš„ä¸»å‡½æ•°ï¼Œ æ³¨æ„ç¬¬6è¡Œä»£ç ï¼Œå¦‚æœæ²¡æœ‰hashç¢°æ’åˆ™ä¼šç›´æ¥æ’å…¥å…ƒç´ ã€‚å¦‚æœçº¿ç¨‹Aå’Œçº¿ç¨‹BåŒæ—¶è¿›è¡Œputæ“ä½œï¼Œåˆšå¥½è¿™ä¸¤æ¡ä¸åŒçš„æ•°æ®hashå€¼ä¸€æ ·ï¼Œå¹¶ä¸”è¯¥ä½ç½®æ•°æ®ä¸ºnullï¼Œæ‰€ä»¥è¿™çº¿ç¨‹Aã€Béƒ½ä¼šè¿›å…¥ç¬¬6è¡Œä»£ç ä¸­ã€‚å‡è®¾ä¸€ç§æƒ…å†µï¼Œçº¿ç¨‹Aè¿›å…¥åè¿˜æœªè¿›è¡Œæ•°æ®æ’å…¥æ—¶æŒ‚èµ·ï¼Œè€Œçº¿ç¨‹Bæ­£å¸¸æ‰§è¡Œï¼Œä»è€Œæ­£å¸¸æ’å…¥æ•°æ®ï¼Œç„¶åçº¿ç¨‹Aè·å–CPUæ—¶é—´ç‰‡ï¼Œæ­¤æ—¶çº¿ç¨‹Aä¸ç”¨å†è¿›è¡Œhashåˆ¤æ–­äº†ï¼Œé—®é¢˜å‡ºç°ï¼šçº¿ç¨‹Aä¼šæŠŠçº¿ç¨‹Bæ’å…¥çš„æ•°æ®ç»™**è¦†ç›–**ï¼Œå‘ç”Ÿçº¿ç¨‹ä¸å®‰å…¨ã€‚

```java
public V put(K key, V value) {
    return putVal(hash(key), key, value, false, true);
}
final V putVal(int hash, K key, V value, boolean onlyIfAbsent,
                   boolean evict) {
    Node<K,V>[] tab; Node<K,V> p; int n, i;
    /**
     *1ï¼‰transient Node<K,V>[] table; è¡¨ç¤ºå­˜å‚¨Mapé›†åˆä¸­å…ƒç´ çš„æ•°ç»„ã€‚
     *2ï¼‰(tab = table) == null è¡¨ç¤ºå°†ç©ºçš„tableèµ‹å€¼ç»™tab,ç„¶ååˆ¤æ–­tabæ˜¯å¦ç­‰äºnullï¼Œç¬¬ä¸€æ¬¡è‚¯å®šæ˜¯null
     *3ï¼‰(n = tab.length) == 0 è¡¨ç¤ºå°†æ•°ç»„çš„é•¿åº¦0èµ‹å€¼ç»™n,ç„¶ååˆ¤æ–­næ˜¯å¦ç­‰äº0ï¼Œnç­‰äº0
     *ç”±äºifåˆ¤æ–­ä½¿ç”¨åŒæˆ–ï¼Œæ»¡è¶³ä¸€ä¸ªå³å¯ï¼Œåˆ™æ‰§è¡Œä»£ç  n = (tab = resize()).length; è¿›è¡Œæ•°ç»„åˆå§‹åŒ–ã€‚
     *å¹¶å°†åˆå§‹åŒ–å¥½çš„æ•°ç»„é•¿åº¦èµ‹å€¼ç»™n.
     *4ï¼‰æ‰§è¡Œå®Œn = (tab = resize()).lengthï¼Œæ•°ç»„tabæ¯ä¸ªç©ºé—´éƒ½æ˜¯null
     */
    if ((tab = table) == null || (n = tab.length) == 0)
        n = (tab = resize()).length;
    /**
     *1ï¼‰i = (n - 1) & hash è¡¨ç¤ºè®¡ç®—æ•°ç»„çš„ç´¢å¼•èµ‹å€¼ç»™iï¼Œå³ç¡®å®šå…ƒç´ å­˜æ”¾åœ¨å“ªä¸ªæ¡¶ä¸­
     *2ï¼‰p = tab[i = (n - 1) & hash]è¡¨ç¤ºè·å–è®¡ç®—å‡ºçš„ä½ç½®çš„æ•°æ®èµ‹å€¼ç»™èŠ‚ç‚¹p
     *3) (p = tab[i = (n - 1) & hash]) == null åˆ¤æ–­èŠ‚ç‚¹ä½ç½®æ˜¯å¦ç­‰äºnullï¼Œå¦‚æœä¸ºnullï¼Œåˆ™æ‰§è¡Œä»£ç ï¼štab[i] = newNode(hash, key, value, null);æ ¹æ®é”®å€¼å¯¹åˆ›å»ºæ–°çš„èŠ‚ç‚¹æ”¾å…¥è¯¥ä½ç½®çš„æ¡¶ä¸­
     *  å°ç»“ï¼šå¦‚æœå½“å‰æ¡¶æ²¡æœ‰å“ˆå¸Œç¢°æ’å†²çªï¼Œåˆ™ç›´æ¥æŠŠé”®å€¼å¯¹æ’å…¥ç©ºé—´ä½ç½®
     */ 
    if ((p = tab[i = (n - 1) & hash]) == null)
        //åˆ›å»ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹å­˜å…¥åˆ°æ¡¶ä¸­
        tab[i] = newNode(hash, key, value, null);
    else {
         // æ‰§è¡Œelseè¯´æ˜tab[i]ä¸ç­‰äºnullï¼Œè¡¨ç¤ºè¿™ä¸ªä½ç½®å·²ç»æœ‰å€¼äº†ã€‚
        Node<K,V> e; K k;
        /**
         *æ¯”è¾ƒæ¡¶ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ (æ•°ç»„ä¸­çš„ç»“ç‚¹)çš„hashå€¼å’Œkeyæ˜¯å¦ç›¸ç­‰
         *	1ï¼‰p.hash == hash ï¼šp.hashè¡¨ç¤ºåŸæ¥å­˜åœ¨æ•°æ®çš„hashå€¼  hashè¡¨ç¤ºåæ·»åŠ æ•°æ®çš„hashå€¼ æ¯”è¾ƒä¸¤ä¸ªhashå€¼æ˜¯å¦ç›¸ç­‰
         *    è¯´æ˜ï¼špè¡¨ç¤ºtab[i]ï¼Œå³ newNode(hash, key, value, null)æ–¹æ³•è¿”å›çš„Nodeå¯¹è±¡ã€‚
         *    Node<K,V> newNode(int hash, K key, V value, Node<K,V> next) 
         *    {
         *       return new Node<>(hash, key, value, next);
         *    }
         *    è€Œåœ¨Nodeç±»ä¸­å…·æœ‰æˆå‘˜å˜é‡hashç”¨æ¥è®°å½•ç€ä¹‹å‰æ•°æ®çš„hashå€¼çš„
         *  2ï¼‰(k = p.key) == key ï¼šp.keyè·å–åŸæ¥æ•°æ®çš„keyèµ‹å€¼ç»™k  key è¡¨ç¤ºåæ·»åŠ æ•°æ®çš„key æ¯”è¾ƒä¸¤ä¸ªkeyçš„åœ°å€å€¼æ˜¯å¦ç›¸ç­‰
         *  3ï¼‰key != null && key.equals(k)ï¼šèƒ½å¤Ÿæ‰§è¡Œåˆ°è¿™é‡Œè¯´æ˜ä¸¤ä¸ªkeyçš„åœ°å€å€¼ä¸ç›¸ç­‰ï¼Œé‚£ä¹ˆå…ˆåˆ¤æ–­åæ·»åŠ çš„keyæ˜¯å¦ç­‰äºnullï¼Œå¦‚æœä¸ç­‰äºnullå†è°ƒç”¨equalsæ–¹æ³•åˆ¤æ–­ä¸¤ä¸ªkeyçš„å†…å®¹æ˜¯å¦ç›¸ç­‰
         */
        if (p.hash == hash &&
            ((k = p.key) == key || (key != null && key.equals(k))))
                // è¯´æ˜ï¼šä¸¤ä¸ªå…ƒç´ å“ˆå¸Œå€¼ç›¸ç­‰ï¼Œå¹¶ä¸”keyçš„å€¼ä¹Ÿç›¸ç­‰
                // å°†æ—§çš„å…ƒç´ æ•´ä½“å¯¹è±¡èµ‹å€¼ç»™eï¼Œç”¨eæ¥è®°å½•
                e = p;
        // âš ï¸ hashå€¼ä¸ç›¸ç­‰æˆ–è€…keyä¸ç›¸ç­‰ï¼›åˆ¤æ–­pæ˜¯å¦ä¸ºçº¢é»‘æ ‘ç»“ç‚¹
        else if (p instanceof TreeNode)
            // è¯´æ˜æ˜¯è¯¥æ¡¶ä¸­æ˜¯çº¢é»‘æ ‘çš„å¤´èŠ‚ç‚¹ï¼ŒæŠŠæ–°èŠ‚ç‚¹æ”¾å…¥çº¢é»‘æ ‘ä¸­
            e = ((TreeNode<K,V>)p).putTreeVal(this, tab, hash, key, value);
        // è¯´æ˜æ˜¯é“¾è¡¨èŠ‚ç‚¹
        else {
            /**
            *	1)å¦‚æœæ˜¯é“¾è¡¨çš„è¯éœ€è¦éå†åˆ°æœ€åèŠ‚ç‚¹ç„¶åæ’å…¥
            *	2)é‡‡ç”¨å¾ªç¯éå†çš„æ–¹å¼ï¼Œåˆ¤æ–­é“¾è¡¨ä¸­æ˜¯å¦æœ‰é‡å¤çš„key
            */
            for (int binCount = 0; ; ++binCount) {
                /**
                 *	1)e = p.next è·å–pçš„ä¸‹ä¸€ä¸ªå…ƒç´ èµ‹å€¼ç»™e
                 *	2)(e = p.next) == null åˆ¤æ–­p.nextæ˜¯å¦ç­‰äºnullï¼Œç­‰äºnullï¼Œè¯´æ˜pæ²¡æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆæ­¤æ—¶åˆ°è¾¾äº†é“¾è¡¨çš„å°¾éƒ¨ï¼Œè¿˜æ²¡æœ‰æ‰¾åˆ°é‡å¤çš„key,åˆ™è¯´æ˜HashMapæ²¡æœ‰åŒ…å«è¯¥é”®ï¼›å°†è¯¥é”®å€¼å¯¹æ’å…¥é“¾è¡¨ä¸­
                 */
                if ((e = p.next) == null) {
                    /**
                     * 1ï¼‰åˆ›å»ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹æ’å…¥åˆ°å°¾éƒ¨  âš ï¸âš ï¸âš ï¸ å°¾æ’æ³•ï¼
                     * p.next = newNode(hash, key, value, null);
                     * Node<K,V> newNode(int hash, K key, V value, Node<K,V> next) 
                     * {
                     *          return new Node<>(hash, key, value, next);
                     *   }
                     * æ³¨æ„ç¬¬å››ä¸ªå‚æ•°nextæ˜¯nullï¼Œå› ä¸ºå½“å‰å…ƒç´ æ’å…¥åˆ°é“¾è¡¨æœ«å°¾äº†ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªèŠ‚ç‚¹è‚¯å®šæ˜¯null
                     * 2ï¼‰è¿™ç§æ·»åŠ æ–¹å¼ä¹Ÿæ»¡è¶³é“¾è¡¨æ•°æ®ç»“æ„çš„ç‰¹ç‚¹ï¼Œæ¯æ¬¡å‘åæ·»åŠ æ–°çš„å…ƒç´ 
                     */
                    p.next = newNode(hash, key, value, null);
                    /**
                     *1)èŠ‚ç‚¹æ·»åŠ å®Œæˆä¹‹ååˆ¤æ–­æ­¤æ—¶èŠ‚ç‚¹ä¸ªæ•°æ˜¯å¦å¤§äºTREEIFY_THRESHOLDä¸´ç•Œå€¼8ï¼Œå¦‚æœå¤§äº
                     * åˆ™å°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘
                     *2ï¼‰int binCount = 0 ï¼šè¡¨ç¤ºforå¾ªç¯çš„åˆå§‹åŒ–å€¼ã€‚ä»0å¼€å§‹è®¡æ•°ã€‚è®°å½•ç€éå†èŠ‚ç‚¹çš„ä¸ªæ•°ã€‚å€¼æ˜¯0è¡¨ç¤ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œ1è¡¨ç¤ºç¬¬äºŒä¸ªèŠ‚ç‚¹...
                     * TREEIFY_THRESHOLD - 1 = 7;
                     * å¦‚æœbinCountçš„å€¼æ˜¯7(åŠ ä¸Šæ•°ç»„ä¸­çš„çš„ä¸€ä¸ªå…ƒç´ ï¼Œå…ƒç´ ä¸ªæ•°æ˜¯8),æ­¤æ—¶è½¬æ¢çº¢é»‘æ ‘
                     */
                    if (binCount >= TREEIFY_THRESHOLD - 1) // -1 for 1st
                        //è½¬æ¢ä¸ºçº¢é»‘æ ‘
                        treeifyBin(tab, hash);
                    // è·³å‡ºå¾ªç¯
                    break;
                }
                 
                /**
                 *æ‰§è¡Œåˆ°è¿™é‡Œè¯´æ˜e = p.next ä¸æ˜¯nullï¼Œä¸æ˜¯æœ€åä¸€ä¸ªå…ƒç´ ã€‚ç»§ç»­åˆ¤æ–­é“¾è¡¨ä¸­ç»“ç‚¹çš„keyå€¼ä¸æ’å…¥çš„å…ƒç´ çš„keyå€¼æ˜¯å¦ç›¸ç­‰
                 */
                if (e.hash == hash &&
                    ((k = e.key) == key || (key != null && key.equals(k))))
                    // ç›¸ç­‰ï¼Œè·³å‡ºå¾ªç¯
                    /**
                     *è¦æ·»åŠ çš„å…ƒç´ å’Œé“¾è¡¨ä¸­çš„å­˜åœ¨çš„å…ƒç´ çš„keyç›¸ç­‰äº†ï¼Œåˆ™è·³å‡ºforå¾ªç¯ã€‚ä¸ç”¨å†ç»§ç»­æ¯”è¾ƒäº†
                     *	ç›´æ¥æ‰§è¡Œä¸‹é¢çš„ifè¯­å¥å»æ›¿æ¢å» if (e != null) 
                     */
                    break;
                    /**
                     *è¯´æ˜æ–°æ·»åŠ çš„å…ƒç´ å’Œå½“å‰èŠ‚ç‚¹ä¸ç›¸ç­‰ï¼Œç»§ç»­æŸ¥æ‰¾ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚
                     *ç”¨äºéå†æ¡¶ä¸­çš„é“¾è¡¨ï¼Œä¸å‰é¢çš„e = p.nextç»„åˆï¼Œå¯ä»¥éå†é“¾è¡¨
                     */
                    p = e;
            }
        }
        /**
         *è¡¨ç¤ºåœ¨æ¡¶ä¸­æ‰¾åˆ°keyå€¼ã€hashå€¼ä¸æ’å…¥å…ƒç´ ç›¸ç­‰çš„ç»“ç‚¹
         *ä¹Ÿå°±æ˜¯è¯´é€šè¿‡ä¸Šé¢çš„æ“ä½œæ‰¾åˆ°äº†é‡å¤çš„é”®ï¼Œæ‰€ä»¥è¿™é‡Œå°±æ˜¯æŠŠè¯¥é”®çš„å€¼å˜ä¸ºæ–°çš„å€¼ï¼Œå¹¶è¿”å›æ—§å€¼
         *è¿™é‡Œå®Œæˆäº†putæ–¹æ³•çš„ä¿®æ”¹åŠŸèƒ½
         */
        if (e != null) { 
            // è®°å½•eçš„value
            V oldValue = e.value;
            // onlyIfAbsentä¸ºfalseæˆ–è€…æ—§å€¼ä¸ºnull
            if (!onlyIfAbsent || oldValue == null)
                //ç”¨æ–°å€¼æ›¿æ¢æ—§å€¼
                //e.value è¡¨ç¤ºæ—§å€¼  valueè¡¨ç¤ºæ–°å€¼ 
                e.value = value;
            // è®¿é—®åå›è°ƒ
            afterNodeAccess(e);
            // è¿”å›æ—§å€¼
            return oldValue;
        }
    }
    //ä¿®æ”¹è®°å½•æ¬¡æ•°
    ++modCount;
    // åˆ¤æ–­å®é™…å¤§å°æ˜¯å¦å¤§äºthresholdé˜ˆå€¼ï¼Œå¦‚æœè¶…è¿‡åˆ™æ‰©å®¹
    if (++size > threshold)
        resize();
    // æ’å…¥åå›è°ƒ
    afterNodeInsertion(evict);
    return null;
} 
```



## å°ç»“



# æ€»ç»“

**HashMapç»å¯¹æ˜¯æœ€å¸¸é—®çš„é›†åˆä¹‹ä¸€**ï¼ŒåŸºæœ¬ä¸Šæ‰€æœ‰ç‚¹éƒ½è¦**çƒ‚ç†Ÿäºå¿ƒ**çš„é‚£ç§ï¼ŒHashMapå¸¸è§é¢è¯•é¢˜ï¼š

- HashMapçš„åº•å±‚æ•°æ®ç»“æ„ï¼Ÿ
- HashMapçš„å­˜å–åŸç†ï¼Ÿ
- Java7å’ŒJava8çš„åŒºåˆ«ï¼Ÿ
- ä¸ºå•¥ä¼šçº¿ç¨‹ä¸å®‰å…¨ï¼Ÿ
- æœ‰ä»€ä¹ˆçº¿ç¨‹å®‰å…¨çš„ç±»ä»£æ›¿ä¹ˆ?
- é»˜è®¤åˆå§‹åŒ–å¤§å°æ˜¯å¤šå°‘ï¼Ÿä¸ºå•¥æ˜¯è¿™ä¹ˆå¤šï¼Ÿä¸ºå•¥å¤§å°éƒ½æ˜¯2çš„å¹‚ï¼Ÿ
- HashMapçš„æ‰©å®¹æ–¹å¼ï¼Ÿè´Ÿè½½å› å­æ˜¯å¤šå°‘ï¼Ÿä¸ºä»€æ˜¯è¿™ä¹ˆå¤šï¼Ÿ
- HashMapçš„ä¸»è¦å‚æ•°éƒ½æœ‰å“ªäº›ï¼Ÿ
- HashMapæ˜¯æ€ä¹ˆå¤„ç†hashç¢°æ’çš„ï¼Ÿ
- hashçš„è®¡ç®—è§„åˆ™ï¼Ÿ