---
scrolllayout: post
title:  "StringTable"
date:   2020-08-12 10:29:06 +0800--
categories: [Java]
tags: [JVM, ]  
---

# StringTable

> æ¥æºï¼šå°šç¡…è°·å®‹çº¢åº·JVMæ•™ç¨‹ 

## Stringçš„åŸºæœ¬ç‰¹æ€§

- Stringï¼šå­—ç¬¦ä¸²ï¼Œä½¿ç”¨ä¸€å¯¹ "" å¼•èµ·æ¥è¡¨ç¤º
  - String s1 = "mogublog" ;   // å­—é¢é‡çš„å®šä¹‰æ–¹å¼
  - String s2 =  new String("moxi"); 
- ***String å£°æ˜ä¸º finalçš„ï¼Œä¸å¯è¢«ç»§æ‰¿***
- Stringå®ç°äº†Serializableæ¥å£ï¼šè¡¨ç¤ºå­—ç¬¦ä¸²æ˜¯æ”¯æŒåºåˆ—åŒ–çš„ã€‚å®ç°äº†Comparableæ¥å£ï¼šè¡¨ç¤º Stringå¯ä»¥æ¯”è¾ƒå¤§å°
- ***String åœ¨jdk8åŠä»¥å‰å†…éƒ¨å®šä¹‰äº†final char[] valueç”¨äºå­˜å‚¨å­—ç¬¦ä¸²æ•°æ®ã€‚JDK9æ—¶æ”¹ä¸ºbyte[]***

### ä¸ºä»€ä¹ˆJDK9æ”¹å˜äº†ç»“æ„

***Stringç±»çš„å½“å‰å®ç°å°†å­—ç¬¦å­˜å‚¨åœ¨charæ•°ç»„ä¸­ï¼Œæ¯ä¸ªå­—ç¬¦ä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚(16ä½)ã€‚ä»è®¸å¤šä¸åŒçš„åº”ç”¨ç¨‹åºæ”¶é›†çš„æ•°æ®è¡¨æ˜ï¼Œå­—ç¬¦ä¸²æ˜¯å †ä½¿ç”¨çš„ä¸»è¦ç»„æˆéƒ¨åˆ†ï¼Œè€Œä¸”ï¼Œå¤§å¤šæ•°å­—ç¬¦ä¸²å¯¹è±¡åªåŒ…å«æ‹‰ä¸å­—ç¬¦ã€‚è¿™äº›å­—ç¬¦åªéœ€è¦ä¸€ä¸ªå­—èŠ‚çš„å­˜å‚¨ç©ºé—´ï¼Œå› æ­¤è¿™äº›å­—ç¬¦ä¸²å¯¹è±¡çš„å†…éƒ¨charæ•°ç»„ä¸­æœ‰ä¸€åŠçš„ç©ºé—´å°†ä¸ä¼šä½¿ç”¨ã€‚***

æˆ‘ä»¬å»ºè®®æ”¹å˜å­—ç¬¦ä¸²çš„å†…éƒ¨è¡¨ç¤ºclasÅ¡ä»utf - 16å­—ç¬¦æ•°ç»„åˆ°å­—èŠ‚æ•°ç»„+ä¸€ä¸ªencoding-flagå­—æ®µã€‚***æ–°çš„Stringç±»å°†æ ¹æ®å­—ç¬¦ä¸²çš„å†…å®¹å­˜å‚¨ç¼–ç ä¸ºISO-8859-1/Latin-1(æ¯ä¸ªå­—ç¬¦ä¸€ä¸ªå­—èŠ‚)æˆ–UTF-16(æ¯ä¸ªå­—ç¬¦ä¸¤ä¸ªå­—èŠ‚)çš„å­—ç¬¦ã€‚ç¼–ç æ ‡å¿—å°†æŒ‡ç¤ºä½¿ç”¨å“ªç§ç¼–ç ã€‚***

***ç»“è®º***ï¼šStringå†ä¹Ÿä¸ç”¨char[] æ¥å­˜å‚¨äº†ï¼Œæ”¹æˆäº†byte [] åŠ ä¸Šç¼–ç æ ‡è®°ï¼ŒèŠ‚çº¦äº†ä¸€äº›ç©ºé—´

```java
// ä¹‹å‰
private final char value[];
// ä¹‹å
private final byte[] value
```

åŒæ—¶åŸºäºStringçš„æ•°æ®ç»“æ„ï¼Œä¾‹å¦‚***StringBufferå’ŒStringBuilderä¹ŸåŒæ ·åšäº†ä¿®æ”¹***

### Stringçš„ä¸å¯å˜æ€§

***Stringï¼šä»£è¡¨ä¸å¯å˜çš„å­—ç¬¦åºåˆ—ã€‚ç®€ç§°ï¼šä¸å¯å˜æ€§ã€‚***

>å½“å¯¹å­—ç¬¦ä¸²é‡æ–°èµ‹å€¼æ—¶ï¼Œéœ€è¦é‡å†™æŒ‡å®šå†…å­˜åŒºåŸŸèµ‹å€¼ï¼Œä¸èƒ½ä½¿ç”¨åŸæœ‰çš„valueè¿›è¡Œèµ‹å€¼ã€‚
>å½“å¯¹ç°æœ‰çš„å­—ç¬¦ä¸²è¿›è¡Œè¿æ¥æ“ä½œæ—¶ï¼Œä¹Ÿéœ€è¦é‡æ–°æŒ‡å®šå†…å­˜åŒºåŸŸèµ‹å€¼ï¼Œä¸èƒ½ä½¿ç”¨åŸæœ‰çš„valueè¿›è¡Œèµ‹å€¼ã€‚
>å½“è°ƒç”¨stringçš„replaceï¼ˆï¼‰æ–¹æ³•ä¿®æ”¹æŒ‡å®šå­—ç¬¦æˆ–å­—ç¬¦ä¸²æ—¶ï¼Œä¹Ÿéœ€è¦é‡æ–°æŒ‡å®šå†…å­˜åŒºåŸŸèµ‹å€¼ï¼Œä¸èƒ½ä½¿ç”¨åŸæœ‰çš„valueè¿›è¡Œèµ‹å€¼ã€‚
>é€šè¿‡å­—é¢é‡çš„æ–¹å¼ï¼ˆåŒºåˆ«äºnewï¼‰ç»™ä¸€ä¸ªå­—ç¬¦ä¸²èµ‹å€¼ï¼Œæ­¤æ—¶çš„å­—ç¬¦ä¸²å€¼å£°æ˜åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ã€‚

ä»£ç 

```java
/**
 * Stringçš„ä¸å¯å˜æ€§
 */
public class StringTest1 {

    public static void test1() {
        // å­—é¢é‡å®šä¹‰çš„æ–¹å¼ï¼Œâ€œabcâ€å­˜å‚¨åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­
        String s1 = "abc";
        String s2 = "abc";
        System.out.println(s1 == s2);
        s1 = "hello";
        System.out.println(s1 == s2);
        System.out.println(s1);
        System.out.println(s2);
        System.out.println("----------------");
    }

    public static void test2() {
        String s1 = "abc";
        String s2 = "abc";
        // åªè¦è¿›è¡Œäº†ä¿®æ”¹ï¼Œå°±ä¼šé‡æ–°åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œè¿™å°±æ˜¯ä¸å¯å˜æ€§
        s2 += "def";
        System.out.println(s1);
        System.out.println(s2);
        System.out.println("----------------");
    }

    public static void test3() {
        String s1 = "abc";
        String s2 = s1.replace('a', 'm');
        System.out.println(s1);
        System.out.println(s2);
    }

    public static void main(String[] args) {
        test1();
        test2();
        test3();
    }
}
```

è¿è¡Œç»“æœ

```
true
false
hello
abc
----------------
abc
abcdef
----------------
abc
mbc
```

### é¢è¯•é¢˜

```java
/**
 * é¢è¯•é¢˜
 */
public class StringExer {
    String str = new String("good");
    char [] ch = {'t','e','s','t'};

    public void change(String str, char ch []) {
        str = "test ok";
        ch[0] = 'b';
    }

    public static void main(String[] args) {
        StringExer ex = new StringExer();
        ex.change(ex.str, ex.ch);
        System.out.println(ex.str);
        System.out.println(ex.ch);
    }
}
```

è¾“å‡ºç»“æœ

```
good
best
```

### æ³¨æ„

**å­—ç¬¦ä¸²å¸¸é‡æ± æ˜¯ä¸ä¼šå­˜å‚¨ç›¸åŒå†…å®¹çš„å­—ç¬¦ä¸²çš„**

***Stringçš„String Poolæ˜¯ä¸€ä¸ªå›ºå®šå¤§å°çš„Hashtableï¼Œé»˜è®¤å€¼å¤§å°é•¿åº¦æ˜¯1009ã€‚***å¦‚æœæ”¾è¿›String Poolçš„Stringéå¸¸å¤šï¼Œå°±ä¼šé€ æˆHashå†²çªä¸¥é‡ï¼Œä»è€Œå¯¼è‡´é“¾è¡¨ä¼šå¾ˆé•¿ï¼Œè€Œé“¾è¡¨é•¿äº†åç›´æ¥ä¼šé€ æˆçš„å½±å“å°±æ˜¯å½“è°ƒç”¨String.internæ—¶æ€§èƒ½ä¼šå¤§å¹…ä¸‹é™ã€‚

***ä½¿ç”¨-XX:StringTablesizeå¯è®¾ç½® StringTableçš„é•¿åº¦***

åœ¨jdk6ä¸­stringTableæ˜¯å›ºå®šçš„ï¼Œå°±æ˜¯***1009***çš„é•¿åº¦ï¼Œæ‰€ä»¥å¦‚æœå¸¸é‡æ± ä¸­çš„å­—ç¬¦ä¸²è¿‡å¤šå°±ä¼šå¯¼è‡´æ•ˆç‡ä¸‹é™å¾ˆå¿«ã€‚stringTablesizeè®¾ç½®æ²¡æœ‰è¦æ±‚

***åœ¨jdk7ä¸­ï¼ŒstringTableçš„é•¿åº¦é»˜è®¤å€¼æ˜¯60013ï¼Œ***

***åœ¨JDK8å¼€å§‹ï¼ŒStringTableå¯ä»¥è®¾ç½®çš„æœ€å°å€¼ä¸º1009***

## Stringçš„å†…å­˜åˆ†é…

åœ¨ Javaè¯­è¨€ä¸­æœ‰8ç§åŸºæœ¬æ•°æ®ç±»å‹å’Œä¸€ç§æ¯”è¾ƒç‰¹æ®Šçš„ç±»å‹stringã€‚è¿™äº›ç±»å‹ä¸ºäº†ä½¿å®ƒä»¬åœ¨è¿è¡Œè¿‡ç¨‹ä¸­é€Ÿåº¦æ›´å¿«ã€æ›´èŠ‚çœå†…å­˜ï¼Œéƒ½æä¾›äº†ä¸€ç§å¸¸é‡æ± çš„æ¦‚å¿µã€‚

å¸¸é‡æ± å°±ç±»ä¼¼ä¸€ä¸ªJavaç³»ç»Ÿçº§åˆ«æä¾›çš„ç¼“å­˜ã€‚8ç§åŸºæœ¬æ•°æ®ç±»å‹çš„å¸¸é‡æ± éƒ½æ˜¯ç³»ç»Ÿåè°ƒçš„ï¼Œ***Stringç±»å‹çš„å¸¸é‡æ± æ¯”è¾ƒç‰¹æ®Šã€‚å®ƒçš„ä¸»è¦ä½¿ç”¨æ–¹æ³•æœ‰ä¸¤ç§ã€‚***

ç›´æ¥ä½¿ç”¨åŒå¼•å·å£°æ˜å‡ºæ¥çš„Stringå¯¹è±¡ä¼šç›´æ¥å­˜å‚¨åœ¨å¸¸é‡æ± ä¸­ã€‚

- æ¯”å¦‚ï¼šstring info="atguigu.com"ï¼›

å¦‚æœä¸æ˜¯ç”¨åŒå¼•å·å£°æ˜çš„stringå¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨stringæä¾›çš„internï¼ˆï¼‰æ–¹æ³•ã€‚

Java 6åŠä»¥å‰ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± å­˜æ”¾åœ¨æ°¸ä¹…ä»£

***Java 7ä¸­ oracleçš„å·¥ç¨‹å¸ˆå¯¹å­—ç¬¦ä¸²æ± çš„é€»è¾‘åšäº†å¾ˆå¤§çš„æ”¹å˜ï¼Œå³å°†å­—ç¬¦ä¸²å¸¸é‡æ± çš„ä½ç½®è°ƒæ•´åˆ°Javaå †å†…***

>æ‰€æœ‰çš„å­—ç¬¦ä¸²éƒ½ä¿å­˜åœ¨å †ï¼ˆHeapï¼‰ä¸­ï¼Œå’Œå…¶ä»–æ™®é€šå¯¹è±¡ä¸€æ ·ï¼Œè¿™æ ·å¯ä»¥è®©ä½ åœ¨è¿›è¡Œè°ƒä¼˜åº”ç”¨æ—¶ä»…éœ€è¦è°ƒæ•´å †å¤§å°å°±å¯ä»¥äº†ã€‚
>
>å­—ç¬¦ä¸²å¸¸é‡æ± æ¦‚å¿µåŸæœ¬ä½¿ç”¨å¾—æ¯”è¾ƒå¤šï¼Œä½†æ˜¯è¿™ä¸ªæ”¹åŠ¨ä½¿å¾—æˆ‘ä»¬æœ‰è¶³å¤Ÿçš„ç†ç”±è®©æˆ‘ä»¬é‡æ–°è€ƒè™‘åœ¨Java 7ä¸­ä½¿ç”¨string.internï¼ˆï¼‰ã€‚

Java8å…ƒç©ºé—´ï¼Œå­—ç¬¦ä¸²å¸¸é‡åœ¨å †

![image-20200711093546398](/assets/imgs/image-20200711093546398.png)

![image-20200711093558709](/assets/imgs/image-20200711093558709.png)

### ä¸ºä»€ä¹ˆStringTableä»æ°¸ä¹…ä»£è°ƒæ•´åˆ°å †ä¸­

åœ¨JDK 7ä¸­ï¼Œinternedå­—ç¬¦ä¸²ä¸å†åœ¨Javaå †çš„æ°¸ä¹…ç”Ÿæˆä¸­åˆ†é…ï¼Œè€Œæ˜¯åœ¨Javaå †çš„ä¸»è¦éƒ¨åˆ†(ç§°ä¸ºå¹´è½»ä»£å’Œå¹´è€ä»£)ä¸­åˆ†é…ï¼Œä¸åº”ç”¨ç¨‹åºåˆ›å»ºçš„å…¶ä»–å¯¹è±¡ä¸€èµ·åˆ†é…ã€‚æ­¤æ›´æ”¹å°†å¯¼è‡´é©»ç•™åœ¨ä¸»Javaå †ä¸­çš„æ•°æ®æ›´å¤šï¼Œé©»ç•™åœ¨æ°¸ä¹…ç”Ÿæˆä¸­çš„æ•°æ®æ›´å°‘ï¼Œå› æ­¤å¯èƒ½éœ€è¦è°ƒæ•´å †å¤§å°ã€‚ç”±äºè¿™ä¸€å˜åŒ–ï¼Œå¤§å¤šæ•°åº”ç”¨ç¨‹åºåœ¨å †ä½¿ç”¨æ–¹é¢åªä¼šçœ‹åˆ°ç›¸å¯¹è¾ƒå°çš„å·®å¼‚ï¼Œä½†åŠ è½½è®¸å¤šç±»æˆ–å¤§é‡ä½¿ç”¨å­—ç¬¦ä¸²çš„è¾ƒå¤§åº”ç”¨ç¨‹åºä¼šå‡ºç°è¿™ç§å·®å¼‚ã€‚intern()æ–¹æ³•ä¼šçœ‹åˆ°æ›´æ˜¾è‘—çš„å·®å¼‚ã€‚

- ***æ°¸ä¹…ä»£çš„é»˜è®¤æ¯”è¾ƒå°***
- ***æ°¸ä¹…ä»£åƒåœ¾å›æ”¶é¢‘ç‡ä½***

### Stringçš„åŸºæœ¬æ“ä½œ

***Javaè¯­è¨€è§„èŒƒé‡Œè¦æ±‚å®Œå…¨ç›¸åŒçš„å­—ç¬¦ä¸²å­—é¢é‡ï¼Œåº”è¯¥åŒ…å«åŒæ ·çš„Unicodeå­—ç¬¦åºåˆ—ï¼ˆåŒ…å«åŒä¸€ä»½ç ç‚¹åºåˆ—çš„å¸¸é‡ï¼‰ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯æŒ‡å‘åŒä¸€ä¸ªStringç±»å®ä¾‹ã€‚***

## å­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œ ğŸ§ 

- ***å¸¸é‡ä¸å¸¸é‡çš„æ‹¼æ¥ç»“æœåœ¨å¸¸é‡æ± ï¼ŒåŸç†æ˜¯ç¼–è¯‘æœŸä¼˜åŒ–***
- ***å¸¸é‡æ± ä¸­ä¸ä¼šå­˜åœ¨ç›¸åŒå†…å®¹çš„å˜é‡***
- ***åªè¦å…¶ä¸­æœ‰ä¸€ä¸ªæ˜¯å˜é‡ï¼Œç»“æœå°±åœ¨å †ä¸­ã€‚å˜é‡æ‹¼æ¥çš„åŸç†æ˜¯StringBuilder***
- ***å¦‚æœæ‹¼æ¥çš„ç»“æœè°ƒç”¨intern()æ–¹æ³•ï¼Œåˆ™ä¸»åŠ¨å°†å¸¸é‡æ± ä¸­è¿˜æ²¡æœ‰çš„å­—ç¬¦ä¸²å¯¹è±¡æ”¾å…¥æ± ä¸­ï¼Œå¹¶è¿”å›æ­¤å¯¹è±¡åœ°å€***

```java
    public static void test1() {
        String s1 = "a" + "b" + "c";  // å¾—åˆ° abcçš„å¸¸é‡æ± 
        String s2 = "abc"; // abcå­˜æ”¾åœ¨å¸¸é‡æ± ï¼Œç›´æ¥å°†å¸¸é‡æ± çš„åœ°å€è¿”å›
        /**
         * æœ€ç»ˆjavaç¼–è¯‘æˆ.classï¼Œå†æ‰§è¡Œ.class
         */
        System.out.println(s1 == s2); // trueï¼Œå› ä¸ºå­˜æ”¾åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± 
        System.out.println(s1.equals(s2)); // true
    }

	public static void test2() {
        String s1 = "javaEE";
        String s2 = "hadoop";
        String s3 = "javaEEhadoop";
        String s4 = "javaEE" + "hadoop";// ç¼–è¯‘æœŸä¼˜åŒ– å¸¸é‡ä¸å¸¸é‡çš„æ‹¼æ¥ç»“æœåœ¨å¸¸é‡æ± 
    		//å¦‚æœæ‹¼æ¥ç¬¦å·çš„å‰åå‡ºç°äº†å˜é‡ï¼Œåˆ™ç›¸å½“äºåœ¨å †ç©ºé—´ä¸­new String()ï¼Œå…·ä½“çš„å†…å®¹ä¸ºæ‹¼æ¥çš„ç»“æœ
        String s5 = s1 + "hadoop";
        String s6 = "javaEE" + s2;
        String s7 = s1 + s2;

        System.out.println(s3 == s4); // true
        System.out.println(s3 == s5); // false
        System.out.println(s3 == s6); // false
        System.out.println(s3 == s7); // false
        System.out.println(s5 == s6); // false
        System.out.println(s5 == s7); // false
        System.out.println(s6 == s7); // false

        String s8 = s6.intern();
    		// è€Œè°ƒç”¨internæ–¹æ³•ï¼Œåˆ™ä¼šåˆ¤æ–­å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æ˜¯å¦å­˜åœ¨JavaEEhadoopå€¼ï¼Œå¦‚æœå­˜åœ¨åˆ™è¿”å›å¸¸é‡æ± ä¸­çš„å€¼ï¼Œå¦è€…å°±åœ¨å¸¸é‡æ± ä¸­åˆ›å»º
        System.out.println(s3 == s8); // true
    }
```

ä»ä¸Šè¿°çš„ç»“æœæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼š

***å¦‚æœæ‹¼æ¥ç¬¦å·çš„å‰åå‡ºç°äº†å˜é‡ï¼Œåˆ™ç›¸å½“äºåœ¨å †ç©ºé—´ä¸­new String()ï¼Œå…·ä½“çš„å†…å®¹ä¸ºæ‹¼æ¥çš„ç»“æœ***

***è€Œè°ƒç”¨internæ–¹æ³•ï¼Œåˆ™ä¼šåˆ¤æ–­å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æ˜¯å¦å­˜åœ¨JavaEEhadoopå€¼ï¼Œå¦‚æœå­˜åœ¨åˆ™è¿”å›å¸¸é‡æ± ä¸­çš„å€¼ï¼Œå¦è€…å°±åœ¨å¸¸é‡æ± ä¸­åˆ›å»º***

### åº•å±‚åŸç†

***æ‹¼æ¥æ“ä½œçš„åº•å±‚å…¶å®ä½¿ç”¨äº†StringBuilder***

![image-20200711102231129](/assets/imgs/image-20200711102231129.png)

***s1 + s2çš„æ‰§è¡Œç»†èŠ‚***

1. ***StringBuilder s = new StringBuilder();***

2. ***s.append(s1);***

3. ***s.append(s2);***

4. ***s.toString();  -> çº¦ç­‰äº new String("ab");***

***è¡¥å……ï¼šåœ¨JDK5ä¹‹åï¼Œä½¿ç”¨çš„æ˜¯StringBuilderï¼Œåœ¨ JDK5ä¹‹å‰ä½¿ç”¨çš„æ˜¯StringBuffer***



| String                                                       | StringBuffer                                                 | StringBuilder    |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ---------------- |
| Stringçš„å€¼æ˜¯ä¸å¯å˜çš„ï¼Œè¿™å°±å¯¼è‡´æ¯æ¬¡å¯¹Stringçš„æ“ä½œéƒ½ä¼šç”Ÿæˆæ–°çš„Stringå¯¹è±¡ï¼Œä¸ä»…æ•ˆç‡ä½ä¸‹ï¼Œè€Œä¸”æµªè´¹å¤§é‡ä¼˜å…ˆçš„å†…å­˜ç©ºé—´ | StringBufferæ˜¯å¯å˜ç±»ï¼Œå’Œçº¿ç¨‹å®‰å…¨çš„å­—ç¬¦ä¸²æ“ä½œç±»ï¼Œä»»ä½•å¯¹å®ƒæŒ‡å‘çš„å­—ç¬¦ä¸²çš„æ“ä½œéƒ½ä¸ä¼šäº§ç”Ÿæ–°çš„å¯¹è±¡ã€‚æ¯ä¸ªStringBufferå¯¹è±¡éƒ½æœ‰ä¸€å®šçš„ç¼“å†²åŒºå®¹é‡ï¼Œå½“å­—ç¬¦ä¸²å¤§å°æ²¡æœ‰è¶…è¿‡å®¹é‡æ—¶ï¼Œä¸ä¼šåˆ†é…æ–°çš„å®¹é‡ï¼Œå½“å­—ç¬¦ä¸²å¤§å°è¶…è¿‡å®¹é‡æ—¶ï¼Œä¼šè‡ªåŠ¨å¢åŠ å®¹é‡ | å¯å˜ç±»ï¼Œé€Ÿåº¦æ›´å¿« |
| ä¸å¯å˜                                                       | å¯å˜                                                         | å¯å˜             |
|                                                              | çº¿ç¨‹å®‰å…¨                                                     | çº¿ç¨‹ä¸å®‰å…¨       |
|                                                              | å¤šçº¿ç¨‹æ“ä½œå­—ç¬¦ä¸²                                             | å•çº¿ç¨‹æ“ä½œå­—ç¬¦ä¸² |

***æ³¨æ„ï¼šæˆ‘ä»¬å·¦å³ä¸¤è¾¹å¦‚æœæ˜¯å˜é‡çš„è¯ï¼Œå°±æ˜¯éœ€è¦new StringBuilderè¿›è¡Œæ‹¼æ¥ï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨çš„æ˜¯finalä¿®é¥°æˆ–è€…å¸¸é‡å¼•ç”¨ï¼Œåˆ™æ˜¯ä»å¸¸é‡æ± ä¸­è·å–ã€‚æ‰€ä»¥è¯´æ‹¼æ¥ç¬¦å·å·¦å³ä¸¤è¾¹éƒ½æ˜¯å­—ç¬¦ä¸²å¸¸é‡æˆ–å¸¸é‡å¼•ç”¨ åˆ™ä»ç„¶ä½¿ç”¨ç¼–è¯‘å™¨ä¼˜åŒ–ã€‚ä¹Ÿå°±æ˜¯è¯´è¢«finalä¿®é¥°çš„å˜é‡ï¼Œå°†ä¼šå˜æˆå¸¸é‡ï¼Œç±»å’Œæ–¹æ³•å°†ä¸èƒ½è¢«ç»§æ‰¿ã€‚***

- ***åœ¨å¼€å‘ä¸­ï¼Œèƒ½å¤Ÿä½¿ç”¨finalçš„æ—¶å€™ï¼Œå»ºè®®ä½¿ç”¨ä¸Š***

```java
public static void test4() {
  	// å¦‚æœä½¿ç”¨çš„æ˜¯finalä¿®é¥°ï¼Œåˆ™æ˜¯ä»å¸¸é‡æ± ä¸­è·å– åˆ™ä»ç„¶ä½¿ç”¨ç¼–è¯‘å™¨ä¼˜åŒ–
    final String s1 = "a";
    final String s2 = "b";
    String s3 = "ab";
    String s4 = s1 + s2;
    System.out.println(s3 == s4);
}
```

è¿è¡Œç»“æœ

```
true
```

### æ‹¼æ¥æ“ä½œå’Œappendæ€§èƒ½å¯¹æ¯”

```java
    public static void method1(int highLevel) {
        String src = "";
        for (int i = 0; i < highLevel; i++) {
            src += "a"; // æ¯æ¬¡å¾ªç¯éƒ½ä¼šåˆ›å»ºä¸€ä¸ªStringBuilderå’ŒStringå¯¹è±¡
        }
    }

    public static void method2(int highLevel) {
      // åªéœ€è¦åˆ›å»ºä¸€ä¸ªStringBuilderå¯¹è±¡
        StringBuilder sb = new StringBuilder();
        for (int i = 0; i < highLevel; i++) {
            sb.append("a");
        }
    }
```

æ–¹æ³•1è€—è´¹çš„æ—¶é—´ï¼š4005msï¼Œæ–¹æ³•2æ¶ˆè€—æ—¶é—´ï¼š7ms

***ç»“è®ºï¼š***

- ***é€šè¿‡StringBuilderçš„append()æ–¹å¼æ·»åŠ å­—ç¬¦ä¸²çš„æ•ˆç‡ï¼Œè¦è¿œè¿œé«˜äºStringçš„å­—ç¬¦ä¸²æ‹¼æ¥æ–¹æ³•***

***å¥½å¤„ï¼š***

- ***StringBuilderçš„appendçš„æ–¹å¼ï¼Œè‡ªå§‹è‡³ç»ˆåªåˆ›å»ºä¸€ä¸ªStringBuilderçš„å¯¹è±¡***
- ***å¯¹äºå­—ç¬¦ä¸²æ‹¼æ¥çš„æ–¹å¼ï¼Œè¿˜éœ€è¦åˆ›å»ºå¾ˆå¤šStringBuilderå¯¹è±¡å’Œ è°ƒç”¨toStringæ—¶å€™åˆ›å»ºçš„Stringå¯¹è±¡***
- ***å†…å­˜ä¸­ç”±äºåˆ›å»ºäº†è¾ƒå¤šçš„StringBuilderå’ŒStringå¯¹è±¡ï¼Œå†…å­˜å ç”¨è¿‡å¤§ï¼Œå¦‚æœè¿›è¡ŒGCé‚£ä¹ˆå°†ä¼šè€—è´¹æ›´å¤šçš„æ—¶é—´***

**æ”¹è¿›çš„ç©ºé—´ï¼š**

- æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯StringBuilderçš„ç©ºå‚æ„é€ å™¨ï¼Œé»˜è®¤çš„å­—ç¬¦ä¸²å®¹é‡æ˜¯16ï¼Œç„¶åå°†åŸæ¥çš„å­—ç¬¦ä¸²æ‹·è´åˆ°æ–°çš„å­—ç¬¦ä¸²ä¸­ï¼Œ æˆ‘ä»¬ä¹Ÿå¯ä»¥é»˜è®¤åˆå§‹åŒ–æ›´å¤§çš„é•¿åº¦ï¼Œå‡å°‘æ‰©å®¹çš„æ¬¡æ•°

- å› æ­¤åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬èƒ½å¤Ÿç¡®å®šï¼Œå‰å‰ååéœ€è¦æ·»åŠ çš„å­—ç¬¦ä¸²ä¸é«˜äºæŸä¸ªé™å®šå€¼highLevelï¼Œé‚£ä¹ˆå»ºè®®ä½¿ç”¨æ„é€ å™¨åˆ›å»ºä¸€ä¸ªé˜ˆå€¼çš„é•¿åº¦ 

  ```java
  StringBuilder s = new StringBuilder(highLevel); // new char[highLevel]
  ```

  

## intern()çš„ä½¿ç”¨ ğŸ§

internæ˜¯ä¸€ä¸ªnativeæ–¹æ³•ï¼Œè°ƒç”¨çš„æ˜¯åº•å±‚Cçš„æ–¹æ³•ã€‚

***å­—ç¬¦ä¸²æ± æœ€åˆæ˜¯ç©ºçš„ï¼Œç”±Stringç±»ç§æœ‰åœ°ç»´æŠ¤ã€‚åœ¨è°ƒç”¨internæ–¹æ³•æ—¶ï¼Œå¦‚æœæ± ä¸­å·²ç»åŒ…å«äº†ç”±equals(object)æ–¹æ³•ç¡®å®šçš„ä¸è¯¥å­—ç¬¦ä¸²å¯¹è±¡ç›¸ç­‰çš„å­—ç¬¦ä¸²ï¼Œåˆ™è¿”å›æ± ä¸­çš„å­—ç¬¦ä¸²ã€‚å¦åˆ™ï¼Œè¯¥å­—ç¬¦ä¸²å¯¹è±¡å°†è¢«æ·»åŠ åˆ°æ± ä¸­ï¼Œå¹¶è¿”å›å¯¹è¯¥å­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨ã€‚***

***å¦‚æœä¸æ˜¯ç”¨åŒå¼•å·å£°æ˜çš„stringå¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨stringæä¾›çš„internæ–¹æ³•ï¼šinternæ–¹æ³•ä¼šä»å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æŸ¥è¯¢å½“å‰å­—ç¬¦ä¸²æ˜¯å¦å­˜åœ¨ï¼Œè‹¥ä¸å­˜åœ¨å°±ä¼šå°†å½“å‰å­—ç¬¦ä¸²æ”¾å…¥å¸¸é‡æ± ä¸­ã€‚***

æ¯”å¦‚ï¼š

```java
/**
* å¦‚ä½•ä¿è¯å˜é‡sæŒ‡å‘çš„æ˜¯å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„æ•°æ®ï¼Ÿ
* æ–¹å¼ä¸€ï¼š String s = "silince"; //å­—é¢é‡å®šä¹‰çš„æ–¹å¼
* æ–¹å¼äºŒï¼š String s = new StringBuilder("silince").toString.intern(); // è°ƒç”¨intern()æ–¹æ³•
*/
String myInfo = new string("I love atguigu").intern();
```

ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåœ¨ä»»æ„å­—ç¬¦ä¸²ä¸Šè°ƒç”¨string.internæ–¹æ³•ï¼Œé‚£ä¹ˆå…¶è¿”å›ç»“æœæ‰€æŒ‡å‘çš„é‚£ä¸ªç±»å®ä¾‹ï¼Œå¿…é¡»å’Œç›´æ¥ä»¥å¸¸é‡å½¢å¼å‡ºç°çš„å­—ç¬¦ä¸²å®ä¾‹å®Œå…¨ç›¸åŒã€‚å› æ­¤ï¼Œä¸‹åˆ—è¡¨è¾¾å¼çš„å€¼å¿…å®šæ˜¯true

```java
ï¼ˆ"a"+"b"+"c"ï¼‰.internï¼ˆï¼‰=="abc" //true
```

***é€šä¿—ç‚¹è®²ï¼ŒInterned stringå°±æ˜¯ç¡®ä¿å­—ç¬¦ä¸²åœ¨å†…å­˜é‡Œåªæœ‰ä¸€ä»½æ‹·è´ï¼Œè¿™æ ·å¯ä»¥èŠ‚çº¦å†…å­˜ç©ºé—´ï¼ŒåŠ å¿«å­—ç¬¦ä¸²æ“ä½œä»»åŠ¡çš„æ‰§è¡Œé€Ÿåº¦ã€‚æ³¨æ„ï¼Œè¿™ä¸ªå€¼ä¼šè¢«å­˜æ”¾åœ¨å­—ç¬¦ä¸²å†…éƒ¨æ± ï¼ˆString Intern Poolï¼‰***ã€‚



### internçš„ç©ºé—´æ•ˆç‡æµ‹è¯•

æˆ‘ä»¬é€šè¿‡æµ‹è¯•ä¸€ä¸‹ï¼Œä½¿ç”¨äº†internå’Œä¸ä½¿ç”¨çš„æ—¶å€™ï¼Œå…¶å®ç›¸å·®è¿˜æŒºå¤šçš„

```java
/**
 * ä½¿ç”¨Intern() æµ‹è¯•æ‰§è¡Œæ•ˆç‡
 */
public class StringIntern2 {
    static final int MAX_COUNT = 1000 * 10000;
    static final String[] arr = new String[MAX_COUNT];

    public static void main(String[] args) {
        Integer [] data = new Integer[]{1,2,3,4,5,6,7,8,9,10};
        long start = System.currentTimeMillis();
        for (int i = 0; i < MAX_COUNT; i++) {
          // arr[i] = new String(String.valueOf(data[i%data.length]));  
          arr[i] = new String(String.valueOf(data[i%data.length])).intern();
        }
        long end = System.currentTimeMillis();
        System.out.println("èŠ±è´¹çš„æ—¶é—´ä¸ºï¼š" + (end - start));

        try {
            Thread.sleep(1000000);
        } catch (Exception e) {
            e.getStackTrace();
        }
    }
}
```

**ç»“è®º**ï¼š***å¯¹äºç¨‹åºä¸­å¤§é‡ä½¿ç”¨å­˜åœ¨çš„å­—ç¬¦ä¸²æ—¶ï¼Œå°¤å…¶å­˜åœ¨å¾ˆå¤šå·²ç»é‡å¤çš„å­—ç¬¦ä¸²æ—¶ï¼Œä½¿ç”¨intern()æ–¹æ³•èƒ½å¤ŸèŠ‚çœå†…å­˜ç©ºé—´ã€‚***

å¤§çš„ç½‘ç«™å¹³å°ï¼Œéœ€è¦å†…å­˜ä¸­å­˜å‚¨å¤§é‡çš„å­—ç¬¦ä¸²ã€‚æ¯”å¦‚ç¤¾äº¤ç½‘ç«™ï¼Œå¾ˆå¤šäººéƒ½å­˜å‚¨ï¼šåŒ—äº¬å¸‚ã€æµ·æ·€åŒºç­‰ä¿¡æ¯ã€‚è¿™æ—¶å€™å¦‚æœå­—ç¬¦ä¸²éƒ½è°ƒç”¨intern() æ–¹æ³•ï¼Œå°±ä¼šå¾ˆæ˜æ˜¾é™ä½å†…å­˜çš„å¤§å°ã€‚

## é¢è¯•é¢˜

### new String("ab")ä¼šåˆ›å»ºå‡ ä¸ªå¯¹è±¡

```java
/**
 * new String("ab") ä¼šåˆ›å»ºå‡ ä¸ªå¯¹è±¡ï¼Ÿ çœ‹å­—èŠ‚ç å°±çŸ¥é“æ˜¯2ä¸ªå¯¹è±¡
 */
public class StringNewTest {
    public static void main(String[] args) {
        String str = new String("ab"); //è¿”å›çš„å †ç©ºé—´ä¸­çš„å¯¹è±¡
    }
}
```

æˆ‘ä»¬è½¬æ¢æˆå­—èŠ‚ç æ¥æŸ¥çœ‹

```
 0 new #2 <java/lang/String>
 3 dup
 4 ldc #3 <ab>
 6 invokespecial #4 <java/lang/String.<init>>
 9 astore_1
10 return
```

***è¿™é‡Œé¢å°±æ˜¯ä¸¤ä¸ªå¯¹è±¡***

- ***ä¸€ä¸ªå¯¹è±¡æ˜¯ï¼šnewå…³é”®å­—åœ¨å †ç©ºé—´ä¸­åˆ›å»º***
- ***å¦ä¸€ä¸ªå¯¹è±¡ï¼šå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„å¯¹è±¡***

### new String("a") + new String("b") ä¼šåˆ›å»ºå‡ ä¸ªå¯¹è±¡

```java
/**
 * new String("ab") ä¼šåˆ›å»ºå‡ ä¸ªå¯¹è±¡ï¼Ÿ çœ‹å­—èŠ‚ç å°±çŸ¥é“æ˜¯2ä¸ªå¯¹è±¡
 */
public class StringNewTest {
    public static void main(String[] args) {
        String str = new String("a") + new String("b");
    }
}
```

å­—èŠ‚ç æ–‡ä»¶ä¸º

```
 0 new #2 <java/lang/StringBuilder>
 3 dup
 4 invokespecial #3 <java/lang/StringBuilder.<init>>
 7 new #4 <java/lang/String>
10 dup
11 ldc #5 <a>
13 invokespecial #6 <java/lang/String.<init>>
16 invokevirtual #7 <java/lang/StringBuilder.append>
19 new #4 <java/lang/String>
22 dup
23 ldc #8 <b>
25 invokespecial #6 <java/lang/String.<init>>
28 invokevirtual #7 <java/lang/StringBuilder.append>
31 invokevirtual #9 <java/lang/StringBuilder.toString>
34 astore_1
35 return
```

***æˆ‘ä»¬åˆ›å»ºäº†6ä¸ªå¯¹è±¡***

- ***å¯¹è±¡1ï¼šnew StringBuilder()***
- ***å¯¹è±¡2ï¼šnew String("a")***
- ***å¯¹è±¡3ï¼šå¸¸é‡æ± çš„ a***
- ***å¯¹è±¡4ï¼šnew String("b")***
- ***å¯¹è±¡5ï¼šå¸¸é‡æ± çš„ b***
- ***å¯¹è±¡6ï¼štoStringä¸­ä¼šåˆ›å»ºä¸€ä¸ª new String("ab")***
  - ***â—ï¸è°ƒç”¨toStringæ–¹æ³•ï¼Œä¸ä¼šåœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ç”Ÿæˆab***

### internçš„ä½¿ç”¨ï¼šJDK6å’ŒJDK7

> JDK7 å¼€å§‹ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± æ”¾åˆ°äº†å †ç©ºé—´ä¸­

#### JDK6ä¸­

```java
String s = new String("1");  // åœ¨å¸¸é‡æ± ä¸­å·²ç»æœ‰äº†
s.intern(); // å°†è¯¥å¯¹è±¡æ”¾å…¥åˆ°å¸¸é‡æ± ã€‚ä½†æ˜¯è°ƒç”¨æ­¤æ–¹æ³•æ²¡æœ‰å¤ªå¤šçš„åŒºåˆ«ï¼Œå› ä¸ºå·²ç»å­˜åœ¨äº†1
String s2 = "1";
System.out.println(s == s2); // false

String s3 = new String("1") + new String("1"); // s3å˜é‡è®°å½•çš„åœ°å€ä¸ºnew String("11"),ä¸”æœªåœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­åˆ›å»ºâ€œ11â€
s3.intern();// åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ç”Ÿæˆâ€œ11â€  jdk6:åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å¯¹è±¡â€œ11â€ï¼Œæ‰€ä»¥æœ‰æ–°çš„åœ°å€
String s4 = "11";// s4çš„åœ°å€ä½¿ç”¨çš„æ˜¯ä¸Šä¸€è¡Œä»£ç æ‰§è¡Œæ—¶å¸¸é‡æ± ç”Ÿæˆçš„â€œ11â€
System.out.println(s3 == s4); // false
```

ä¸ºä»€ä¹ˆå¯¹è±¡ä¼šä¸ä¸€æ ·å‘¢ï¼Ÿ

- ä¸€ä¸ªæ˜¯newåˆ›å»ºçš„å¯¹è±¡ï¼Œä¸€ä¸ªæ˜¯å¸¸é‡æ± ä¸­çš„å¯¹è±¡ï¼Œæ˜¾ç„¶ä¸æ˜¯åŒä¸€ä¸ª

å¦‚æœæ˜¯ä¸‹é¢è¿™æ ·çš„ï¼Œé‚£ä¹ˆå°±æ˜¯true

```java
String s = new String("1");
s = s.intern();
String s2 = "1";
System.out.println(s == s2); // true
```

#### JDK7ä¸­

```java
String s = new String("1");
s.intern();
String s2 = "1";
System.out.println(s == s2); // false

String s3 = new String("1") + new String("1");
s3.intern(); // åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ç”Ÿæˆâ€œ11â€
String s4 = "11";// jdk7:å­—ç¬¦ä¸²å¸¸é‡æ± å˜æ›´åˆ°å †ç©ºé—´ä¸­;ä¸ºäº†èŠ‚çœç©ºé—´ï¼Œå¸¸é‡æ± ä¸­ç”Ÿæˆçš„â€œ11â€çš„åœ°å€æŒ‡å‘å †ä¸­å·²åˆ›å»ºçš„â€œ11â€ï¼ˆs3ï¼‰ 
System.out.println(s3 == s4); // true
```

![image-20200711145925091](/assets/imgs/image-20200711145925091.png)

### æ‰©å±•

```java
String s3 = new String("1") + new String("1");
String s4 = "11";  // åœ¨å¸¸é‡æ± ä¸­ç”Ÿæˆçš„å­—ç¬¦ä¸²
s3.intern();  // ç„¶ås3å°±ä¼šä»å¸¸é‡æ± ä¸­æ‰¾ï¼Œå‘ç°æœ‰äº†ï¼Œå°±ä»€ä¹ˆäº‹æƒ…éƒ½ä¸åš
System.out.println(s3 == s4);//false
```

æˆ‘ä»¬å°† s4çš„ä½ç½®å‘ä¸Šç§»åŠ¨ä¸€è¡Œï¼Œå‘ç°å˜åŒ–å°±ä¼šå¾ˆå¤§ï¼Œæœ€åå¾—åˆ°çš„æ˜¯ false

### æ€»ç»“

æ€»ç»“Stringçš„internï¼ˆï¼‰çš„ä½¿ç”¨ï¼š

JDK1.6ä¸­ï¼Œå°†è¿™ä¸ªå­—ç¬¦ä¸²å¯¹è±¡å°è¯•æ”¾å…¥ä¸²æ± ã€‚

- å¦‚æœä¸²æ± ä¸­æœ‰ï¼Œåˆ™å¹¶ä¸ä¼šæ”¾å…¥ã€‚è¿”å›å·²æœ‰çš„ä¸²æ± ä¸­çš„å¯¹è±¡çš„åœ°å€
- ***å¦‚æœæ²¡æœ‰ï¼Œä¼šæŠŠæ­¤å¯¹è±¡å¤åˆ¶ä¸€ä»½ï¼Œæ”¾å…¥ä¸²æ± ï¼Œå¹¶è¿”å›ä¸²æ± ä¸­çš„å¯¹è±¡åœ°å€***

JDK1.7èµ·ï¼Œå°†è¿™ä¸ªå­—ç¬¦ä¸²å¯¹è±¡å°è¯•æ”¾å…¥ä¸²æ± ã€‚

- å¦‚æœä¸²æ± ä¸­æœ‰ï¼Œåˆ™å¹¶ä¸ä¼šæ”¾å…¥ã€‚è¿”å›å·²æœ‰çš„ä¸²æ± ä¸­çš„å¯¹è±¡çš„åœ°å€
- ***å¦‚æœæ²¡æœ‰ï¼Œåˆ™ä¼šæŠŠå¯¹è±¡çš„å¼•ç”¨åœ°å€å¤åˆ¶ä¸€ä»½ï¼Œæ”¾å…¥ä¸²æ± ï¼Œå¹¶è¿”å›ä¸²æ± ä¸­çš„å¼•ç”¨åœ°å€***

ç»ƒä¹ ï¼š

![image-20200711150859709](/assets/imgs/image-20200711150859709.png)

- åœ¨JDK6ä¸­ï¼Œåœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸² â€œabâ€
- åœ¨JDK8ä¸­ï¼Œåœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æ²¡æœ‰åˆ›å»º â€œabâ€ï¼Œè€Œæ˜¯å°†å †ä¸­çš„åœ°å€å¤åˆ¶åˆ° ä¸²æ± ä¸­ã€‚

æ‰€ä»¥ä¸Šè¿°ç»“æœï¼Œåœ¨JDK6ä¸­æ˜¯ï¼š

```
true
false
```

åœ¨JDK8ä¸­æ˜¯

```
true
true
```

![image-20200711151326909](/assets/imgs/image-20200711151326909.png)

é’ˆå¯¹ä¸‹é¢è¿™é¢˜ï¼Œåœ¨JDK6å’Œ8ä¸­è¡¨ç°çš„æ˜¯ä¸€æ ·çš„

![image-20200711151433277](/assets/imgs/image-20200711151433277.png)

## StringTableçš„åƒåœ¾å›æ”¶

```java
/**
 * Stringçš„åƒåœ¾å›æ”¶
 * -Xms15m -Xmx15m -XX:+PrintStringTableStatistics -XX:+PrintGCDetails
 */
public class StringGCTest {
    public static void main(String[] args) {
        for (int i = 0; i < 100000; i++) {
            String.valueOf(i).intern();
        }
    }
}
```

## G1ä¸­çš„Stringå»é‡æ“ä½œ

***æ³¨æ„è¿™é‡Œè¯´çš„é‡å¤ï¼ŒæŒ‡çš„æ˜¯åœ¨å †ä¸­çš„æ•°æ®ï¼Œè€Œä¸æ˜¯å¸¸é‡æ± ä¸­çš„ï¼Œå› ä¸ºå¸¸é‡æ± ä¸­çš„æœ¬èº«å°±ä¸ä¼šé‡å¤***

### æè¿°

èƒŒæ™¯ï¼šå¯¹è®¸å¤šJavaåº”ç”¨ï¼ˆæœ‰å¤§çš„ä¹Ÿæœ‰å°çš„ï¼‰åšçš„æµ‹è¯•å¾—å‡ºä»¥ä¸‹ç»“æœï¼š
- å †å­˜æ´»æ•°æ®é›†åˆé‡Œé¢Stringå¯¹è±¡å äº†25%
- å †å­˜æ´»æ•°æ®é›†åˆé‡Œé¢é‡å¤çš„Stringå¯¹è±¡æœ‰13.5%

- stringå¯¹è±¡çš„å¹³å‡é•¿åº¦æ˜¯45

è®¸å¤šå¤§è§„æ¨¡çš„Javaåº”ç”¨çš„ç“¶é¢ˆåœ¨äºå†…å­˜ï¼Œæµ‹è¯•è¡¨æ˜ï¼Œåœ¨è¿™äº›ç±»å‹çš„åº”ç”¨é‡Œé¢ï¼ŒJavaå †ä¸­å­˜æ´»çš„æ•°æ®é›†åˆå·®ä¸å¤š25%æ˜¯Stringå¯¹è±¡ã€‚æ›´è¿›ä¸€æ­¥ï¼Œè¿™é‡Œé¢å·®ä¸å¤šä¸€åŠstringå¯¹è±¡æ˜¯é‡å¤çš„ï¼Œé‡å¤çš„æ„æ€æ˜¯è¯´ï¼š
Stringl.equalsï¼ˆstring2ï¼‰= trueã€‚***å †ä¸Šå­˜åœ¨é‡å¤çš„Stringå¯¹è±¡å¿…ç„¶æ˜¯ä¸€ç§å†…å­˜çš„æµªè´¹ã€‚******è¿™ä¸ªé¡¹ç›®å°†åœ¨G1åƒåœ¾æ”¶é›†å™¨ä¸­å®ç°è‡ªåŠ¨æŒç»­å¯¹é‡å¤çš„Stringå¯¹è±¡è¿›è¡Œå»é‡ï¼Œè¿™æ ·å°±èƒ½é¿å…æµªè´¹å†…å­˜ã€‚***

### å®ç°

- å½“åƒåœ¾æ”¶é›†å™¨å·¥ä½œçš„æ—¶å€™ï¼Œä¼šè®¿é—®å †ä¸Šå­˜æ´»çš„å¯¹è±¡ã€‚å¯¹æ¯ä¸€ä¸ªè®¿é—®çš„å¯¹è±¡éƒ½ä¼šæ£€æŸ¥æ˜¯å¦æ˜¯å€™é€‰çš„è¦å»é‡çš„Stringå¯¹è±¡ã€‚
- å¦‚æœæ˜¯ï¼ŒæŠŠè¿™ä¸ªå¯¹è±¡çš„ä¸€ä¸ªå¼•ç”¨æ’å…¥åˆ°é˜Ÿåˆ—ä¸­ç­‰å¾…åç»­çš„å¤„ç†ã€‚ä¸€ä¸ªå»é‡çš„çº¿ç¨‹åœ¨åå°è¿è¡Œï¼Œå¤„ç†è¿™ä¸ªé˜Ÿåˆ—ã€‚å¤„ç†é˜Ÿåˆ—çš„ä¸€ä¸ªå…ƒç´ æ„å‘³ç€ä»é˜Ÿåˆ—åˆ é™¤è¿™ä¸ªå…ƒç´ ï¼Œç„¶åå°è¯•å»é‡å®ƒå¼•ç”¨çš„Stringå¯¹è±¡ã€‚
- ä½¿ç”¨ä¸€ä¸ªhashtableæ¥è®°å½•æ‰€æœ‰çš„è¢«Stringå¯¹è±¡ä½¿ç”¨çš„ä¸é‡å¤çš„charæ•°ç»„ã€‚å½“å»é‡çš„æ—¶å€™ï¼Œä¼šæŸ¥è¿™ä¸ªhashtableï¼Œæ¥çœ‹å †ä¸Šæ˜¯å¦å·²ç»å­˜åœ¨ä¸€ä¸ªä¸€æ¨¡ä¸€æ ·çš„charæ•°ç»„ã€‚
- å¦‚æœå­˜åœ¨ï¼ŒStringå¯¹è±¡ä¼šè¢«è°ƒæ•´å¼•ç”¨é‚£ä¸ªæ•°ç»„ï¼Œé‡Šæ”¾å¯¹åŸæ¥çš„æ•°ç»„çš„å¼•ç”¨ï¼Œæœ€ç»ˆä¼šè¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶æ‰ã€‚
- å¦‚æœæŸ¥æ‰¾å¤±è´¥ï¼Œcharæ•°ç»„ä¼šè¢«æ’å…¥åˆ°hashtableï¼Œè¿™æ ·ä»¥åçš„æ—¶å€™å°±å¯ä»¥å…±äº«è¿™ä¸ªæ•°ç»„äº†ã€‚

### å¼€å¯

å‘½ä»¤è¡Œé€‰é¡¹
>UsestringDeduplicationï¼ˆboolï¼‰ï¼šå¼€å¯stringå»é‡ï¼Œé»˜è®¤æ˜¯ä¸å¼€å¯çš„ï¼Œéœ€è¦æ‰‹åŠ¨å¼€å¯ã€‚
>Printstringbeduplicationstatisticsï¼ˆboolï¼‰ï¼šæ‰“å°è¯¦ç»†çš„å»é‡ç»Ÿè®¡ä¿¡æ¯
>stringpeduplicationAgeThresholdï¼ˆuintxï¼‰ï¼šè¾¾åˆ°è¿™ä¸ªå¹´é¾„çš„stringå¯¹è±¡è¢«è®¤ä¸ºæ˜¯å»é‡çš„å€™é€‰å¯¹è±¡