---
layout: post
title:  "类的加载过程详解"
date:   2020-11-13 21:31:16 +0800--
categories: [JVM,]
tags: [Java, JVM]  

---

# 概述

在Java中数据类型分为基本数据类型和引用数据类型。***基本数据类型由虚拟机预先定义，引用数据类型则需要进行类的加载。***

按照Java虚拟机规范，从class 文件到加载到内存中的类，到类卸载出内存为止，它的整个生命周期包括如下7个阶段:

***其中，验证、准备、解析3个部分统称为链接（Linking）***

![image-20201114155903223](/Users/silince/Develop/博客/blog_to_git/assets/imgs/image-20201114155903223.png)



***从程序中类的使用过程看:***

![image-20201114160929591](/Users/silince/Develop/博客/blog_to_git/assets/imgs/image-20201114160929591.png)



# 大厂面试题

蚂蚁金服:

- 描述一下M加载 Class文件的原理机制?
- 一面:类加载过程

百度:

- 类加载的时机java类加载过程?简述java类加载机制?

腾讯:

- JVM中类加载机制,类加载过程?

滴滴:

- JVM类加载机制

美团:

- Java类加载过程
- 描述一下jvm加 class载文件的原理机制



# 过程一：Loading 加载阶段

## 加载完成的操作

### 加载的理解

***所谓加载，简而言之就是将Java类的字节码文件加载到机器内存中，并在内存中构建出Java类的原型----类模板对象。*** 所谓类模板对象，其实就是Java类在JVM内存中的一个快照，JVM将 从字节码文件中解析出的常量池、类字段、类方法等信息存储到类模板中，这样JVM在运行期便能通过类模板而获取Java类中的任意信息，能够对Java类的成员变量进行遍历，也能进行Java方法的调用。

反射的机制即基于这一基础。 如果JVM没有将Java类的声明信息存储起来，则JVM在 运行期也无法反射。

### 加载完成的操作

***加载阶段，简言之，查找并加载类的二进制数据，生成Class的实例。***
在加载类时，Java虚拟机必须完成以下3件事情:

1. 通过类的全名，获取类的二进制数据流。
2. 解析类的二进制数据流为方法区内的数据结构（Java类模型）
3. 创建java.lang. Class类的实例， 表示该类型。作为方法区这个类的各种数据的访问入口



## 二进制流的获取方式

## 类模型与Class实例的位置

## 数组类的加载



# 过程二：Linking 链接阶段

## Verification 验证

## Preparation 准备

## Resolution 解析



# 过程三：Initalization 初始化阶段

## static与final的搭配问题

## `<clinit>()`的线程安全性

## 类的初始化情况：主动使用vs被动使用





# 过程四：类的 Using 使用



# 过程五：类的 Unloading 卸载

## 回顾：方法区的垃圾回收



