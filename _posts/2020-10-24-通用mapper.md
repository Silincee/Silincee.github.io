---
layout: post
title:  "通用mapper"
date:   2020-10-24 17:04:06 +0800--
categories: [Java,]
tags: [Java, Mybatis]  


---

# 概述

通用mapper可以替我们生成常用增删改查操作的 SQL 语句。

代码官方发布地址：

- https://gitee.com/free 
- https://gitee.com/free/Mapper/wikis/1.1-java?parent=1.integration



# 快速入门

## 创建测试数据

1) SQL

```sql
CREATE TABLE `tabple_emp` (
	`emp_id` int NOT NULL AUTO_INCREMENT,
	`emp_name` varchar(500) NULL,
	`emp_salary` DOUBLE(15,5) NULL,
	`emp_age` INT NULL,
	PRIMARY KEY (`emp_id`)
);

INSERT INTO `tabple_emp` (`emp_name`, `emp_salary`, `emp_age`) VALUES ('tom', '1254.37', '27'); 
INSERT INTO `tabple_emp` (`emp_name`, `emp_salary`, `emp_age`) VALUES ('jerry', '6635.42', '38'); 
INSERT INTO `tabple_emp` (`emp_name`, `emp_salary`, `emp_age`) VALUES ('bob', '5560.11', '40'); 
INSERT INTO `tabple_emp` (`emp_name`, `emp_salary`, `emp_age`) VALUES ('kate', '2209.11', '22'); 
INSERT INTO `tabple_emp` (`emp_name`, `emp_salary`, `emp_age`) VALUES ('justin', '4203.15', '30');
```

2) Java实体类

```java
@Data
@NoArgsConstructor
@AllArgsConstructor
@Table(name="tabple_emp")
public class Employee {
    private Integer empId;
    private String empName;
    private Double empSalary;
    private Integer empAge;
}
```

## 搭建 **MyBatis+Spring** 开发环境

mybatis-config.xml
spring-context.xml
jdbc.properties

## 集成  Mapper

1)加入Maven依赖信息

```xml
<dependency>
		<groupId>tk.mybatis</groupId>
		<artifactId>mapper</artifactId>
		<version>4.0.0-beta3</version>
</dependency>
```

2）修改Spring配置文件

```xml
<!-- 整合通用 Mapper 所需要做的配置修改: -->
<!-- 原始全类名:org.mybatis.spring.mapper.MapperScannerConfigurer -->
<!-- 通用 Mapper 使用:tk.mybatis.spring.mapper.MapperScannerConfigurer --> 
<bean class="tk.mybatis.spring.mapper.MapperScannerConfigurer">
		<property name="basePackage" value="com.atguigu.mapper.mappers"/> 
</bean>
```

3）创建mapper 和 services

cn.silince.mapper.services;

```java
/**
* 具体操作数据库的 Mapper 接口，需要继承通用 Mapper 提供的核心接口:Mapper<Employee>
* 泛型类型就是实体类的类型 
*/
public interface EmployeeMapper extends Mapper<Employee> {
}
```

package cn.silince.mapper.services;

```java
@Service
public class EmployeeService {

    @Autowired
    private EmployeeMapper employeeMapper;

    public Employee getOne(Employee employeeQueryCondition) {
        return employeeMapper.selectOne(employeeQueryCondition);
    }
}
```

## 测试

```java
public class EmployeeMapperTest extends Object {
    private ApplicationContext iocContainer = new ClassPathXmlApplicationContext("spring-context.xml");
    private EmployeeService employeeService = iocContainer.getBean(EmployeeService.class);

    @Test
    public void selectOne() {
        // 1. 创建封装查询条件的实体类对象
        Employee employeeQueryCondition = new Employee(null, "bob", 5560.11, null);
        // 2. 执行可查询条件
        Employee employeeQueryResult =employeeService.getOne(employeeQueryCondition);
        System.out.println(employeeQueryResult);
    }
}
```

# 常用注解

## **@Table** 注解

作用:建立实体类和数据库表之间的对应关系。 

默认规则:实体类类名首字母小写作为表名。Employee 类→employee 表。 

用法:在@Table 注解的 name 属性中指定目标数据库表的表名

```java
@Data
@Table(name="tabple_emp")
public class Employee {
    private Integer empId;
    private String empName;
    private Double empSalary;
    private Integer empAge;
}
```



## **@Column** 注解

作用:建立实体类字段和数据库表字段之间的对应关系。 

默认规则:

- 实体类字段:驼峰式命名
- 数据库表字段:使用“_”区分各个单词 

用法:在@Column 注解的 name 属性中指定目标字段的字段名

```java
@Column(name="emp_salary_apple")
private Double empSalary;
```



## **@Id** 注解

通用 Mapper 在执行 xxxByPrimaryKey(key)方法时，有两种情况。

-  情况 1:没有使用@Id 注解明确指定主键字段

  ```sql
   -- 之所以会生成上面这样的 WHERE 子句是因为通用 Mapper 将实体类中的所有字段都拿来放在一起作为联合主键
  SELECT emp_id,emp_name,emp_salary_apple,emp_age FROM tabple_emp WHERE emp_id = ? AND emp_name = ? AND emp_salary_apple = ? AND emp_age = ?
  ```

- 情况 2:使用@Id 主键明确标记和数据库表中主键字段对应的实体类字段。

  ```java
  @Id
  private Integer empId;
  ```

  

## **@GeneratedValue** 注解

作用:让通用 Mapper 在执行 insert 操作之后将数据库自动生成的主键值回写到实体类对象中。 

自增主键用法:

```java
@Id
@GeneratedValue(strategy = GenerationType.IDENTITY)
private Integer empId;
```

序列主键用法:

```java
@Id
@GeneratedValue(strategy = GenerationType.IDENTITY,
                generator = "select SEQ_ID.nextval from dual")
private Integer empId;
```



## @Transient 主键

用于标记不与数据库表字段对应的实体类字段。

```java
@Transient
private String otherThings; //非数据库表中字段
```



# 常用方法

