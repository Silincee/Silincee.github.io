---
layout: post
title: "å¦‚ä½•ç”¨ç­–ç•¥æ¨¡å¼æ¶ˆé™¤æ»¡å±çš„if-else"
date: 2021-08-07 11:23:16 +0800--
categories: [è®¾è®¡æ¨¡å¼, ]
tags: [è®¾è®¡æ¨¡å¼, ç­–ç•¥æ¨¡å¼,]  
---

# å‰è¨€

æœ€è¿‘åœ¨è¿æ¥å£çš„è¿‡ç¨‹ä¸­é‡åˆ°ä¸€ä¸ªç›´æ’­åˆ—è¡¨é¡µå…³æ³¨Tabçš„æ¥å£ï¼Œéœ€è¦æ ¹æ®ä¸åŒçš„ç›´æ’­çŠ¶æ€å¯¹å…³æ³¨çš„ä¸»æ’­è¿›è¡Œå±•ç¤ºï¼Œè€æ¥å£æŠŠæ‰€æœ‰çš„ç›´æ’­çŠ¶æ€éƒ½å†™åˆ°ä¸€èµ·äº†ï¼Œé¦–å…ˆåˆ¤æ–­è¯¥ä¸»æ’­çš„ç›´æ’­çŠ¶æ€(ç›´æ’­ä¸­/é¢„å‘Šä¸­/æœªå¼€æ’­ç­‰)ï¼Œç„¶åæ‰§è¡Œä¸åŒçš„å¤„ç†é€»è¾‘ã€‚

```java
if (input.getType() == 0) {
  // ç›´æ’­ä¸­ä¸»æ’­çš„å¤„ç†é€»è¾‘
}else if (input.getType() == 1) {
  // é¢„å‘Šä¸­ä¸»æ’­çš„å¤„ç†é€»è¾‘
}else if (input.getType() == 2) {
  // æœªå¼€æ’­ä¸»æ’­çš„å¤„ç†é€»è¾‘
}
```

æ¯ç§é€»è¾‘è¿”å›çš„å­—æ®µå¾ˆå¤šå¯¼è‡´æ–¹æ³•å¾ˆå¤§ï¼Œé˜…è¯»èµ·æ¥ä½“éªŒæå·®ï¼Œè€Œä¸”ä»¥åæœ‰ä»€ä¹ˆæ´»åŠ¨åœ¨ç›´æ’­åˆ—è¡¨é¡µå±•ç¤ºä¹Ÿä¸æ–¹é¢ä¿®æ”¹ã€‚ç°åœ¨è€ƒè™‘ä½¿ç”¨ç­–ç•¥æ¨¡å¼æ¥æ¶ˆé™¤è¿™äº›`if-else`ã€‚



# å®ç°

å¯¹äº`client`ï¼Œæˆ‘ä»¬è¦åœ¨å…¶ä¸­å¢åŠ ä¸€ä¸ªç­–ç•¥å¤„ç†å™¨`Map<Integer, Processor>`,ç„¶ååœ¨`client`è¿›è¡Œ**beanåˆå§‹åŒ–**çš„æ—¶å€™å°†æ‰€æœ‰ç­–ç•¥éƒ½åŠ è½½åˆ°è¿™ä¸ª`ConcurrentHashMap`ä¸­ï¼Œè¿™æ ·åªéœ€å‘`client`ä¼ é€’ä¸€ä¸ª`type`å‚æ•°å°±å¯ä»¥ä»è¯¥`map`ä¸­æ‰¾åˆ°å¯¹åº”çš„å¤„ç†ç­–ç•¥çš„å®ç°ç±»ã€‚

1.å®¢æˆ·ç«¯client

å®ç°`InitializingBean`æ¥å£ä¼šåœ¨è¿™ä¸ªbeanåˆå§‹åŒ–åæ‰§è¡Œ`afterPropertiesSet`æ–¹æ³•åœ¨é‡Œé¢å°†ä»`ApplicationContextHelper`é‡Œé¢è·å–åˆ°çš„beanéƒ½æ”¾åˆ°mapé‡Œé¢å»ï¼Œmapçš„keyä¸ºç­–ç•¥å®ç°ç±»çš„ä¸šåŠ¡taypeï¼Œå€¼ä¸ºè¯¥å¯¹è±¡ã€‚

```java
/**
 * @author zhongye
 * @since 2021.08.06
 */
@Component
@Slf4j
public class MyFollowActorsActionletLogic implements InitializingBean {

  private final Map<Integer, MyFollowActorsActionletProcessor> typeAndStatementHandle = new ConcurrentHashMap<>();

  @Resource
  private ApplicationContextHelper applicationContextHelper;

  @Override
  public void afterPropertiesSet() {
    Map<String, MyFollowActorsActionletProcessor> statementHandles = 
      applicationContextHelper.getBeansOfType(MyFollowActorsActionletProcessor.class);
    for (Map.Entry<String, MyFollowActorsActionletProcessor> statementHandle : statementHandles.entrySet()) {
      typeAndStatementHandle.put(statementHandle.getValue().getType(), statementHandle.getValue());
    }
  }

  public MyFollowActorsActionletOutput assembleOutput(MyFollowActorsActionletInput input) {
    MyFollowActorsActionletOutput output = typeAndStatementHandle.get(input.getType()).process(input);

    // å¤„ç†acmï¼ŒåŠ ä¸ŠtId
    dealFollowListAcm(output.getData());
    // æ„é€ ç»“æœ
    output.setEnd(input.getTotal() < input.getPageSize());
    output.setPageIndex(output.isEnd() ? input.getPageIndex() : input.getPageIndex() + 1);

    return output;
  }
}
```

2.`ApplicationContextHelper`æ˜¯ä¸€ä¸ªå®ç°`äº†ApplicationContextAware`æ¥å£çš„å·¥å…·ç±»

å®ç°è¿™ä¸ªæ¥å£ä¼šåœ¨springå®¹å™¨åˆå§‹åŒ–å®Œæˆä¹‹åè°ƒç”¨`setApplicationContext`æ–¹æ³•ï¼Œå°†`ApplicationContext`æ”¾è¿›å»ï¼Œä»è€Œå¯ä»¥æ‹¿åˆ°springçš„å®¹å™¨`ApplicationContext`ï¼Œè¿›è€Œä½¿ç”¨è¿™ä¸ªå®¹å™¨è·å–æˆ‘ä»¬æƒ³è¦çš„bean ã€‚

```java
/**
 * @author zhongye
 * @since 2021.08.06
 */
@Component
public class ApplicationContextHelper implements ApplicationContextAware {

  ApplicationContext applicationContext;

  @Override
  public void setApplicationContext(ApplicationContext applicationContext) throws BeansException {
    this.applicationContext = applicationContext;
  }

  public <T> T getBean(Class<T> clazz) {
    return applicationContext.getBean(clazz);
  }

  public <T> Map<String, T> getBeansOfType(Class<T> clazz) {
    return applicationContext.getBeansOfType(clazz);
  }
}
```

3.ç­–ç•¥çš„æŠ½è±¡ç±»

```java
/**
 * MyFollowActorsActionlet çš„å¤„ç†ç­–ç•¥æ¥å£
 * 0ï¼šç›´æ’­ä¸­  1ï¼šé¢„å‘Šä¸­ 2ï¼š æœªå¼€æ’­
 *
 * @author zhongye
 * @since 2021.08.06
 */
public interface MyFollowActorsActionletProcessor {
  /**
     * è¿™ä¸ªç±»å‹ï¼Œå†³å®šäº†ä½¿ç”¨å“ªä¸ªå…·ä½“çš„å®ç°ç±»
     *
     * @return æ¶ˆæ¯ç±»å‹
     */
  int getType();

  /**
     * å¤„ç†é€»è¾‘
     *
     * @param input å…¥å‚
     * @return MyFollowActorsActionletOutput
     */
  MyFollowActorsActionletOutput process(MyFollowActorsActionletInput input);
}
```

4.ç­–ç•¥çš„å®ç°ç±»

```java
/**
 * ç›´æ’­åˆ—è¡¨é¡µå…³æ³¨TAB-æ­£åœ¨ç›´æ’­ä¸­ä¸»æ’­å¤„ç†é€»è¾‘å¤„
 *
 * @author zhongye
 * @since 2021.08.06
 */
@Component
@Slf4j
public class MyFollowLivingActorProcessor implements MyFollowActorsActionletProcessor {
  
  @Override
  public int getType() {
    //ğŸ¤” typeå¤šçš„æ—¶å€™å¯ä»¥å†™æˆæšä¸¾ç±»
    return 0;
  }

  @Override
  public MyFollowActorsActionletOutput process(MyFollowActorsActionletInput input) {

    MyFollowActorsActionletOutput output = new MyFollowActorsActionletOutput();
    output.setData(Lists.newArrayList());
    long userId = input.getLoginUserId();

    // æŸ¥è¯¢ç›´æ’­é—´ä¿¡æ¯
    List<FollowActorsRoomDTO> roomInfos = actorFollowComponent.buildRoomList(userId, input.getPageIndex(), input.getPageSize());
    List<Long> actorIds = roomInfos.stream().map(FollowActorsRoomDTO::getActorId).collect(Collectors.toList());
    // æŸ¥è¯¢ä¸»æ’­åˆ—è¡¨
    Map<Long, UsersInfo> usersInfoMap = userInfoRemoteService.mapByUserIds(actorIds);
    // æŸ¥è¯¢é™ªä¼´å¤©æ•°
    Map<Long, Integer> daysMap = myFollowActorsActionletLogic.getAccompanyDaysByUser(userId, actorIds);

    // æ„é€ æ•°æ®
    for (FollowActorsRoomDTO roomInfo : roomInfos) {
      UsersInfo usersInfo = usersInfoMap.get(roomInfo.getActorId());
      if (usersInfo == null) {
        continue;
      }
      FollowActorsDataItemDTO dataItem = myFollowActorsActionletLogic.buildDataItem(
        daysMap.getOrDefault(usersInfo.getUserId(), 0), input.getType(), usersInfo);
      dataItem.setRoomInfo(roomInfo);
      output.getData().add(dataItem);
    }
    input.setTotal(roomInfos.size());

    return output;
  }
}
```

