---
layout: post
title:  "volatileçš„ç”¨é€”"
date:   2020-09-02 18:58:06 +0800--
categories: [Java]
tags: [é«˜å¹¶å‘, ]  


---

# volatileçš„ä½œç”¨

## 1.çº¿ç¨‹å¯è§æ€§

volatile åº•å±‚æ˜¯   `lock add`æŒ‡ä»¤

**LOCK ç”¨äºåœ¨å¤šå¤„ç†å™¨ä¸­æ‰§è¡ŒæŒ‡ä»¤æ—¶å¯¹å…±äº«å†…å­˜çš„ç‹¬å ä½¿ç”¨ã€‚
å®ƒçš„ä½œç”¨æ˜¯èƒ½å¤Ÿå°†å½“å‰å¤„ç†å™¨å¯¹åº”ç¼“å­˜çš„å†…å®¹åˆ·æ–°åˆ°å†…å­˜ï¼Œå¹¶ä½¿å…¶ä»–å¤„ç†å™¨å¯¹åº”çš„ç¼“å­˜å¤±æ•ˆï¼ˆæ‰€ä»¥è¦é‡æ–°å»å†…å­˜è¯»ï¼Œä¾¿å®ç°äº†çº¿ç¨‹å¯è§æ€§ï¼‰ã€‚**

```java
package com.mashibing.testvolatile;

public class T01_ThreadVisibility {
  	// âš ï¸ volatile ä¿®æ”¹äº†è¿™å—å†…å­˜é©¬ä¸Šé€šçŸ¥å…¶å®ƒçº¿ç¨‹é‡æ–°è¯»å–
    private static volatile boolean flag = true;

    public static void main(String[] args) throws InterruptedException {
        new Thread(()-> {
            while (flag) {
                //do sth
            }
            System.out.println("end");
        }, "server").start();


        Thread.sleep(1000);

        flag = false; // âš ï¸ å¦‚æœä¸åŠ volatileï¼Œserverçº¿ç¨‹ä¸ä¼šåœæ­¢
    }
}
```

## 2.é˜²æ­¢æŒ‡ä»¤é‡æ’åº

### ä»€ä¹ˆæ˜¯æŒ‡ä»¤é‡æ’åºï¼Ÿ

æŒ‡ä»¤é‡æ’åºã€‚å¦‚æœå‡ºç°x,yåŒæ—¶ç­‰äº0ï¼Œåˆ™CPUä¸€å®šå‘ç”Ÿäº†æŒ‡ä»¤é‡æ’åºã€‚

```java
package com.mashibing.jvm.c3_jmm;

public class T04_Disorder {
    private static int x = 0, y = 0;
    private static int a = 0, b =0;

    public static void main(String[] args) throws InterruptedException {
        int i = 0;
        for(;;) {
            i++;
            x = 0; y = 0;
            a = 0; b = 0;
            Thread one = new Thread(new Runnable() {
                public void run() {
                    //ç”±äºçº¿ç¨‹oneå…ˆå¯åŠ¨ï¼Œä¸‹é¢è¿™å¥è¯è®©å®ƒç­‰ä¸€ç­‰çº¿ç¨‹two. è¯»ç€å¯æ ¹æ®è‡ªå·±ç”µè„‘çš„å®é™…æ€§èƒ½é€‚å½“è°ƒæ•´ç­‰å¾…æ—¶é—´.
                    //shortWait(100000);
                    a = 1;
                    x = b;
                }
            });

            Thread other = new Thread(new Runnable() {
                public void run() {
                    b = 1;
                    y = a;
                }
            });
            one.start();other.start();
            one.join();other.join();
            String result = "ç¬¬" + i + "æ¬¡ (" + x + "," + y + "ï¼‰";
            if(x == 0 && y == 0) {
                System.err.println(result);
                break;
            } else {
                //System.out.println(result);
            }
        }
    }


    public static void shortWait(long interval){
        long start = System.nanoTime();
        long end;
        do{
            end = System.nanoTime();
        }while(start + interval >= end);
    }
}
```



### ç³»ç»Ÿåº•å±‚å¦‚ä½•å®ç°æ•°æ®ä¸€è‡´æ€§

1. MESIå¦‚æœèƒ½è§£å†³ï¼Œå°±ä½¿ç”¨MESI
2. å¦‚æœä¸èƒ½ï¼Œå°±é”æ€»çº¿

### ç³»ç»Ÿåº•å±‚å¦‚ä½•ä¿è¯æœ‰åºæ€§

1. å†…å­˜å±éšœsfence mfence lfenceç­‰ç³»ç»ŸåŸè¯­
2. é”æ€»çº¿

### volatileå¦‚ä½•è§£å†³æŒ‡ä»¤é‡æ’åº

#### **JVMçš„å†…å­˜å±éšœ ğŸ¤”**

***å±éšœä¸¤è¾¹çš„æŒ‡ä»¤ä¸å¯ä»¥é‡æ’ï¼ä¿éšœæœ‰åºï¼*** âš ï¸è¿™æ˜¯JVMè§„èŒƒå±‚çº§çš„è¦æ±‚ï¼ˆå…·ä½“å®ç°çœ‹hotspotçš„æºç ï¼‰ï¼Œä¸æ˜¯CPUå±‚çº§çš„å®ç°

![image-20200902223616416](/assets/imgs/image-20200902223616416.png)    

è§„èŒƒï¼š***hanppens-before***åŸåˆ™(JVMè§„å®šé‡æ’åºå¿…é¡»éµå®ˆçš„è§„åˆ™)ã€***as if serial***(ä¸ç®¡å¦‚ä½•é‡æ’åºï¼Œå•çº¿ç¨‹æ‰§è¡Œç»“æœä¸ä¼šæ”¹å˜)



#### volatileå®ç°ç»†èŠ‚

![image-20200902224003133](/assets/imgs/image-20200902224003133.png)



#### **hotspotå®ç°ï¼š**

bytecodeinterpreter.cpp

```c++
int field_offset = cache->f2_as_index();
          if (cache->is_volatile()) {
            if (support_IRIW_for_not_multiple_copy_atomic_cpu) {
              OrderAccess::fence();
            }
```

orderaccess_linux_x86.inline.hpp

```c++
inline void OrderAccess::fence() {
  if (os::is_MP()) {
    // âš ï¸ always use locked addl since mfence is sometimes expensive
#ifdef AMD64
    __asm__ volatile ("lock; addl $0,0(%%rsp)" : : : "cc", "memory");
#else
    __asm__ volatile ("lock; addl $0,0(%%esp)" : : : "cc", "memory");
#endif
  }
}
```

> **LOCK ç”¨äºåœ¨å¤šå¤„ç†å™¨ä¸­æ‰§è¡ŒæŒ‡ä»¤æ—¶å¯¹å…±äº«å†…å­˜çš„ç‹¬å ä½¿ç”¨ã€‚
> å®ƒçš„ä½œç”¨æ˜¯èƒ½å¤Ÿå°†å½“å‰å¤„ç†å™¨å¯¹åº”ç¼“å­˜çš„å†…å®¹åˆ·æ–°åˆ°å†…å­˜ï¼Œå¹¶ä½¿å…¶ä»–å¤„ç†å™¨å¯¹åº”çš„ç¼“å­˜å¤±æ•ˆï¼ˆæ‰€ä»¥è¦é‡æ–°å»å†…å­˜è¯»ï¼Œä¾¿å®ç°äº†çº¿ç¨‹å¯è§æ€§ï¼‰ã€‚**
> **å¦å¤–è¿˜æä¾›äº†æœ‰åºçš„æŒ‡ä»¤æ— æ³•è¶Šè¿‡è¿™ä¸ªå†…å­˜å±éšœçš„ä½œç”¨ï¼ˆåˆ«çš„æŒ‡ä»¤æ— æ³•è¶Šè¿‡lockæŒ‡ä»¤ã€‚ï¼‰**



### é¢è¯•é¢˜ï¼šDCLå•ä¾‹éœ€ä¸éœ€è¦åŠ volatileï¼Ÿ ğŸ¤”

å¿…é¡»è¦åŠ ï¼åˆ›å»ºå¯¹è±¡è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸€ä¸ªåŠåˆå§‹åŒ–çŠ¶æ€ï¼Œvolatileå¯ä»¥ç¦æ­¢æŒ‡ä»¤é‡æ’åºã€‚

æ¡ˆä¾‹ï¼š

```
Object t  = new Object();
// DCL åŒé‡æ£€æŸ¥é”
public class Mgr06{
  // âš ï¸é—®é¢˜ï¼šDCLå•ä¾‹éœ€ä¸éœ€è¦åŠ volatileï¼Ÿ
  private static volatile Mgr06 INSTANCE; // JIT
  private Mgr(){}
  
  public static Mgr06 getInstance(){
    // ä¸šåŠ¡é€»è¾‘ä»£ç çœç•¥
    if(INSTANCE == null){
      // Double Check Lock åŒé‡æ£€æŸ¥é”
      synchronized(Mgr06.class){
        if(INSTANCE==null){ // ç¬¬äºŒæ¬¡æ£€æŸ¥ï¼Œé˜²æ­¢åœ¨ä¸Šé”è¿‡ç¨‹ä¸­æœ‰äººnewäº†
          try{
            Thread.sleep(1);
          }catch(InterruptedException e){
            e.printStackTrace();
          }
          INSTANCE = new Mgr06();
        }
      }
    }
    return INSTANCE;
  }
  public void m(){System.out.printlb("m");}
}
```



![image-20200903095628344](/assets/imgs/image-20200903095628344.png)

æ­¤æ—¶å‘ç”Ÿäº†æŒ‡ä»¤é‡æ’åºï¼Œè¿™æ—¶tä¾¿ä¸åŠåˆå§‹åŒ–çš„å¯¹è±¡å»ºç«‹äº†è”ç³»ã€‚***âš ï¸ thread2å°±ä¼šä½¿ç”¨åŠåˆå§‹åŒ–çŠ¶æ€çš„å¯¹è±¡ï¼***

![image-20200902204015409](/assets/imgs/1599051068.png)



# ç”¨hsdisè§‚å¯Ÿsynchronizedå’Œvolatile

1. å®‰è£…hsdis (è‡ªè¡Œç™¾åº¦)

2. ä»£ç 

   ```java
   public class T {
   
     public static volatile int i = 0;
   
     public static void main(String[] args) {
       for(int i=0; i<1000000; i++) {
          m();
          n();
       }
     }
     
     public static synchronized void m() {
       
     }
   
     public static void n() {
       i = 1;
     }
   }
   ```

3. ```css
   java -XX:+UnlockDiagnosticVMOptions -XX:+PrintAssembly T > 1.txt
   ```

4. å‘ç°æœ€ç»ˆ synchronized åº•å±‚æ˜¯   `lock cmpxchg `æŒ‡ä»¤ï¼›volatile åº•å±‚æ˜¯   `lock add`æŒ‡ä»¤



# ä¼ªå…±äº«å’Œç¼“å­˜è¡Œ

> psï¼šä¸volatileå®ç°æ²¡ä»€ä¹ˆå…³ç³»

åœ¨è®¡ç®—æœºç³»ç»Ÿä¸­ï¼Œå†…å­˜æ˜¯ä»¥***ç¼“å­˜è¡Œ***ä¸ºå•ä½å­˜å‚¨çš„ï¼Œä¸€ä¸ªç¼“å­˜è¡Œå­˜å‚¨å­—èŠ‚çš„æ•°é‡ä¸º2çš„å€æ•°ï¼Œ***æŒ‰å—è¯»å–***ã€‚åœ¨ä¸åŒçš„æœºå™¨ä¸Šï¼Œç¼“å­˜è¡Œå¤§å°ä¸º32å­—èŠ‚åˆ°256å­—èŠ‚ä¸ç­‰ï¼Œé€šå¸¸æ¥è¯´ä¸º64å­—èŠ‚ã€‚***ä¼ªå…±äº«æŒ‡çš„æ˜¯åœ¨å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å†™åŒä¸€ä¸ªç¼“å­˜è¡Œçš„ä¸åŒå˜é‡çš„æ—¶å€™ï¼Œå°½ç®¡è¿™äº›å˜é‡ä¹‹é—´æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œä½†æ˜¯åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´ä»ç„¶éœ€è¦åŒæ­¥ï¼Œä»è€Œå¯¼è‡´æ€§èƒ½ä¸‹é™çš„æƒ…å†µã€‚***åœ¨å¯¹ç§°å¤šå¤„ç†å™¨ç»“æ„çš„ç³»ç»Ÿä¸­ï¼Œä¼ªå…±äº«æ˜¯å½±å“æ€§èƒ½çš„ä¸»è¦å› ç´ ä¹‹ä¸€ï¼Œç”±äºå¾ˆéš¾é€šè¿‡èµ°æŸ¥ä»£ç çš„æ–¹å¼å®šä½ä¼ªå…±äº«çš„é—®é¢˜ï¼Œå› æ­¤ï¼Œå¤§å®¶æŠŠä¼ªå…±äº«ç§°ä¸ºâ€œæ€§èƒ½æ€æ‰‹â€ã€‚

ä¸ºäº†é€šè¿‡å¢åŠ çº¿ç¨‹æ•°æ¥è¾¾åˆ°è®¡ç®—èƒ½åŠ›çš„æ°´å¹³æ‰©å±•ï¼Œæˆ‘ä»¬å¿…é¡»ç¡®ä¿å¤šä¸ªçº¿ç¨‹ä¸èƒ½åŒæ—¶å¯¹ä¸€ä¸ªå˜é‡æˆ–è€…ç¼“å­˜è¡Œè¿›è¡Œè¯»å†™ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»£ç èµ°æŸ¥çš„æ–¹å¼ï¼Œå®šä½å¤šä¸ªçº¿ç¨‹è¯»å†™ä¸€ä¸ªå˜é‡çš„æƒ…å†µï¼Œä½†æ˜¯ï¼Œè¦æƒ³çŸ¥é“å¤šä¸ªçº¿ç¨‹è¯»å†™åŒä¸€ä¸ªç¼“å­˜è¡Œçš„æƒ…å†µï¼Œæˆ‘ä»¬å¿…é¡»å…ˆäº†è§£ç³»ç»Ÿå†…å­˜çš„ç»„ç»‡å½¢å¼ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

![image-20200902192144434](/assets/imgs/image-20200902192144434.png)



ä»ä¸Šå›¾çœ‹åˆ°ï¼Œçº¿ç¨‹1åœ¨CPUæ ¸å¿ƒ1ä¸Šè¯»å†™å˜é‡Xï¼ŒåŒæ—¶çº¿ç¨‹2åœ¨CPUæ ¸å¿ƒ2ä¸Šè¯»å†™å˜é‡Yï¼Œä¸å¹¸çš„æ˜¯å˜é‡Xå’Œå˜é‡Yåœ¨åŒä¸€ä¸ªç¼“å­˜è¡Œä¸Šï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹ä¸ºäº†å¯¹ç¼“å­˜è¡Œè¿›è¡Œè¯»å†™ï¼Œéƒ½è¦ç«äº‰å¹¶è·å¾—ç¼“å­˜è¡Œçš„è¯»å†™æƒé™ï¼Œå¦‚æœçº¿ç¨‹2åœ¨CPUæ ¸å¿ƒ2ä¸Šè·å¾—äº†å¯¹ç¼“å­˜è¡Œè¿›è¡Œè¯»å†™çš„æƒé™ï¼Œé‚£ä¹ˆçº¿ç¨‹1å¿…é¡»åˆ·æ–°å®ƒçš„ç¼“å­˜åæ‰èƒ½åœ¨æ ¸å¿ƒ1ä¸Šè·å¾—è¯»å†™æƒé™ï¼Œ***è¿™å¯¼è‡´è¿™ä¸ªç¼“å­˜è¡Œåœ¨ä¸åŒçš„çº¿ç¨‹é—´å¤šæ¬¡é€šè¿‡L3ç¼“å­˜æ¥äº¤æ¢æœ€æ–°çš„æ‹·è´æ•°æ®ï¼Œè¿™æå¤§çš„å½±å“äº†å¤šæ ¸å¿ƒCPUçš„æ€§èƒ½ã€‚***å¦‚æœè¿™äº›CPUæ ¸å¿ƒåœ¨ä¸åŒçš„æ’æ§½ä¸Šï¼Œæ€§èƒ½ä¼šå˜å¾—æ›´ç³Ÿã€‚

## JVMä¸­ä¼˜åŒ–çš„æ–¹æ³•

æ‰€æœ‰çš„Javaå¯¹è±¡éƒ½æœ‰8å­—èŠ‚çš„å¯¹è±¡å¤´ï¼Œå‰å››ä¸ªå­—èŠ‚ç”¨æ¥ä¿å­˜å¯¹è±¡çš„å“ˆå¸Œç å’Œé”çš„çŠ¶æ€ï¼Œå‰3ä¸ªå­—èŠ‚ç”¨æ¥å­˜å‚¨å“ˆå¸Œç ï¼Œæœ€åä¸€ä¸ªå­—èŠ‚ç”¨æ¥å­˜å‚¨é”çŠ¶æ€ï¼Œä¸€æ—¦å¯¹è±¡ä¸Šé”ï¼Œè¿™4ä¸ªå­—èŠ‚éƒ½ä¼šè¢«æ‹¿å‡ºå¯¹è±¡å¤–ï¼Œå¹¶ç”¨æŒ‡é’ˆè¿›è¡Œé“¾æ¥ã€‚å‰©ä¸‹4ä¸ªå­—èŠ‚ç”¨æ¥å­˜å‚¨å¯¹è±¡æ‰€å±ç±»çš„å¼•ç”¨ã€‚å¯¹äºæ•°ç»„æ¥è®²ï¼Œè¿˜æœ‰ä¸€ä¸ªä¿å­˜æ•°ç»„å¤§å°çš„å˜é‡ï¼Œä¸º4å­—èŠ‚ã€‚æ¯ä¸€ä¸ªå¯¹è±¡çš„å¤§å°éƒ½ä¼šå¯¹é½åˆ°8å­—èŠ‚çš„å€æ•°ï¼Œä¸å¤Ÿ8å­—èŠ‚éƒ¨åˆ†éœ€è¦å¡«å……ã€‚

![å¯¹è±¡å†…å­˜æ¨¡å‹](/assets/imgs/image-20200709151033237.png)

***ä¸ºäº†ä¿è¯æ•ˆç‡ï¼ŒJavaç¼–è¯‘å™¨åœ¨ç¼–è¯‘Javaå¯¹è±¡çš„æ—¶å€™ï¼Œé€šè¿‡å­—æ®µç±»å‹å¯¹Javaå¯¹è±¡çš„å­—æ®µè¿›è¡Œæ’åºï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚***å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä»»ä½•å­—æ®µä¹‹é—´é€šè¿‡å¡«å……é•¿æ•´å‹çš„å˜é‡æŠŠçƒ­ç‚¹å˜é‡éš”ç¦»åœ¨ä¸åŒçš„ç¼“å­˜è¡Œä¸­ï¼Œé€šè¿‡å‡å°‘ä¼ªåŒæ­¥ï¼Œåœ¨å¤šæ ¸å¿ƒCPUä¸­èƒ½å¤Ÿæå¤§çš„æé«˜æ•ˆç‡ã€‚

| é¡ºåº |   ç±»å‹   |    å­—èŠ‚æ•°é‡    |
| :--: | :------: | :------------: |
|  1   |  double  |     8å­—èŠ‚      |
|  2   |   long   |     8å­—èŠ‚      |
|  3   |   int    |     4å­—èŠ‚      |
|  4   |  float   |     4å­—èŠ‚      |
|  5   |  short   |     2å­—èŠ‚      |
|  6   |   char   |     2å­—èŠ‚      |
|  7   | boolean  |     1å­—èŠ‚      |
|  8   |   byte   |     1å­—èŠ‚      |
|  9   | å¯¹è±¡å¼•ç”¨ | 4å­—èŠ‚æˆ–è€…8å­—èŠ‚ |
|  10  | å­ç±»å­—æ®µ |    é‡æ–°æ’åº    |

***ä¸€äº›è¯´æ˜ï¼š***

* ä¼ªå…±äº«

  * ä¸€ä¸ªcache lienå¯ä»¥è¢«å¤šä¸ªä¸åŒçš„çº¿ç¨‹æ‰€ä½¿ç”¨ã€‚å¦‚æœæœ‰å…¶ä»–çº¿ç¨‹ä¿®æ”¹äº†v2çš„å€¼ï¼Œçº¿ç¨‹1å’Œçº¿ç¨‹2å°†ä¼šå¼ºåˆ¶é‡æ–°åŠ è½½cache lineã€‚ä½ å¯ä»¥ä¼šç–‘æƒ‘æˆ‘ä»¬åªæ˜¯ä¿®æ”¹äº†v2çš„å€¼ä¸åº”è¯¥ä¼šå½±å“å…¶ä»–å˜é‡ï¼Œä¸ºå•¥çº¿ç¨‹1å’Œçº¿ç¨‹2éœ€è¦é‡æ–°åŠ è½½cache lineå‘¢ã€‚ç„¶åï¼Œå³ä½¿***å¯¹äºå¤šä¸ªçº¿ç¨‹æ¥è¯´è¿™äº›æ›´æ–°æ“ä½œæ˜¯é€»è¾‘ç‹¬ç«‹çš„ï¼Œä½†æ˜¯ä¸€è‡´æ€§çš„ä¿æŒæ˜¯ä»¥cache lineä¸ºåŸºç¡€çš„ï¼Œè€Œä¸æ˜¯ä»¥å•ä¸ªç‹¬ç«‹çš„å…ƒç´ ã€‚è¿™ç§æ˜æ˜¾æ²¡æœ‰å¿…è¦çš„å…±äº«æ•°æ®çš„æ–¹å¼è¢«ç§°ä½œâ€œFalse sharingâ€ã€‚***

* ç¼“å­˜è¡Œå¯¹é½

  - ç¼“å­˜è¡Œ64ä¸ªå­—èŠ‚æ˜¯CPUåŒæ­¥çš„åŸºæœ¬å•ä½ï¼Œç¼“å­˜è¡Œéš”ç¦»ä¼šæ¯”ä¼ªå…±äº«æ•ˆç‡è¦é«˜

* **éœ€è¦æ³¨æ„ï¼ŒJDK8å¼•å…¥äº†@sun.misc.Contendedæ³¨è§£ï¼Œæ¥ä¿è¯ç¼“å­˜è¡Œéš”ç¦»æ•ˆæœ**

  - è¦ä½¿ç”¨æ­¤æ³¨è§£ï¼Œå¿…é¡»å»æ‰é™åˆ¶å‚æ•°ï¼š-XX:-RestrictContended

* å¦å¤–ï¼Œjavaç¼–è¯‘å™¨æˆ–è€…JITç¼–è¯‘å™¨æœ‰å¯èƒ½ä¼šå»é™¤æ²¡ç”¨çš„å­—æ®µï¼Œæ‰€ä»¥å¡«å……å­—æ®µå¿…é¡»åŠ ä¸Švolatile

  ```java
  package com.mashibing.juc.c_028_FalseSharing;
  
  public class T02_CacheLinePadding {
      private static class Padding {
          public volatile long p1, p2, p3, p4, p5, p6, p7; //
      }
  
      private static class T extends Padding {
          public volatile long x = 0L;
      }
  
      public static T[] arr = new T[2];
  
      static {
          arr[0] = new T();
          arr[1] = new T();
      }
  
      public static void main(String[] args) throws Exception {
          Thread t1 = new Thread(()->{
              for (long i = 0; i < 1000_0000L; i++) {
                  arr[0].x = i;
              }
          });
  
          Thread t2 = new Thread(()->{
              for (long i = 0; i < 1000_0000L; i++) {
                  arr[1].x = i;
              }
          });
  
          final long start = System.nanoTime();
          t1.start();
          t2.start();
          t1.join();
          t2.join();
          System.out.println((System.nanoTime() - start)/100_0000);
      }
  }
  
  ```

  



## MESI Cache ä¸€è‡´æ€§åè®®

> ç¼“å­˜ä¸€è‡´æ€§åè®®æ˜¯CPUçº§åˆ«çš„ä¸€ç§æ–¹æ³•ï¼Œvolatileè¿™æ˜¯JVMå±‚é¢çš„å®ç°ï¼ŒJVMé‡‡å–çš„æ˜¯æœ€å·æ‡’çš„åŠæ³•--é”æ€»çº¿ã€‚

cpuæ¯ä¸ªcache line æ ‡è®°å››ç§çŠ¶æ€ï¼ˆé¢å¤–ä¸¤ä½ï¼‰

ç¼“å­˜é”å®ç°ä¹‹ä¸€ï¼Œæœ‰äº›æ— æ³•è¢«ç¼“å­˜çš„æ•°æ®æˆ–è€…è·¨è¶Šå¤šä¸ªç¼“å­˜è¡Œçš„æ•°æ®ä¾ç„¶å¿…é¡»ä½¿ç”¨æ€»çº¿é”ã€‚

![image-20200902192903419](/assets/imgs/image-20200902192903419.png)