---
layout: post
title:  "计算机网络重点"
date:   2020-08-31 14:58:06 +0800--
categories: [计算机网络]
tags: [计算机网络, ]  

---

# 计算机网络概述

> 书籍：计算机网络自顶向下. TCP/IP详解

## 计算机网络的类别

![image-20200921222257485](/assets/imgs/image-20200921222257485.png)

## 计算机网络的性能

- 速率

  连接在计算机网络上的主机在数字信道上传送数据位数的速率，也称data rate或bit rate(比特率)，单位是b/s, kb/s, Mb/s, Gb/s。和正常理解的网速的关系是除以8.

- 带宽

  数据通信领域中，数字信道所能传送的最高数据率，单位是b/s, kb/s, Mb/s, Gb/s。常见的是Mpbs。

- 吞吐量

  在单位时间内通过某个网络的数据量，单位是b/s, Mb/s。

- 时延

  包括发送时延，传播时延，处理时延，排队时延。***发送时延等于数据块长度(bit)除以信道带宽(bit/s)***. 更快的发送速度意味着波长越短，链路上的数据量更大；更快的传播速度意味着在网线中更快的传播速度。

- 时延X带宽(时延带宽积)

  有多少数据正在线路上。

- 往返时间(RTT, Round-Trip Time)

  从发送方发送数据开始，到发送方收到接收方确认数据的时间。例如ping一下。

- 利用率

  ***包括信道利用率***：有数据通过的时间/(有+无)数据通过的时间
  ***网络利用率***：信道利用率的加权平均
  ***网络当前时延D*** = 网络空闲时时延$D_0$ / (1 - 信道利用率U)

## 计算机网络体系结构

### 基本概念

![image-20200921224123486](/assets/imgs/image-20200921224123486.png)

### OSI参考模型

> 分层的意义：标准化，降低各层之间的关联

- 应用层

  所有能产生网络流量的程序

- 表示层

  在传输之前是否进行加密 或 压缩 处理，二进制或ASCII码表示

- 会话层

  看需求端和网站之间的连接；查木马(netstat -nb)

- 传输层

  ***可靠传输，流量控制，不可靠传输***(一个数据包即可，不需要建立会话，例如向DNS查询网站IP地址)

- 网络层

  ***负责选择最佳路径，IP地址编址***(ipv4和ipv6变化只会影响网络层)

- 数据链路层

  数据如何封装(帧的开始和结束，还有透明传输，差错校验(纠错由传输层解决) 添加物理层地址 计算机网卡(MAC) 

- 物理层

  定义网络设备接口标准，电气标准(电压)，如何在物理链路上传输的更快

![image-20200921222040702](/assets/imgs/image-20200921222040702.png)





# 数据链路层

## 以太网帧的格式

在网络层，给数据包增加了接收端和发送端的IP地址。在数据链路层里，增加了帧头帧尾，MAC地址和校验值。

![image-20200922183812721](/assets/imgs/image-20200922183812721.png)

## 数据链路层的三个基本问题

### 封装成帧(framing)

- 封装成帧(framing)就是在一段数据的前后分别 添加首部和尾部，然后就构成了一个帧。确定帧的界限。
- 首部和尾部的一个重要作用就是进行帧定界
- 最大传送单元（Maximum Transfer Unit，MTU）。意思是IP数据报的最大长度（不包括帧头帧尾）。MTU的单位是字节。

![image-20200922184411594](/assets/imgs/image-20200922184411594.png)



### 透明传输

![image-20200922184441856](/assets/imgs/image-20200922184441856-0771614.png)

解决办法：

- 发送端的数据链路层在数据中出现控制字符“SOH”或“EOT”的前面插入一个转义字符 “ESC”(其十六进制编码是 1B)。
- ***字节填充***(byte stuffing)或***字符填充***(character stuffing)——接收端的数据链路层在将数据送往网络层之前删除插入的***转义字符***。
- 如果转义字符也出现数据当中，那么应在转义字 符前面插入一个转义字符。当接收端收到连续的 两个转义字符时，就删除其中前面的一个。

![image-20200922185151784](/assets/imgs/image-20200922185151784.png)

### 差错检测

- 在传输过程中可能会产生***比特差错***:1 可能会变成0而0也可能变成1。
- 在一段时间内，传输错误的比特占所传输比特总数的比率称为***误码率 BER (Bit Error Rate)。***
- 误码率与信噪比有很大的关系。
- 为了保证数据传输的可靠性，在计算机网络传 输数据时，必须采用各种差错检测措施。

解决办法：

[***循环冗余检验 CRC 的检错技术***](https://blog.csdn.net/D_leo/article/details/73572373?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-2.channel_param&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-2.channel_param)

- 仅用循环冗余检验 CRC 差错检测技术只能做到无差错接受(accept)
- “无差错接受”是指:“凡是接受的帧(即不包括丢弃的帧)，我们都能以非常接近于 1 的概率认为这些帧在传输过程中没有产生差错”
- 要做到“***可靠传输***”(即发送什么就收到什么) 就必须再加上***确认和重传机制***。

## 两种情况下的数据链路层

### 使用点对点信道的数据链路层

#### [PPP协议](https://blog.csdn.net/u011857683/article/details/84703473)

ppp协议(point to point protocol)是数据链路层协议，例如用户使用拨号上网。

### 使用广播信道的数据链路层

局域网最主要的特点是:网络为一个单位所拥有，且地理范围和站点数目均有限。

局域网具有如下的一些主要优点:

- ***具有广播功能***，从一个站点可很方便地访问全网。局域网上的主机可共享连接在局域网上的各种硬件 和软件资源。
- 便于系统的扩展和逐渐地演变，各设备的位置可灵活调整和改变。 
- 提高了系统的可靠性、可用性和残存性。

- 局域网的拓扑：

![image-20200922200318043](/assets/imgs/image-20200922200318043.png)



#### CSMA/CD 协议

- CSMA/CD 表示 Carrier Sense Multiple Access with Collision Detection。
-  ***“多点接入”表示许多计算机以多点接入的方式连接在一根总线上。***
- “载波监听”是指每一个站在发送数据之前先 要检测一下总线上是否有其他计算机在发送数 据，如果有，则暂时不要发送数据，以免发生 碰撞。
- 总线上并没有什么“载波”。因此，“载波监 听”就是用电子技术检测总线上有没有其他计算机发送的数据信号。
- 使用 CSMA/CD 协议的以太网不能进行全 双工通信而只能进行双向交替通信(半双工通信)。

![image-20200922202626188](/assets/imgs/image-20200922202626188.png)

***争用期:***

最先发送数据帧的站，在发送数据帧后至 多经过时间 2t (两倍的端到端往返时延) 就可知道发送的数据帧是否遭受了碰撞。以太网的端到端往返时延 2t 称为争用期， 或碰撞窗口。***经过争用期这段时间还没有检测到碰撞， 才能肯定这次发送不会发生碰撞。***

- 争用期的长度
  - 以太网取 51.2 μs 为争用期的长度。
  - 对于 10 Mb/s 以太网，在争用期内可发送 512 bit，即 64 字节。
  - ***以太网在发送数据时，若前 64 字节没有发 生冲突，则后续的数据就不会发生冲突。***
- 最短有效帧长
  - ***如果发生冲突，就一定是在发送的前 64 字节之内。***
  - 由于一检测到冲突就立即中止发送，这时 已经发送出去的数据一定小于 64 字节。
  - 以太网规定了最短有效帧长为 64 字节，凡长度小于 64 字节的帧都是由于冲突而异常中止的***无效帧***。

- ***二进制指数类型退避算法***
  - 发生碰撞的站在停止发送数据后，要推迟 (退避)一个随机时间才能再发送数据。

- 强化碰撞；当发送数据的站一旦发现发生了碰撞时:
  - 立即停止发送数据;
  - 再继续发送若干比特的***人为干扰信号(jamming signal)***，以便让所有用户都知道现在已经发生 了碰撞。



# 网络层

## 一些基本知识

### 网络中继系统

网络互相连接起来 要使用一些中间设备。中间设备又称为中间系统或中继(relay)系统。

- 物理层中继系统:转发器(repeater)
- 数据链路层中继系统:网桥或桥接器(bridge)
- 网络层中继系统:路由器(router)
-  网桥和路由器的混合物:桥路器(brouter)
-  网络层以上的中继系统:网关(gateway)

### IP地址与硬件地址

![image-20200923221045257](/Users/silince/Develop/博客/blog_to_git/assets/imgs/image-20200923221045257.png)

### **计算机A与计算机B的通信过程**

- 交换机基于数据帧的MAC地址转发数据帧，路由器基于数据包的IP地址转发数据包
- 数据包在传输过程不变，过网络设备数据帧要用***新的物理层地址重新封装***
- ***MAC地址决定了数据帧下一跳哪个设备接受，而IP地址决定了数据包的起点和终点***

![image-20200923221133143](/Users/silince/Develop/博客/blog_to_git/assets/imgs/image-20200923221133143.png)

### 网络层4个协议之间层次

![image-20200923182714918](/assets/imgs/image-20200923182714918.png)



## ARP/RARP协议 (地址解析和逆地址解析)

### 地址解析协议 ARP

- 不管网络层使用的是什么协议，在实际网络的链路上传送数据帧时，最终还是必须使用硬件地址。
- ***每一个主机都设有一个 ARP 高速缓存(ARP cache)，***里面有所在的局域网上的各主机和路由器 的 IP 地址到硬件地址的映射表。
- ***当主机 A 欲向本局域网上的某个主机 B 发送 IP 数据报时，就先在其 ARP 高速缓存中查看有无主机 B 的 IP 地址。***如有，就可查出其对应的硬件地址， 再将此硬件地址写入 MAC 帧，然后通过局域网将 该 MAC 帧发往此硬件地址。

![image-20200923224510579](/Users/silince/Develop/博客/blog_to_git/assets/imgs/image-20200923224510579.png)

![image-20200923224728805](/Users/silince/Develop/博客/blog_to_git/assets/imgs/image-20200923224728805.png)



***使用ARP的四种典型情况：***

- 发送方是主机，要把IP数据报发送到本网络的另一个主机，此时用ARP找到目标主机的MAC地址；
- 发送方是主机，要把IP数据报发送到另一个网络的另一个主机，此时用ARP找到本网络上一个路由器的MAC地址，剩下的工作由路由器进行；
- 发送方是路由器，要把IP数据报发送到本网络的另一个主机，此时用ARP找到目标主机的MAC地址；
- 发送方是路由器，要把IP数据报发送到另一个网络的另一个主机，此时用ARP找到本网络上一个路由器的MAC地址，剩下的工作由路由器进行；

#### ARP协议的作用

- 将IP地址通过广播(本网段，不通过路由器)，目标MAC地址是FF-FF-FF-FF-FF-FF，解析目标IP地址的MAC地址。
- ARP是解决同一个局域网上的主机或路由器的IP地址和MAC地址的映射关系。如果所找的主机和原主机不在同一个局域网上，那么就要通过ARP找一个位于本局域网上的某个路由器的MAC地址，然后把分组发送给这个路由器，让这个路由器把分组转发给下一个网络。剩下的工作就由下一个网络来做。
- 从IP地址到MAC地址的解析是自动进行的，主机的用户对这种地址解析过程是不知情的。
- 只要主机或路由器要和本网络上的另一个已知IP地址的主机或路由器进行通信，ARP协议就会自动地将该IP地址解析为链路层所需要的MAC地址。

#### ARP的报文格式

![image-20200923225702122](/Users/silince/Develop/博客/blog_to_git/assets/imgs/image-20200923225702122.png)

硬件类型：表示硬件地址的类型，值为1表示以太网地址

协议类型：表示要映射的协议地址类型。它的值为0x0800表示IP地址类型

硬件地址长度和协议地址长度以字节为单位，对于以太网上的IP地址的ARP请求或应答来说，他们的值分别为6和4；

操作类型（op）:1表示ARP请求，2表示ARP应答

发送端MAC地址：发送方设备的硬件地址；

发送端IP地址：发送方设备的IP地址；

目标MAC地址：接收方设备的硬件地址。

目标IP地址：接收方设备的IP地址。

#### ARP地址解析过程

**主机A和B在同一个网段，主机A要向主机B发送信息。如图1-2所示，具体的地址解析过程如下：**

1. 主机A首先查看自己的ARP缓存表，确定其中是否包含有主机B对应的ARP表项。如果找到了对应的MAC地址，则主机A直接利用ARP表中的MAC地址，对IP数据包进行帧封装，并将数据包发送给主机B。
2. 如果主机A在ARP表中找不到对应的MAC地址，则将缓存该数据报文，然后以广播方式发送一个ARP请求报文。ARP请求报文中的发送端IP地址和发送端MAC地址为主机A的IP地址和MAC地址，目标IP地址和目标MAC地址为主机B的IP地址和 ff-ff-ff-ff-ff-ff 的MAC地址。由于ARP请求报文以广播方式发送，该网段上的所有主机都可以接收到该请求，但只有被请求的主机（即主机B）会对该请求进行处理。
3. 主机B比较自己的IP地址和ARP请求报文中的目标IP地址，当两者相同时进行如下处理：将ARP请求报文中的发送端（即主机A）的IP地址和MAC地址存入自己的ARP表中。之后以单播方式发送ARP响应报文给主机A，其中包含了自己的MAC地址。
4. 主机A收到ARP响应报文后，将主机B的MAC地址加入到自己的ARP表中以用于后续报文的转发，同时将IP数据包进行封装后发送出去。

![image-20200923230203386](/Users/silince/Develop/博客/blog_to_git/assets/imgs/image-20200923230203386.png)

**当主机A和主机B不在同一网段时:**

主机A就会先向网关发出ARP请求，ARP请求报文中的目标IP地址为网关的IP地址。当主机A从收到的响应报文中获得网关的MAC地址后，将报文封装并发给网关。如果网关没有主机B的ARP表项，网关会广播ARP请求，目标IP地址为主机B的IP地址，当网关从收到的响应报文中获得主机B的MAC地址后，就可以将报文发给主机B；如果网关已经有主机B的ARP表项，网关直接把报文发给主机B。



#### ARP缓存/ARP欺骗

- 为了减少网络上的通信量，主机 A 在发送 其 ARP 请求分组时，就将自己的 IP 地址 到硬件地址的映射写入 ARP 请求分组。
- 当主机 B 收到 A 的 ARP 请求分组时，就 将主机 A 的这一地址映射写入主机 B 自己 的 ARP 高速缓存中。这对主机 B 以后向 A 发送数据报时就更方便了。



#### 应当注意的问题

- ARP 是解决同一个局域网上的主机或路由器的 IP 地址和硬件地址的映射问题。
- 如果所要找的主机和源主机不在同一个局域网上，那么就要通过 ARP 找到一个位于本局 域网上的某个路由器的硬件地址，然后把分组发送给这个路由器，让这个路由器把分组 转发给下一个网络。剩下的工作就由下一个网络来做。
- 从IP地址到硬件地址的解析是自动进行的， 主机的用户对这种地址解析过程是不知道的。
- 只要主机或路由器要和本网络上的另一个已 知 IP 地址的主机或路由器进行通信，ARP 协议就会自动地将该 IP 地址解析为链路层所 需要的硬件地址。

### 逆地址解析协议 RARP

- 逆地址解析协议 RARP 使只知道自己硬件地址的主机能够知道其 IP 地址。
- 这种主机往往是无盘工作站。 因此 RARP 协议目前已很少使用。



## IP协议







- IP协议

  - 掌握IP首部格式：如16位分片标识、DF不分片标志、MF更多分片标志、13位片偏移、8位生存时间TTL、16位的首部检验和等等。
  - 掌握IP分片
  - 掌握IP选路

- 掌握ICMP协议

  - 报文格式
  - 报文的两大分类：查询+差错（2种查询报文+5种差错报文）

  









---







- 传输层
  - 掌握UDP协议
    - 包括特点+首部各个字段
  - 掌握TCP协议
    - 特点+首部字段+可靠机制
    - TCP连接控制机制：三次握手、四次挥手、同时打开、同时关闭、半关闭
    - TCP流量控制机制：滑动窗口、慢启动、拥塞避免、快速重传、快速恢复
    - TCp超时重传机制：各种定时器
- 应用层
  - 掌握DNS协议
    - 掌握DNS协议的名字空间、DNS指针查询(反向查找或逆向解析)基本原理、DNS缓存
    - 掌握FTP协议：他是网络界的活化石
      - 两条连接：控制连接+数据连接
      - 两种工作模式：PASV + PORT
      - 各种FTP指令和响应码
      - FTP断点续传、匿名FTP
  - 掌握HTTP协议
    - 报问格式：请求报文、响应报文、请求头各种字段、响应头各种字段
    - http状态码
  - 掌握HTTPS协议
    - https的详细握手过程
    - 摘要算法、数字签名、数字证书的原理和过程
- [面试题分享](/Users/silince/Develop/面试相关/计算机网络面试题总结.pdf)



# 

